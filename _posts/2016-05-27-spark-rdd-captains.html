---
layout: post
title: "Who is the best cricket captain?"
date: 2016-05-25
description: "Using Spark RDD APIs"
main-class: 'spark'
postbook: 'inotebook'
published: true
color: '#637a91'
tags:
- spark
- rdd
- "data Science"
- pyspark
categories:
- spark
introduction: "Using Spark RDD APIs"
---


<div tabindex="-1" id="notebook" class="border-box-sizing">
  <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Overview">Overview<a class="anchor-link" href="#Overview">&#182;</a></h3><ul>
<li>This notebook gives on overview of how to read data into Spark Framework and apply basic RDD operations like parsing, filtering, grouping, sorting and map reduce operations using keys and values.</li>
<li>When spark starts, the sparkContext is created and available as variable <em>sc</em></li>
<li>This dataset is taken from cricinfo.com. There are two datasets available: <a href="/assets/data/captains_ODI.csv">Captains ODIs</a> &amp; <a href="/assets/data/captains_Test.csv">Captains Tests</a> </li>
</ul>
<ul>
<li>Using RDD APIs, we will explore the following steps:</p>
<ul>
<li>Reading text files</li>
<li>Parse records and associate with a schema </li>
<li>Filtering of records</li>
<li>Grouping of records</li>
<li>Sorting by key and values</li>
<li>Applying map and reduce functions</li>
<li>Caching RDDs</li>
<li>Applying <em>groupByKey()</em> and <em>mapValues()</em> functions</li>
<li>Collecting data into driver</li>
<li>Joining RDDs</li>
<li>Saving RDDs into files</li>
<li>Using Broadcast variables</li>
<li>Using Accumulators</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Check-Spark-Context">Check Spark Context<a class="anchor-link" href="#Check-Spark-Context">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Checking-if-SparkContext-is-Created">Checking if SparkContext is Created<a class="anchor-link" href="#Checking-if-SparkContext-is-Created">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Spark Context Created.. Let&#39;s verify it</span>
<span class="n">sc</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[1]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;pyspark.context.SparkContext at 0x7f2a4c425278&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Checking-spark-version">Checking spark version<a class="anchor-link" href="#Checking-spark-version">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[184]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">sc</span><span class="o">.</span><span class="n">version</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[184]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&apos;1.6.0&apos;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Check-Spark-Master-Deployment-Mode">Check Spark Master Deployment Mode<a class="anchor-link" href="#Check-Spark-Master-Deployment-Mode">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[185]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">sc</span><span class="o">.</span><span class="n">master</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[185]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&apos;local[2]&apos;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Spark-Application-Name-and-ID">Spark Application Name and ID<a class="anchor-link" href="#Spark-Application-Name-and-ID">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[186]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">sc</span><span class="o">.</span><span class="n">appName</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[186]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&apos;pyspark-shell&apos;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[187]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">sc</span><span class="o">.</span><span class="n">applicationId</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[187]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&apos;local-1469738969083&apos;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Spark-using-which-python-version">Spark using which python version<a class="anchor-link" href="#Spark-using-which-python-version">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[188]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">sc</span><span class="o">.</span><span class="n">pythonVer</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[188]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&apos;3.4&apos;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="ODI-Performance-Analysis">ODI Performance Analysis<a class="anchor-link" href="#ODI-Performance-Analysis">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Loading-the-dataset">Loading the dataset<a class="anchor-link" href="#Loading-the-dataset">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Read-the-capatings_ODI.csv-file-from-local-file-system">Read the capatings_ODI.csv file from local file system<a class="anchor-link" href="#Read-the-capatings_ODI.csv-file-from-local-file-system">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">captains_odis</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span> <span class="s">&quot;file:///home/hadoop/lab/data/captains_ODI.csv&quot;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Check-the-first-record">Check the first record<a class="anchor-link" href="#Check-the-first-record">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">captains_odis</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[3]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&apos;Ponting  R T,Australia,1995-2012,230,165,51,14,124&apos;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Display-the-first-10-records">Display the first 10 records<a class="anchor-link" href="#Display-the-first-10-records">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[130]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">captains_odis</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[130]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[&apos;Ponting  R T,Australia,1995-2012,230,165,51,14,124&apos;,
&apos;Fleming  S P,New Zealand,1994-2007,218,98,106,14,105&apos;,
&apos;Ranatunga  A,Sri Lanka,1982-1999,193,89,95,9,102&apos;,
&apos;Dhoni  M S*,India,2004-,186,103,68,15,88&apos;,
&apos;Border  A R,Australia,1979-1994,178,107,67,4,86&apos;,
&apos;Azharuddin  M,India,1985-2000,174,89,77,8,96&apos;,
&apos;Smith  G C,South Africa,2002-2013,149,91,51,7,74&apos;,
&apos;Ganguly  S C,India,1992-2007,147,76,66,5,74&apos;,
&apos;Cronje  W J,South Africa,1992-2000,140,99,37,4,74&apos;,
&apos;Imran Khan,Pakistan,1974-1992,139,75,59,5,70&apos;]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Checking-the-RDD-type">Checking the RDD type<a class="anchor-link" href="#Checking-the-RDD-type">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># captains_odis should be of RDD type</span>
<span class="nb">type</span><span class="p">(</span> <span class="n">captains_odis</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[5]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>pyspark.rdd.RDD</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">captains_odis</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span> <span class="n">StorageLevel</span><span class="o">.</span><span class="n">MEMORY_ONLY_SER</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[6]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>MapPartitionsRDD[1] at textFile at NativeMethodAccessorImpl.java:-2</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Counting-the-number-of-records">Counting the number of records<a class="anchor-link" href="#Counting-the-number-of-records">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Count the number of records</span>
<span class="n">captains_odis</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[7]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>98</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Parsing-the-lines-and-creating-records">Parsing the lines and creating records<a class="anchor-link" href="#Parsing-the-lines-and-creating-records">&#182;</a></h3><ul>
<li>Each line from the file is taken as a record. The records are not associated with a schema. Let's define a schema and associate the fields in each line with the schema. One way of doing it is defining a named tuple and converting the lines into named tuples.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;country&quot;</span><span class="p">,</span> <span class="s">&quot;career&quot;</span><span class="p">,</span> <span class="s">&quot;matches&quot;</span><span class="p">,</span> <span class="s">&quot;won&quot;</span><span class="p">,</span> <span class="s">&quot;lost&quot;</span><span class="p">,</span> <span class="s">&quot;ties&quot;</span><span class="p">,</span> <span class="s">&quot;toss&quot;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">namedtuple</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Define-named-tuples-to-represent-records">Define named tuples to represent records<a class="anchor-link" href="#Define-named-tuples-to-represent-records">&#182;</a></h3><ul>
<li>Lets define a tuple ( a record ) for each line. We need to iterate through each line and convert that into a record. The record can be defined as a namedTuple type and called Captain. Let's also link the names for the fields</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">Captain</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span> <span class="s">&#39;Captain&#39;</span><span class="p">,</span> <span class="n">fields</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Parsing-lines-into-named-tuples">Parsing lines into named tuples<a class="anchor-link" href="#Parsing-lines-into-named-tuples">&#182;</a></h3><ul>
<li>Create a function to parse the lines and create namedtuples. Then iterate throught the data and convert them into records i.e. named tuples.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Define a function to parse each line and convert them into records</span>
<span class="k">def</span> <span class="nf">parseRecs</span><span class="p">(</span> <span class="n">line</span> <span class="p">):</span>
  <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">Captain</span><span class="p">(</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span> <span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="p">),</span>
                 <span class="nb">int</span><span class="p">(</span> <span class="n">fields</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">captains</span> <span class="o">=</span> <span class="n">captains_odis</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">parseRecs</span><span class="p">(</span> <span class="n">rec</span><span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Cache-the-RDD">Cache the RDD<a class="anchor-link" href="#Cache-the-RDD">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>We will be using the RDD in future for many analysis. So, let's cache the RDD.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[40]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">captains</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[40]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>PythonRDD[6] at RDD at PythonRDD.scala:43</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[41]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Now captains refer to all the records. Let&#39;s display the first 10 records.</span>
<span class="n">captains</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[41]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[Captain(name=&apos;Ponting  R T&apos;, country=&apos;Australia&apos;, career=&apos;1995-2012&apos;, matches=230, won=165, lost=51, ties=14, toss=124),
Captain(name=&apos;Fleming  S P&apos;, country=&apos;New Zealand&apos;, career=&apos;1994-2007&apos;, matches=218, won=98, lost=106, ties=14, toss=105),
Captain(name=&apos;Ranatunga  A&apos;, country=&apos;Sri Lanka&apos;, career=&apos;1982-1999&apos;, matches=193, won=89, lost=95, ties=9, toss=102),
Captain(name=&apos;Dhoni  M S*&apos;, country=&apos;India&apos;, career=&apos;2004-&apos;, matches=186, won=103, lost=68, ties=15, toss=88),
Captain(name=&apos;Border  A R&apos;, country=&apos;Australia&apos;, career=&apos;1979-1994&apos;, matches=178, won=107, lost=67, ties=4, toss=86),
Captain(name=&apos;Azharuddin  M&apos;, country=&apos;India&apos;, career=&apos;1985-2000&apos;, matches=174, won=89, lost=77, ties=8, toss=96),
Captain(name=&apos;Smith  G C&apos;, country=&apos;South Africa&apos;, career=&apos;2002-2013&apos;, matches=149, won=91, lost=51, ties=7, toss=74),
Captain(name=&apos;Ganguly  S C&apos;, country=&apos;India&apos;, career=&apos;1992-2007&apos;, matches=147, won=76, lost=66, ties=5, toss=74),
Captain(name=&apos;Cronje  W J&apos;, country=&apos;South Africa&apos;, career=&apos;1992-2000&apos;, matches=140, won=99, lost=37, ties=4, toss=74),
Captain(name=&apos;Imran Khan&apos;, country=&apos;Pakistan&apos;, career=&apos;1974-1992&apos;, matches=139, won=75, lost=59, ties=5, toss=70)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[42]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># What is the type of the captains RDD</span>
<span class="nb">type</span><span class="p">(</span> <span class="n">captains</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[42]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>pyspark.rdd.PipelinedRDD</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Finding-ODI-Insights">Finding ODI Insights<a class="anchor-link" href="#Finding-ODI-Insights">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Filtering-records:-Captain's-who-captained-for-more-than-100-ODIs">Filtering records: Captain's who captained for more than 100 ODIs<a class="anchor-link" href="#Filtering-records:-Captain's-who-captained-for-more-than-100-ODIs">&#182;</a></h3><ul>
<li>Filter only those captains that have captained for at least 100 ODI matches. And then we can compare the statistics of these captains</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[43]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">captains_100</span> <span class="o">=</span> <span class="n">captains</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="o">.</span><span class="n">matches</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="How-many-captains-have-captained-their-country-for-more-than-100-ODIs?">How many captains have captained their country for more than 100 ODIs?<a class="anchor-link" href="#How-many-captains-have-captained-their-country-for-more-than-100-ODIs?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[44]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">captains_100</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[44]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>16</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[45]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Who are these captains</span>
<span class="n">captains_100</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[45]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[Captain(name=&apos;Ponting  R T&apos;, country=&apos;Australia&apos;, career=&apos;1995-2012&apos;, matches=230, won=165, lost=51, ties=14, toss=124),
Captain(name=&apos;Fleming  S P&apos;, country=&apos;New Zealand&apos;, career=&apos;1994-2007&apos;, matches=218, won=98, lost=106, ties=14, toss=105),
Captain(name=&apos;Ranatunga  A&apos;, country=&apos;Sri Lanka&apos;, career=&apos;1982-1999&apos;, matches=193, won=89, lost=95, ties=9, toss=102),
Captain(name=&apos;Dhoni  M S*&apos;, country=&apos;India&apos;, career=&apos;2004-&apos;, matches=186, won=103, lost=68, ties=15, toss=88),
Captain(name=&apos;Border  A R&apos;, country=&apos;Australia&apos;, career=&apos;1979-1994&apos;, matches=178, won=107, lost=67, ties=4, toss=86),
Captain(name=&apos;Azharuddin  M&apos;, country=&apos;India&apos;, career=&apos;1985-2000&apos;, matches=174, won=89, lost=77, ties=8, toss=96),
Captain(name=&apos;Smith  G C&apos;, country=&apos;South Africa&apos;, career=&apos;2002-2013&apos;, matches=149, won=91, lost=51, ties=7, toss=74),
Captain(name=&apos;Ganguly  S C&apos;, country=&apos;India&apos;, career=&apos;1992-2007&apos;, matches=147, won=76, lost=66, ties=5, toss=74),
Captain(name=&apos;Cronje  W J&apos;, country=&apos;South Africa&apos;, career=&apos;1992-2000&apos;, matches=140, won=99, lost=37, ties=4, toss=74),
Captain(name=&apos;Imran Khan&apos;, country=&apos;Pakistan&apos;, career=&apos;1974-1992&apos;, matches=139, won=75, lost=59, ties=5, toss=70)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Writing-an-utility-/-data-function-to-return-num-captains">Writing an utility / data function to return num captains<a class="anchor-link" href="#Writing-an-utility-/-data-function-to-return-num-captains">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[72]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">getNumCaptainsByMinMatches</span><span class="p">(</span> <span class="n">anRDD</span><span class="p">,</span> <span class="n">num_matches</span> <span class="p">):</span>
  <span class="k">return</span> <span class="n">anRDD</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">parseRecs</span><span class="p">(</span> <span class="n">rec</span><span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="o">.</span><span class="n">matches</span> <span class="o">&gt;</span> <span class="n">num_matches</span> <span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Writing-script-to-test-functions">Writing script to test functions<a class="anchor-link" href="#Writing-script-to-test-functions">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[73]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">test_input_data</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Ponting  R T,Australia,1995-2012,230,165,51,14,124&#39;</span><span class="p">,</span>
<span class="s">&#39;Fleming  S P,New Zealand,1994-2007,218,98,106,14,105&#39;</span><span class="p">,</span>
<span class="s">&#39;Ranatunga  A,Sri Lanka,1982-1999,193,89,95,9,102&#39;</span><span class="p">,</span>
<span class="s">&#39;Dhoni  M S*,India,2004-,186,103,68,15,88&#39;</span><span class="p">,</span>
<span class="s">&#39;Crowe  M D,New Zealand,1982-1995,44,21,22,1,28&#39;</span><span class="p">,</span>
<span class="s">&#39;Atherton  M A,England,1990-1998,43,20,21,2,20&#39;</span><span class="p">,</span>
<span class="s">&#39;Walsh  C A,West Indies,1985-2000,43,22,20,1,20&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[74]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">test_input_rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span> <span class="n">test_input_data</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Testing-a-successful-condition">Testing a successful condition<a class="anchor-link" href="#Testing-a-successful-condition">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[75]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">assert</span> <span class="n">getNumCaptainsByMinMatches</span><span class="p">(</span> <span class="n">test_input_rdd</span><span class="p">,</span> <span class="mi">100</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">,</span>    \
          <span class="s">&quot;getNumCaptainsByMinMatches() returning incorrect matches&quot;</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Testing-a-failure-condition">Testing a failure condition<a class="anchor-link" href="#Testing-a-failure-condition">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[77]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">assert</span> <span class="n">getNumCaptainsByMinMatches</span><span class="p">(</span> <span class="n">test_input_rdd</span><span class="p">,</span> <span class="mi">100</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">,</span>    \
          <span class="s">&quot;getNumCaptainsByMinMatches() returning incorrect matches&quot;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansired">---------------------------------------------------------------------------</span>
<span class="ansired">AssertionError</span>                            Traceback (most recent call last)
<span class="ansigreen">&lt;ipython-input-77-412e927eebe4&gt;</span> in <span class="ansicyan">&lt;module&gt;</span><span class="ansiblue">()</span>
<span class="ansigreen">----&gt; 1</span><span class="ansiyellow"> </span><span class="ansigreen">assert</span> getNumCaptainsByMinMatches<span class="ansiyellow">(</span> test_input_rdd<span class="ansiyellow">,</span> <span class="ansicyan">100</span> <span class="ansiyellow">)</span> <span class="ansiyellow">==</span> <span class="ansicyan">5</span><span class="ansiyellow">,</span>                <span class="ansiblue">&quot;getNumCaptainsByMinMatches() returning incorrect matches&quot;</span><span class="ansiyellow"></span>

<span class="ansired">AssertionError</span>: getNumCaptainsByMinMatches() returning incorrect matches</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><strong>assert()</strong> failed indicating the function is not working.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Invoking-the-function-on-original-data">Invoking the function on original data<a class="anchor-link" href="#Invoking-the-function-on-original-data">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[83]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">getNumCaptainsByMinMatches</span><span class="p">(</span> <span class="n">captains_odis</span><span class="p">,</span> <span class="mi">100</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[83]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>16</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Captains-with-more-wins-than-losses">Captains with more wins than losses<a class="anchor-link" href="#Captains-with-more-wins-than-losses">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[46]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Filtering: Captains who have more wins then losses...</span>
<span class="n">captains_more_wins</span> <span class="o">=</span> <span class="n">captains_100</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="o">.</span><span class="n">won</span> <span class="o">&gt;</span> <span class="n">rec</span><span class="o">.</span><span class="n">lost</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Collecting-the-captain-names-in-the-driver">Collecting the captain names in the driver<a class="anchor-link" href="#Collecting-the-captain-names-in-the-driver">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[47]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Captains with more wins than losses</span>
<span class="n">captains_more_wins</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[47]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[&apos;Ponting  R T&apos;,
&apos;Dhoni  M S*&apos;,
&apos;Border  A R&apos;,
&apos;Azharuddin  M&apos;,
&apos;Smith  G C&apos;,
&apos;Ganguly  S C&apos;,
&apos;Cronje  W J&apos;,
&apos;Imran Khan&apos;,
&apos;Jayawardene  D P M&apos;,
&apos;Jayasuriya  S T&apos;,
&apos;Wasim Akram&apos;,
&apos;Waugh  S R&apos;,
&apos;Richards  I V A&apos;]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[48]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Captains with less wins than losses</span>
<span class="n">captains_more_losts</span> <span class="o">=</span> <span class="n">captains_100</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="o">.</span><span class="n">won</span> <span class="o">&lt;=</span> <span class="n">rec</span><span class="o">.</span><span class="n">lost</span> <span class="p">)</span>
<span class="n">captains_more_losts</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[48]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[&apos;Fleming  S P&apos;, &apos;Ranatunga  A&apos;, &apos;Lara  B C&apos;]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Creating-a-subset-of-data-by-filtering-columns">Creating a subset of data by filtering columns<a class="anchor-link" href="#Creating-a-subset-of-data-by-filtering-columns">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[49]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Which country has played how many matches..</span>
<span class="n">countries</span> <span class="o">=</span> <span class="n">captains</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="p">(</span> <span class="n">rec</span><span class="o">.</span><span class="n">country</span> <span class="p">,</span> <span class="n">rec</span><span class="o">.</span><span class="n">matches</span><span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[50]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">countries</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[50]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Australia&apos;, 230),
(&apos;New Zealand&apos;, 218),
(&apos;Sri Lanka&apos;, 193),
(&apos;India&apos;, 186),
(&apos;Australia&apos;, 178),
(&apos;India&apos;, 174),
(&apos;South Africa&apos;, 149),
(&apos;India&apos;, 147),
(&apos;South Africa&apos;, 140),
(&apos;Pakistan&apos;, 139)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Aggregating-values-by-keys">Aggregating values by keys<a class="anchor-link" href="#Aggregating-values-by-keys">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[51]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Aggregate by countries</span>
<span class="n">matches_countries</span> <span class="o">=</span> <span class="n">countries</span><span class="o">.</span><span class="n">reduceByKey</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[52]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">matches_countries</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">20</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[52]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Pakistan&apos;, 781),
(&apos;South Africa&apos;, 463),
(&apos;Ireland&apos;, 93),
(&apos;Australia&apos;, 832),
(&apos;West Indies&apos;, 658),
(&apos;Kenya&apos;, 114),
(&apos;India&apos;, 770),
(&apos;Bermuda&apos;, 31),
(&apos;Netherlands&apos;, 31),
(&apos;Afghanistan&apos;, 50),
(&apos;England&apos;, 554),
(&apos;Canada&apos;, 27),
(&apos;Zimbabwe&apos;, 394),
(&apos;Sri Lanka&apos;, 710),
(&apos;Bangladesh&apos;, 251),
(&apos;New Zealand&apos;, 608)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[53]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Sort the countries by the number of matches they played. </span>
<span class="c"># Sort by names...(sort by key)</span>
<span class="n">matches_countries</span><span class="o">.</span><span class="n">sortByKey</span><span class="p">()</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[53]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Afghanistan&apos;, 50),
(&apos;Australia&apos;, 832),
(&apos;Bangladesh&apos;, 251),
(&apos;Bermuda&apos;, 31),
(&apos;Canada&apos;, 27),
(&apos;England&apos;, 554),
(&apos;India&apos;, 770),
(&apos;Ireland&apos;, 93),
(&apos;Kenya&apos;, 114),
(&apos;Netherlands&apos;, 31),
(&apos;New Zealand&apos;, 608),
(&apos;Pakistan&apos;, 781),
(&apos;South Africa&apos;, 463),
(&apos;Sri Lanka&apos;, 710),
(&apos;West Indies&apos;, 658),
(&apos;Zimbabwe&apos;, 394)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Sorting-records">Sorting records<a class="anchor-link" href="#Sorting-records">&#182;</a></h3><ul>
<li>Sort the countries by the number of matches they played by descending order by names (key)</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[54]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">matches_countries</span><span class="o">.</span><span class="n">sortByKey</span><span class="p">(</span> <span class="n">ascending</span> <span class="o">=</span> <span class="k">False</span> <span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[54]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Zimbabwe&apos;, 394),
(&apos;West Indies&apos;, 658),
(&apos;Sri Lanka&apos;, 710),
(&apos;South Africa&apos;, 463),
(&apos;Pakistan&apos;, 781),
(&apos;New Zealand&apos;, 608),
(&apos;Netherlands&apos;, 31),
(&apos;Kenya&apos;, 114),
(&apos;Ireland&apos;, 93),
(&apos;India&apos;, 770),
(&apos;England&apos;, 554),
(&apos;Canada&apos;, 27),
(&apos;Bermuda&apos;, 31),
(&apos;Bangladesh&apos;, 251),
(&apos;Australia&apos;, 832),
(&apos;Afghanistan&apos;, 50)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[55]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Sort by values.. default is ascending...</span>
<span class="n">matches_countries</span><span class="o">.</span><span class="n">sortBy</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[55]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Canada&apos;, 27),
(&apos;Bermuda&apos;, 31),
(&apos;Netherlands&apos;, 31),
(&apos;Afghanistan&apos;, 50),
(&apos;Ireland&apos;, 93),
(&apos;Kenya&apos;, 114),
(&apos;Bangladesh&apos;, 251),
(&apos;Zimbabwe&apos;, 394),
(&apos;South Africa&apos;, 463),
(&apos;England&apos;, 554),
(&apos;New Zealand&apos;, 608),
(&apos;West Indies&apos;, 658),
(&apos;Sri Lanka&apos;, 710),
(&apos;India&apos;, 770),
(&apos;Pakistan&apos;, 781),
(&apos;Australia&apos;, 832)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[56]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Sort by value by descending</span>
<span class="n">matches_countries</span><span class="o">.</span><span class="n">sortBy</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="k">False</span> <span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[56]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Australia&apos;, 832),
(&apos;Pakistan&apos;, 781),
(&apos;India&apos;, 770),
(&apos;Sri Lanka&apos;, 710),
(&apos;West Indies&apos;, 658),
(&apos;New Zealand&apos;, 608),
(&apos;England&apos;, 554),
(&apos;South Africa&apos;, 463),
(&apos;Zimbabwe&apos;, 394),
(&apos;Bangladesh&apos;, 251),
(&apos;Kenya&apos;, 114),
(&apos;Ireland&apos;, 93),
(&apos;Afghanistan&apos;, 50),
(&apos;Bermuda&apos;, 31),
(&apos;Netherlands&apos;, 31),
(&apos;Canada&apos;, 27)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Writing-a-data-function-to-return-countries-and-total-matches-played-in-sorted-order">Writing a data function to return countries and total matches played in sorted order<a class="anchor-link" href="#Writing-a-data-function-to-return-countries-and-total-matches-played-in-sorted-order">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[67]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">getNumMatchesPerCountry</span><span class="p">(</span> <span class="n">anRDD</span> <span class="p">):</span>
  <span class="k">return</span> <span class="n">anRDD</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">parseRecs</span><span class="p">(</span> <span class="n">rec</span><span class="p">)</span> <span class="p">)</span>          \
  <span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="p">(</span> <span class="n">rec</span><span class="o">.</span><span class="n">country</span> <span class="p">,</span> <span class="n">rec</span><span class="o">.</span><span class="n">matches</span><span class="p">)</span> <span class="p">)</span>         \
  <span class="o">.</span><span class="n">reduceByKey</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="p">)</span>                       \
  <span class="o">.</span><span class="n">sortBy</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="k">False</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Testing-the-Function:-getNumMatchesPerCountry">Testing the Function: <em>getNumMatchesPerCountry</em><a class="anchor-link" href="#Testing-the-Function:-getNumMatchesPerCountry">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[78]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">assert</span> <span class="n">getNumMatchesPerCountry</span><span class="p">(</span> <span class="n">test_input_rdd</span> <span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="s">&#39;New Zealand&#39;</span><span class="p">,</span> <span class="mi">262</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Invoking-the-Function">Invoking the Function<a class="anchor-link" href="#Invoking-the-Function">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[85]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">getNumMatchesPerCountry</span><span class="p">(</span> <span class="n">captains_odis</span> <span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[85]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Australia&apos;, 832),
(&apos;Pakistan&apos;, 781),
(&apos;India&apos;, 770),
(&apos;Sri Lanka&apos;, 710),
(&apos;West Indies&apos;, 658),
(&apos;New Zealand&apos;, 608),
(&apos;England&apos;, 554),
(&apos;South Africa&apos;, 463),
(&apos;Zimbabwe&apos;, 394),
(&apos;Bangladesh&apos;, 251)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Top-Baptains-by-Percentage-Wins">Top Baptains by Percentage Wins<a class="anchor-link" href="#Top-Baptains-by-Percentage-Wins">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[57]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Captains by percentage of wins</span>
<span class="n">captains_100_percent_wins</span> <span class="o">=</span> <span class="n">captains_100</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
  <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="p">(</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span> <span class="n">rec</span><span class="o">.</span><span class="n">won</span><span class="o">/</span><span class="n">rec</span><span class="o">.</span><span class="n">matches</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

<span class="c"># Sort by percentage wins</span>
<span class="n">captains_100_percent_wins</span><span class="o">.</span><span class="n">sortBy</span><span class="p">(</span>
  <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="k">False</span> <span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[57]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Ponting  R T&apos;, 0.72),
(&apos;Cronje  W J&apos;, 0.71),
(&apos;Richards  I V A&apos;, 0.64),
(&apos;Waugh  S R&apos;, 0.63),
(&apos;Smith  G C&apos;, 0.61),
(&apos;Wasim Akram&apos;, 0.61),
(&apos;Border  A R&apos;, 0.6),
(&apos;Jayasuriya  S T&apos;, 0.56),
(&apos;Dhoni  M S*&apos;, 0.55),
(&apos;Jayawardene  D P M&apos;, 0.55),
(&apos;Imran Khan&apos;, 0.54),
(&apos;Ganguly  S C&apos;, 0.52),
(&apos;Azharuddin  M&apos;, 0.51),
(&apos;Lara  B C&apos;, 0.47),
(&apos;Ranatunga  A&apos;, 0.46),
(&apos;Fleming  S P&apos;, 0.45)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Lucky-Captains">Lucky Captains<a class="anchor-link" href="#Lucky-Captains">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[65]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Captains by percentage of wins</span>
<span class="n">lucky_captains</span> <span class="o">=</span> <span class="n">captains_100</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
  <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="p">(</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span> <span class="n">rec</span><span class="o">.</span><span class="n">toss</span> <span class="o">/</span> <span class="n">rec</span><span class="o">.</span><span class="n">matches</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[66]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">lucky_captains</span><span class="o">.</span><span class="n">sortBy</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="k">False</span> <span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">5</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[66]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Azharuddin  M&apos;, 0.55),
(&apos;Ponting  R T&apos;, 0.54),
(&apos;Ranatunga  A&apos;, 0.53),
(&apos;Cronje  W J&apos;, 0.53),
(&apos;Wasim Akram&apos;, 0.53)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="For-further-explorations-for-the-readers-to-try-out">For further explorations for the readers to try out<a class="anchor-link" href="#For-further-explorations-for-the-readers-to-try-out">&#182;</a></h3><ul>
<li>Filter countries which have played more than hundred matches</li>
<li>Sort counties by the percentage of matches they have won</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Captain's-Test-Match-Performances">Captain's Test Match Performances<a class="anchor-link" href="#Captain's-Test-Match-Performances">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Loading-the-dataset">Loading the dataset<a class="anchor-link" href="#Loading-the-dataset">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[39]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Read the Captains_Test.csv file</span>
<span class="n">captains_tests</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span> <span class="s">&quot;file:///home/hadoop/lab/data/captains_Test.csv&quot;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[40]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Parse the records</span>
<span class="n">captains_tests_recs</span> <span class="o">=</span> <span class="n">captains_tests</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">parseRecs</span><span class="p">(</span> <span class="n">rec</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[41]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Display the first 10 records</span>
<span class="n">captains_tests_recs</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[41]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[Captain(name=&apos;Smith  G C&apos;, country=&apos;South Africa&apos;, career=&apos;2002-2014&apos;, matches=109, won=53, lost=29, ties=27, toss=58),
Captain(name=&apos;Border  A R&apos;, country=&apos;Australia&apos;, career=&apos;1978-1994&apos;, matches=93, won=32, lost=22, ties=38, toss=47),
Captain(name=&apos;Fleming  S P&apos;, country=&apos;New Zealand&apos;, career=&apos;1994-2008&apos;, matches=80, won=28, lost=27, ties=25, toss=38),
Captain(name=&apos;Ponting  R T&apos;, country=&apos;Australia&apos;, career=&apos;1995-2012&apos;, matches=77, won=48, lost=16, ties=13, toss=37),
Captain(name=&apos;Lloyd  C H&apos;, country=&apos;West Indies&apos;, career=&apos;1966-1984&apos;, matches=74, won=36, lost=12, ties=26, toss=35),
Captain(name=&apos;Dhoni  M S*&apos;, country=&apos;India&apos;, career=&apos;2005-&apos;, matches=60, won=27, lost=18, ties=15, toss=27),
Captain(name=&apos;Waugh  S R&apos;, country=&apos;Australia&apos;, career=&apos;1985-2004&apos;, matches=57, won=41, lost=9, ties=7, toss=31),
Captain(name=&apos;Ranatunga  A&apos;, country=&apos;Sri Lanka&apos;, career=&apos;1982-2000&apos;, matches=56, won=12, lost=19, ties=25, toss=29),
Captain(name=&apos;Atherton  M A&apos;, country=&apos;England&apos;, career=&apos;1989-2001&apos;, matches=54, won=13, lost=21, ties=20, toss=23),
Captain(name=&apos;Cronje  W J&apos;, country=&apos;South Africa&apos;, career=&apos;1992-2000&apos;, matches=53, won=27, lost=11, ties=15, toss=22)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[42]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Filter the captains who have captained for more than 100 tests</span>
<span class="n">captains_tests_100</span> <span class="o">=</span> <span class="n">captains_tests_recs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                              <span class="n">rec</span><span class="o">.</span><span class="n">matches</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[63]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c">## How many captains?</span>
<span class="n">captains_tests_100</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[63]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[Captain(name=&apos;Smith  G C&apos;, country=&apos;South Africa&apos;, career=&apos;2002-2014&apos;, matches=109, won=53, lost=29, ties=27, toss=58)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Note:">Note:<a class="anchor-link" href="#Note:">&#182;</a></h4><ul>
<li>There is only one captain who has captained more then 100 tests</li>
<li>So, we must lower the number of matches to look at more captains performance. We will filter out all captains who have played more than 50 matches.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[64]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Filter the captains who have captained for more than 50 tests</span>
<span class="n">captains_tests_50</span> <span class="o">=</span> <span class="n">captains_tests_recs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                             <span class="n">rec</span><span class="o">.</span><span class="n">matches</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[35]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">captains_tests_50</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[35]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[Captain(name=&apos;Smith  G C&apos;, country=&apos;South Africa&apos;, career=&apos;2002-2014&apos;, matches=109, won=53, lost=29, ties=27, toss=58),
Captain(name=&apos;Border  A R&apos;, country=&apos;Australia&apos;, career=&apos;1978-1994&apos;, matches=93, won=32, lost=22, ties=38, toss=47),
Captain(name=&apos;Fleming  S P&apos;, country=&apos;New Zealand&apos;, career=&apos;1994-2008&apos;, matches=80, won=28, lost=27, ties=25, toss=38),
Captain(name=&apos;Ponting  R T&apos;, country=&apos;Australia&apos;, career=&apos;1995-2012&apos;, matches=77, won=48, lost=16, ties=13, toss=37),
Captain(name=&apos;Lloyd  C H&apos;, country=&apos;West Indies&apos;, career=&apos;1966-1984&apos;, matches=74, won=36, lost=12, ties=26, toss=35),
Captain(name=&apos;Dhoni  M S*&apos;, country=&apos;India&apos;, career=&apos;2005-&apos;, matches=60, won=27, lost=18, ties=15, toss=27),
Captain(name=&apos;Waugh  S R&apos;, country=&apos;Australia&apos;, career=&apos;1985-2004&apos;, matches=57, won=41, lost=9, ties=7, toss=31),
Captain(name=&apos;Ranatunga  A&apos;, country=&apos;Sri Lanka&apos;, career=&apos;1982-2000&apos;, matches=56, won=12, lost=19, ties=25, toss=29),
Captain(name=&apos;Atherton  M A&apos;, country=&apos;England&apos;, career=&apos;1989-2001&apos;, matches=54, won=13, lost=21, ties=20, toss=23),
Captain(name=&apos;Cronje  W J&apos;, country=&apos;South Africa&apos;, career=&apos;1992-2000&apos;, matches=53, won=27, lost=11, ties=15, toss=22)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Calculating-the-test-percentage-wins">Calculating the test percentage wins<a class="anchor-link" href="#Calculating-the-test-percentage-wins">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[36]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Sort the captains by percentage of wins</span>
<span class="n">captain_top</span> <span class="o">=</span> <span class="n">captains_tests_50</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
  <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="p">(</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
               <span class="nb">round</span><span class="p">(</span> <span class="n">rec</span><span class="o">.</span><span class="n">won</span><span class="o">/</span><span class="n">rec</span><span class="o">.</span><span class="n">matches</span><span class="p">,</span>
                     <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">sortBy</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="k">False</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[37]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">captain_top</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[37]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Waugh  S R&apos;, 0.72),
(&apos;Ponting  R T&apos;, 0.62),
(&apos;Cronje  W J&apos;, 0.51),
(&apos;Vaughan  M P&apos;, 0.51),
(&apos;Smith  G C&apos;, 0.49),
(&apos;Lloyd  C H&apos;, 0.49),
(&apos;Dhoni  M S*&apos;, 0.45),
(&apos;Fleming  S P&apos;, 0.35),
(&apos;Border  A R&apos;, 0.34),
(&apos;Atherton  M A&apos;, 0.24),
(&apos;Ranatunga  A&apos;, 0.21)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Joining-multiple-data-sets">Joining multiple data sets<a class="anchor-link" href="#Joining-multiple-data-sets">&#182;</a></h3><ul>
<li>Now let's join both ODI and Test performances and verify their efficiency. </li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[38]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Lets join both ODI and Test captaincy details. </span>
<span class="c"># Default is inner join...</span>
<span class="n">all_time_best_captains</span> <span class="o">=</span> <span class="n">captains_100_percent_wins</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">captain_top</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[39]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">all_time_best_captains</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[39]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Smith  G C&apos;, (0.61, 0.49)),
(&apos;Border  A R&apos;, (0.6, 0.34)),
(&apos;Fleming  S P&apos;, (0.45, 0.35)),
(&apos;Cronje  W J&apos;, (0.71, 0.51)),
(&apos;Ponting  R T&apos;, (0.72, 0.62)),
(&apos;Ranatunga  A&apos;, (0.46, 0.21)),
(&apos;Dhoni  M S*&apos;, (0.55, 0.45)),
(&apos;Waugh  S R&apos;, (0.63, 0.72))]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[40]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c">## Best by test match wins</span>
<span class="n">all_time_best_captains</span><span class="o">.</span><span class="n">sortBy</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">ascending</span> <span class="o">=</span> <span class="k">False</span> <span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[40]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Waugh  S R&apos;, (0.63, 0.72)),
(&apos;Ponting  R T&apos;, (0.72, 0.62)),
(&apos;Cronje  W J&apos;, (0.71, 0.51)),
(&apos;Smith  G C&apos;, (0.61, 0.49)),
(&apos;Dhoni  M S*&apos;, (0.55, 0.45)),
(&apos;Fleming  S P&apos;, (0.45, 0.35)),
(&apos;Border  A R&apos;, (0.6, 0.34)),
(&apos;Ranatunga  A&apos;, (0.46, 0.21))]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[41]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c">## Best by ODI match wins</span>
<span class="n">all_time_best_captains</span><span class="o">.</span><span class="n">sortBy</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                            <span class="n">ascending</span> <span class="o">=</span> <span class="k">False</span> <span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[41]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Ponting  R T&apos;, (0.72, 0.62)),
(&apos;Cronje  W J&apos;, (0.71, 0.51)),
(&apos;Waugh  S R&apos;, (0.63, 0.72)),
(&apos;Smith  G C&apos;, (0.61, 0.49)),
(&apos;Border  A R&apos;, (0.6, 0.34)),
(&apos;Dhoni  M S*&apos;, (0.55, 0.45)),
(&apos;Ranatunga  A&apos;, (0.46, 0.21)),
(&apos;Fleming  S P&apos;, (0.45, 0.35))]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Flattening-the-tuples">Flattening the tuples<a class="anchor-link" href="#Flattening-the-tuples">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[42]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c">## Now let&#39;s flatten the structure and store the results into a file...</span>
<span class="n">best_captains</span> <span class="o">=</span> <span class="n">all_time_best_captains</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                         <span class="p">(</span> <span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                          <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                          <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">best_captains</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[42]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Smith  G C&apos;, 0.61, 0.49),
(&apos;Border  A R&apos;, 0.6, 0.34),
(&apos;Fleming  S P&apos;, 0.45, 0.35),
(&apos;Cronje  W J&apos;, 0.71, 0.51),
(&apos;Ponting  R T&apos;, 0.72, 0.62),
(&apos;Ranatunga  A&apos;, 0.46, 0.21),
(&apos;Dhoni  M S*&apos;, 0.55, 0.45),
(&apos;Waugh  S R&apos;, 0.63, 0.72)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Saving-results-into-filesystem">Saving results into filesystem<a class="anchor-link" href="#Saving-results-into-filesystem">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[43]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">best_captains</span><span class="o">.</span><span class="n">saveAsTextFile</span><span class="p">(</span> <span class="s">&quot;file:///home/hadoop/lab/results/captains&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Check-results">Check results<a class="anchor-link" href="#Check-results">&#182;</a></h3><ul>
<li>Go to you VM's putty terminal and go to the results directory<ul>
<li>cd /home/hadoop/lab/results/captains/</li>
<li>cat part-0000</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Saving-results-into-one-file.-Forcing-the-bring-all-results-into-one-partition">Saving results into one file. Forcing the bring all results into one partition<a class="anchor-link" href="#Saving-results-into-one-file.-Forcing-the-bring-all-results-into-one-partition">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[44]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c">## Consolidate into one partition</span>
<span class="n">best_captains</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span><span class="o">.</span>                                     \
  <span class="n">saveAsTextFile</span><span class="p">(</span> <span class="s">&quot;file:///home/hadoop/lab/results/bestcaptains&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Check-results">Check results<a class="anchor-link" href="#Check-results">&#182;</a></h3><ul>
<li>Go to you VM's putty terminal and go to the results directory<ul>
<li>cd /home/hadoop/lab/results/bestcaptains/</li>
<li>cat part-00000</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Exercises">Exercises<a class="anchor-link" href="#Exercises">&#182;</a></h2><h3 id="Sorting-countries-by-percentage-wins">Sorting countries by percentage wins<a class="anchor-link" href="#Sorting-countries-by-percentage-wins">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>We have multiple elements in the value part of (key, value) tuple. So, we can not invoke reduce by key function. We will call groupByKey() and then map each element of values to sum. And then divide the total wins by total matches to get percentage wins.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Generate-the-key-and-values">Generate the key and values<a class="anchor-link" href="#Generate-the-key-and-values">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[107]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">country_matches_list</span> <span class="o">=</span> <span class="n">captains</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="p">(</span> <span class="n">rec</span><span class="o">.</span><span class="n">country</span> <span class="p">,</span> <span class="p">(</span> <span class="n">rec</span><span class="o">.</span><span class="n">won</span><span class="p">,</span> <span class="n">rec</span><span class="o">.</span><span class="n">matches</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[108]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">country_matches_list</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">5</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[108]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Australia&apos;, (165, 230)),
(&apos;New Zealand&apos;, (98, 218)),
(&apos;Sri Lanka&apos;, (89, 193)),
(&apos;India&apos;, (103, 186)),
(&apos;Australia&apos;, (107, 178))]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Group-the-values">Group the values<a class="anchor-link" href="#Group-the-values">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[109]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">country_matches_list</span><span class="o">.</span><span class="n">groupByKey</span><span class="p">()</span><span class="o">.</span><span class="n">mapValues</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span> <span class="n">rec</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">2</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[109]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Pakistan&apos;,
[(75, 139),
 (66, 109),
 (52, 89),
 (45, 87),
 (26, 62),
 (37, 62),
 (19, 38),
 (24, 36),
 (20, 34),
 (21, 34),
 (13, 25),
 (9, 22),
 (7, 22),
 (8, 22)]),
(&apos;South Africa&apos;, [(91, 149), (99, 140), (60, 98), (44, 76)])]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Apply-sum()-to-each-element-of-values-tuple">Apply sum() to each element of values tuple<a class="anchor-link" href="#Apply-sum()-to-each-element-of-values-tuple">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[100]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">getWinMatchPercentage</span><span class="p">(</span> <span class="n">allrecs</span> <span class="p">):</span>
  <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span> <span class="p">[</span><span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">allrecs</span><span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span> <span class="n">allrecs</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[111]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">country_matches_rdd</span> <span class="o">=</span> <span class="n">country_matches_list</span><span class="o">.</span><span class="n">groupByKey</span><span class="p">()</span><span class="o">.</span><span class="n">mapValues</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                          <span class="p">(</span> <span class="nb">sum</span><span class="p">(</span> <span class="p">[</span><span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">rec</span><span class="p">]</span> <span class="p">),</span>
                                            <span class="nb">sum</span><span class="p">(</span> <span class="p">[</span><span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">rec</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[112]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">country_matches_rdd</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[112]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Pakistan&apos;, (422, 781)),
(&apos;South Africa&apos;, (294, 463)),
(&apos;Ireland&apos;, (42, 93)),
(&apos;Australia&apos;, (503, 832)),
(&apos;West Indies&apos;, (342, 658)),
(&apos;Kenya&apos;, (34, 114)),
(&apos;India&apos;, (387, 770)),
(&apos;Bermuda&apos;, (6, 31)),
(&apos;Netherlands&apos;, (10, 31)),
(&apos;Afghanistan&apos;, (25, 50))]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Get-percentage-wins">Get percentage wins<a class="anchor-link" href="#Get-percentage-wins">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[119]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">most_win_countries</span> <span class="o">=</span> <span class="n">country_matches_rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                           <span class="p">(</span> <span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                            <span class="nb">round</span><span class="p">(</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span>  <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>     \
                                      <span class="o">.</span><span class="n">sortBy</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="k">False</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[120]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">most_win_countries</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[120]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;South Africa&apos;, 0.63),
(&apos;Australia&apos;, 0.6),
(&apos;Pakistan&apos;, 0.54),
(&apos;West Indies&apos;, 0.52),
(&apos;India&apos;, 0.5),
(&apos;Afghanistan&apos;, 0.5),
(&apos;England&apos;, 0.5),
(&apos;Sri Lanka&apos;, 0.49),
(&apos;Ireland&apos;, 0.45),
(&apos;New Zealand&apos;, 0.45)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Broadcasting-Variables">Broadcasting Variables<a class="anchor-link" href="#Broadcasting-Variables">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[124]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">getNumCaptainsByMinimumMatches</span><span class="p">(</span> <span class="n">anRDD</span><span class="p">,</span> <span class="n">num_matches</span> <span class="p">):</span>
  <span class="n">min_matches</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span> <span class="n">num_matches</span> <span class="p">)</span>
  <span class="k">return</span> <span class="n">anRDD</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">parseRecs</span><span class="p">(</span> <span class="n">rec</span><span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="o">.</span><span class="n">matches</span> <span class="o">&gt;</span> <span class="n">min_matches</span><span class="o">.</span><span class="n">value</span> <span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[126]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">getNumCaptainsByMinimumMatches</span><span class="p">(</span> <span class="n">captains_odis</span><span class="p">,</span> <span class="mi">100</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[126]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>16</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[128]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">getNumCaptainsByMinimumMatches</span><span class="p">(</span> <span class="n">captains_odis</span><span class="p">,</span> <span class="mi">50</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[128]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>48</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Accumulators">Accumulators<a class="anchor-link" href="#Accumulators">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[179]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">parRecsNew</span><span class="p">(</span> <span class="n">line</span> <span class="p">):</span>
  <span class="k">global</span> <span class="n">playing_caps</span>
  <span class="k">if</span> <span class="s">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
     <span class="n">playing_caps</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="k">return</span> <span class="n">parseRecs</span><span class="p">(</span> <span class="n">line</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[180]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">playing_caps</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">accumulator</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[181]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">captains_odis_new</span> <span class="o">=</span> <span class="n">captains_odis</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">parRecsNew</span><span class="p">(</span> <span class="n">line</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[182]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">captains_odis_new</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[182]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>98</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[183]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">playing_caps</span><span class="o">.</span><span class="n">value</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[183]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>27</pre>
</div>

</div>

</div>
</div>

</div>
  </div>
</div>

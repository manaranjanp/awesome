---
layout: post
title: "Segmenting customers based on their RFM Values"
date: 2017-05-23
description: "Clustering using kmean algorithm"
main-class: 'spark'
published: true
postbook: 'inotebook'
color: '#7AAB13'
tags:
- spark
- RDD
- kmean
- 'RFM Analysis'
categories:
- spark
introduction: "Using clustering algorithm to segement custtomer based on their RFM values"
---

<div tabindex="-1" id="notebook" class="border-box-sizing">
  <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><strong>RFM</strong> is a method used for analyzing customer value. It is commonly used in marketing and has wide spread applications in retail industries.</li>
<li>RFM stands for</p>
<ul>
<li><strong>Recency</strong> – How recently did the customer purchase?</li>
<li><strong>Frequency</strong> – How often do they purchase?</li>
<li><strong>Monetary Value</strong> – How much do they spend?</li>
</ul>
</li>
<li>This tutorial will analyzie the retail <a href="http://archive.ics.uci.edu/ml/datasets/online+retail">dataset</a> available in UCI repository to</p>
<ul>
<li>Calculate the RFM values for each customer (by customer id).</li>
<li>For Recency calculation, use most recent transaction date as current date. So, the recency should be how many days before he or she has made a purchase from that date.</li>
<li>Find top 10 customers based on frequency and monetary value. Sort them based on first frequency and then monetary value.</li>
<li>Based on the RFM value of each customer, create customer segments. Develop a k-means algorithm using map reduce approach. Use Euclidean distance for allocations.</li>
<li>Find optimal number of segments using dendogram and elbow method.</li>
<li>Create final segment of customers and label the customers based on which segment they belong to. Explain each segment intuitively. </li>
<li>Use the Spark ML Clustering algorithm and compare your results with your own algorithm. How many wrong allocations to each segment.</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[61]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="k">import</span> <span class="n">SQLContext</span>
<span class="n">sqlContext</span> <span class="o">=</span> <span class="n">SQLContext</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Load-the-dataset">Load the dataset<a class="anchor-link" href="#Load-the-dataset">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[62]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">retail_df</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;com.databricks.spark.csv&quot;</span><span class="p">)</span>        \
        <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="k">True</span><span class="p">,</span> <span class="n">inferSchema</span> <span class="o">=</span> <span class="k">True</span><span class="p">)</span>  \
        <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;file:///home/hadoop/lab/data/Online Retail.csv&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[63]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">retail_df</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[63]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>DataFrame[InvoiceNo: string, StockCode: string, Description: string, Quantity: int, InvoiceDate: string, UnitPrice: double, CustomerID: int, Country: string]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[64]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">retail_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+---------+---------+--------------------+--------+------------+---------+----------+--------------+
|InvoiceNo|StockCode|         Description|Quantity| InvoiceDate|UnitPrice|CustomerID|       Country|
+---------+---------+--------------------+--------+------------+---------+----------+--------------+
|   536365|   85123A|WHITE HANGING HEA...|       6|12/1/10 8:26|     2.55|     17850|United Kingdom|
|   536365|    71053| WHITE METAL LANTERN|       6|12/1/10 8:26|     3.39|     17850|United Kingdom|
|   536365|   84406B|CREAM CUPID HEART...|       8|12/1/10 8:26|     2.75|     17850|United Kingdom|
|   536365|   84029G|KNITTED UNION FLA...|       6|12/1/10 8:26|     3.39|     17850|United Kingdom|
|   536365|   84029E|RED WOOLLY HOTTIE...|       6|12/1/10 8:26|     3.39|     17850|United Kingdom|
|   536365|    22752|SET 7 BABUSHKA NE...|       2|12/1/10 8:26|     7.65|     17850|United Kingdom|
|   536365|    21730|GLASS STAR FROSTE...|       6|12/1/10 8:26|     4.25|     17850|United Kingdom|
|   536366|    22633|HAND WARMER UNION...|       6|12/1/10 8:28|     1.85|     17850|United Kingdom|
|   536366|    22632|HAND WARMER RED P...|       6|12/1/10 8:28|     1.85|     17850|United Kingdom|
|   536367|    84879|ASSORTED COLOUR B...|      32|12/1/10 8:34|     1.69|     13047|United Kingdom|
+---------+---------+--------------------+--------+------------+---------+----------+--------------+
only showing top 10 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-many-records?">How many records?<a class="anchor-link" href="#How-many-records?">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[65]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">num_recs</span> <span class="o">=</span> <span class="n">retail_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[66]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">num_recs</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[66]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>541909</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[67]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">retail_df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>root
|-- InvoiceNo: string (nullable = true)
|-- StockCode: string (nullable = true)
|-- Description: string (nullable = true)
|-- Quantity: integer (nullable = true)
|-- InvoiceDate: string (nullable = true)
|-- UnitPrice: double (nullable = true)
|-- CustomerID: integer (nullable = true)
|-- Country: string (nullable = true)

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Find-out-how-many-null-values-in-each-column?">Find out how many null values in each column?<a class="anchor-link" href="#Find-out-how-many-null-values-in-each-column?">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[68]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="k">import</span> <span class="n">count</span>

<span class="n">sc</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span> <span class="n">num_recs</span> <span class="p">)</span>

<span class="n">retail_df</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span> <span class="o">*</span><span class="p">[</span> <span class="n">count</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">retail_df</span><span class="o">.</span><span class="n">columns</span> <span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+---------+---------+-----------+--------+-----------+---------+----------+-------+
|InvoiceNo|StockCode|Description|Quantity|InvoiceDate|UnitPrice|CustomerID|Country|
+---------+---------+-----------+--------+-----------+---------+----------+-------+
|   541909|   541909|     541909|  541909|     541909|   541909|    406829| 541909|
+---------+---------+-----------+--------+-----------+---------+----------+-------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Note:">Note:<a class="anchor-link" href="#Note:">&#182;</a></h3><ul>
<li>Quite a few customerIDs are not present and are null values. We can drop these records from the analysis.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Drop-NA-values-from-dataset">Drop NA values from dataset<a class="anchor-link" href="#Drop-NA-values-from-dataset">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[69]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">retail_df</span> <span class="o">=</span> <span class="n">retail_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s">&#39;any&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[70]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">retail_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[70]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>406829</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Note:">Note:<a class="anchor-link" href="#Note:">&#182;</a></h3><ul>
<li>Final dataset now contains <strong>406829</strong> records.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Adding-total-price-column">Adding total price column<a class="anchor-link" href="#Adding-total-price-column">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Each transaction record contains unit price and quantity bought. We can introduce a new column of TotalPrice, which will be required for further analysis.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[71]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="k">import</span> <span class="nb">round</span>

<span class="n">retail_df</span> <span class="o">=</span> <span class="n">retail_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s">&#39;TotalPrice&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span> <span class="n">retail_df</span><span class="o">.</span><span class="n">Quantity</span> <span class="o">*</span> <span class="n">retail_df</span><span class="o">.</span><span class="n">UnitPrice</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Convert-all-timestamps-into-dd/MM/yy-HH:mm-format">Convert all timestamps into <em>dd/MM/yy HH:mm</em> format<a class="anchor-link" href="#Convert-all-timestamps-into-dd/MM/yy-HH:mm-format">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[72]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="k">import</span> <span class="n">to_utc_timestamp</span><span class="p">,</span> <span class="n">unix_timestamp</span><span class="p">,</span> <span class="n">lit</span><span class="p">,</span> <span class="n">datediff</span><span class="p">,</span> <span class="n">col</span>

<span class="n">retail_df</span> <span class="o">=</span> <span class="n">retail_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s">&#39;NewInvoiceDate&#39;</span><span class="p">,</span>
                               <span class="n">to_utc_timestamp</span><span class="p">(</span><span class="n">unix_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">&#39;InvoiceDate&#39;</span><span class="p">),</span>
                                          <span class="s">&quot;dd/MM/yy HH:mm&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s">&#39;timestamp&#39;</span><span class="p">),</span> <span class="s">&#39;UTC&#39;</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[73]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">retail_df</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[73]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>DataFrame[InvoiceNo: string, StockCode: string, Description: string, Quantity: int, InvoiceDate: string, UnitPrice: double, CustomerID: int, Country: string, TotalPrice: double, NewInvoiceDate: timestamp]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[74]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">retail_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+---------+---------+--------------------+--------+------------+---------+----------+--------------+----------+--------------------+
|InvoiceNo|StockCode|         Description|Quantity| InvoiceDate|UnitPrice|CustomerID|       Country|TotalPrice|      NewInvoiceDate|
+---------+---------+--------------------+--------+------------+---------+----------+--------------+----------+--------------------+
|   536365|   85123A|WHITE HANGING HEA...|       6|12/1/10 8:26|     2.55|     17850|United Kingdom|      15.3|2010-01-12 08:26:...|
|   536365|    71053| WHITE METAL LANTERN|       6|12/1/10 8:26|     3.39|     17850|United Kingdom|     20.34|2010-01-12 08:26:...|
|   536365|   84406B|CREAM CUPID HEART...|       8|12/1/10 8:26|     2.75|     17850|United Kingdom|      22.0|2010-01-12 08:26:...|
|   536365|   84029G|KNITTED UNION FLA...|       6|12/1/10 8:26|     3.39|     17850|United Kingdom|     20.34|2010-01-12 08:26:...|
|   536365|   84029E|RED WOOLLY HOTTIE...|       6|12/1/10 8:26|     3.39|     17850|United Kingdom|     20.34|2010-01-12 08:26:...|
+---------+---------+--------------------+--------+------------+---------+----------+--------------+----------+--------------------+
only showing top 5 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Calculate-RFM-attributes-for-each-customer">Calculate RFM attributes for each customer<a class="anchor-link" href="#Calculate-RFM-attributes-for-each-customer">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>RFM Represents</p>
<ul>
<li>R (Recency)</li>
<li>F (Frequency)</li>
<li>M (Monetary Value)</li>
</ul>
</li>
<li>Detailed description of these attributes are described <a href="https://en.wikipedia.org/wiki/RFM_%28customer_value%29">here</a></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Most-recent-transaction-date">Most recent transaction date<a class="anchor-link" href="#Most-recent-transaction-date">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[302]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="k">import</span> <span class="n">mean</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="nb">sum</span>

<span class="n">retail_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span> <span class="s">&#39;NewInvoiceDate&#39;</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+--------------------+
| max(NewInvoiceDate)|
+--------------------+
|2013-07-10 17:13:...|
+--------------------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For calculating recency, we will assume current date as <strong>30/07/2013</strong>. The recency value will be how recently the customer bought with respect to <strong>30/07/2013</strong> date.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Calculate-Recency">Calculate Recency<a class="anchor-link" href="#Calculate-Recency">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[303]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">current_ts</span> <span class="o">=</span> <span class="n">to_utc_timestamp</span><span class="p">(</span> <span class="n">unix_timestamp</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="s">&#39;30/07/2013 00:00&#39;</span><span class="p">),</span> \
                              <span class="s">&quot;dd/MM/yy HH:mm&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s">&#39;timestamp&#39;</span><span class="p">),</span> <span class="s">&#39;UTC&#39;</span> <span class="p">)</span>

<span class="c"># Calculatre Recency value</span>
<span class="n">retail_df</span> <span class="o">=</span> <span class="n">retail_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s">&#39;DaysBefore&#39;</span><span class="p">,</span> <span class="n">datediff</span><span class="p">(</span> <span class="n">lit</span><span class="p">(</span><span class="n">current_ts</span><span class="p">),</span> <span class="s">&#39;NewInvoiceDate&#39;</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">recency_df</span> <span class="o">=</span> <span class="n">retail_df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s">&#39;CustomerID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="s">&#39;DaysBefore&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;Recency&#39;</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[304]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">recency_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">5</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+----------+-------+
|CustomerID|Recency|
+----------+-------+
|     12431|     25|
|     14031|     27|
|     13831|    235|
|     17231|    141|
|     15831|    394|
+----------+-------+
only showing top 5 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Calculate-Frequency">Calculate Frequency<a class="anchor-link" href="#Calculate-Frequency">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>First group all invoices by the line items and then count the number of invoices by each customer.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[305]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">frequency_df</span> <span class="o">=</span> <span class="n">retail_df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s">&#39;CustomerID&#39;</span><span class="p">,</span> <span class="s">&#39;InvoiceNo&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>  \
                      <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s">&#39;CustomerID&#39;</span><span class="p">)</span>                       \
                      <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;Frequency&quot;</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[306]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">frequency_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">5</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+----------+---------+
|CustomerID|Frequency|
+----------+---------+
|     14031|       23|
|     18231|        6|
|     14431|        2|
|     13631|       12|
|     12431|       18|
+----------+---------+
only showing top 5 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[307]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">monetary_df</span> <span class="o">=</span> <span class="n">retail_df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s">&#39;CustomerID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span> <span class="nb">sum</span><span class="p">(</span><span class="s">&#39;TotalPrice&#39;</span><span class="p">),</span> <span class="mi">2</span> <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;Monetary&#39;</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[81]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">monetary_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">5</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+----------+--------+
|CustomerID|Monetary|
+----------+--------+
|     12431| 6416.39|
|     14031|14634.64|
|     13831| 2202.99|
|     17231| 3127.82|
|     15831|  747.76|
+----------+--------+
only showing top 5 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Joining-RFM-values-by-customer-ID">Joining RFM values by customer ID<a class="anchor-link" href="#Joining-RFM-values-by-customer-ID">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[82]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">mf_df</span> <span class="o">=</span> <span class="n">monetary_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">frequency_df</span><span class="p">,</span>                              \
      <span class="n">monetary_df</span><span class="o">.</span><span class="n">CustomerID</span> <span class="o">==</span> <span class="n">frequency_df</span><span class="o">.</span><span class="n">CustomerID</span><span class="p">,</span> <span class="s">&#39;inner&#39;</span><span class="p">)</span> \
      <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">frequency_df</span><span class="o">.</span><span class="n">CustomerID</span><span class="p">)</span>

<span class="n">rfm_df</span> <span class="o">=</span>  <span class="n">mf_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">recency_df</span><span class="p">,</span>                              \
        <span class="n">recency_df</span><span class="o">.</span><span class="n">CustomerID</span> <span class="o">==</span> <span class="n">mf_df</span><span class="o">.</span><span class="n">CustomerID</span><span class="p">,</span> <span class="s">&#39;inner&#39;</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">recency_df</span><span class="o">.</span><span class="n">CustomerID</span><span class="p">)</span>

<span class="n">rfm_df</span> <span class="o">=</span> <span class="n">rfm_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span> <span class="s">&#39;CustomerID&#39;</span><span class="p">,</span> <span class="s">&#39;Recency&#39;</span><span class="p">,</span> <span class="s">&#39;Frequency&#39;</span><span class="p">,</span> <span class="s">&#39;Monetary&#39;</span> <span class="p">)</span>
<span class="n">rfm_df</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[82]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>DataFrame[CustomerID: int, Recency: int, Frequency: bigint, Monetary: double]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[83]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">rfm_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+----------+-------+---------+--------+
|CustomerID|Recency|Frequency|Monetary|
+----------+-------+---------+--------+
|     12431|     25|       18| 6416.39|
|     12631|    567|        1|   640.5|
|     12831|    300|        1|  215.05|
|     13431|    599|        2|  1269.1|
|     13631|    114|       12| 3021.77|
|     13831|    235|        6| 2202.99|
|     14031|     27|       23|14634.64|
|     14231|    240|        5|  822.06|
|     14431|    544|        2|  397.76|
|     14631|    354|        3| 1006.98|
|     15031|    325|        4|  668.14|
|     15831|    394|        4|  747.76|
|     16031|    721|        2|  548.94|
|     16431|    515|        3|  642.81|
|     17031|    110|        2|  380.35|
|     17231|    141|       14| 3127.82|
|     17431|     59|        1|   403.3|
|     17631|    204|        3|  528.33|
|     17831|    780|        1|    35.4|
|     18231|     25|        6| 2066.17|
+----------+-------+---------+--------+
only showing top 20 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Top-10-customers-based-on-frequency">Top 10 customers based on frequency<a class="anchor-link" href="#Top-10-customers-based-on-frequency">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[84]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="k">import</span> <span class="n">desc</span>

<span class="n">top_frequencies</span> <span class="o">=</span> <span class="n">rfm_df</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="s">&#39;Frequency&#39;</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[85]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">top_frequencies</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+----------+-------+---------+---------+
|CustomerID|Recency|Frequency| Monetary|
+----------+-------+---------+---------+
|     14911|     20|      248|132572.62|
|     12748|     23|      224|  29072.1|
|     17841|     20|      169| 40340.78|
|     14606|     49|      128| 11713.85|
|     15311|     80|      118| 59419.34|
|     13089|     22|      118| 57385.88|
|     12971|     50|       89| 10930.26|
|     14527|     20|       86|  7711.38|
|     13408|     22|       81| 27487.41|
|     14646|     22|       77|279489.02|
+----------+-------+---------+---------+
only showing top 10 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Top10-cutomers-by-monetary-values">Top10 cutomers by monetary values<a class="anchor-link" href="#Top10-cutomers-by-monetary-values">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[86]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">top_monetary</span> <span class="o">=</span> <span class="n">rfm_df</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="s">&#39;Monetary&#39;</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[87]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">top_monetary</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+----------+-------+---------+---------+
|CustomerID|Recency|Frequency| Monetary|
+----------+-------+---------+---------+
|     14646|     22|       77|279489.02|
|     18102|    110|       62|256438.49|
|     17450|     20|       55|187482.17|
|     14911|     20|      248|132572.62|
|     12415|    117|       26|123725.45|
|     14156|     23|       66|113384.14|
|     17511|     88|       46| 88125.38|
|     16684|     84|       31| 65892.08|
|     13694|     22|       60|  62653.1|
|     15311|     80|      118| 59419.34|
+----------+-------+---------+---------+
only showing top 10 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Creating-Vectors">Creating Vectors<a class="anchor-link" href="#Creating-Vectors">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[88]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.mllib.feature</span> <span class="k">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">pyspark.mllib.linalg</span> <span class="k">import</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">DenseVector</span><span class="p">,</span> <span class="n">Vectors</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[89]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_labels</span> <span class="o">=</span> <span class="n">rfm_df</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="p">[</span><span class="s">&#39;CustomerID&#39;</span><span class="p">]</span> <span class="p">)</span>

<span class="n">customer_vecs</span> <span class="o">=</span> <span class="n">rfm_df</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s">&#39;Recency&#39;</span><span class="p">],</span> \
                                                <span class="n">rec</span><span class="p">[</span><span class="s">&#39;Monetary&#39;</span><span class="p">],</span>        \
                                                <span class="n">rec</span><span class="p">[</span><span class="s">&#39;Frequency&#39;</span><span class="p">])</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Standardizing-Vectors">Standardizing Vectors<a class="anchor-link" href="#Standardizing-Vectors">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[90]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">standardizer</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">(</span> <span class="k">True</span><span class="p">,</span> <span class="k">True</span> <span class="p">)</span>
<span class="n">standardized_model</span> <span class="o">=</span> <span class="n">standardizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">customer_vecs</span> <span class="p">)</span>
<span class="n">customer_data</span> <span class="o">=</span> <span class="n">customer_labels</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span> <span class="n">standardized_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span> <span class="n">customer_vecs</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">customer_data</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[90]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>org.apache.spark.api.java.JavaPairRDD@25010869</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Clustering-using-Map-Reduce-Approach">Clustering using Map Reduce Approach<a class="anchor-link" href="#Clustering-using-Map-Reduce-Approach">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Randomly-selecting-cluster-centers">Randomly selecting cluster centers<a class="anchor-link" href="#Randomly-selecting-cluster-centers">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>We will assume there are 3 clusters. And we will take 3 random points from the sample as initial cluster points and then iteratively find the optimal cluster points.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[91]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_rfm_vals</span> <span class="o">=</span> <span class="n">customer_data</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">customer_rfm_vals</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[91]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>PythonRDD[492] at RDD at PythonRDD.scala:43</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[92]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_rfm_vals</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[92]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[DenseVector([-1.1234, 0.5497, 1.384]),
DenseVector([0.8347, -0.153, -0.4364]),
DenseVector([-0.1299, -0.2048, -0.4364]),
DenseVector([0.9503, -0.0766, -0.3293]),
DenseVector([-0.8019, 0.1367, 0.7415])]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Randomly-select-some-points">Randomly select some points<a class="anchor-link" href="#Randomly-select-some-points">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[93]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">num_clusters</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c"># initial cluster centers</span>
<span class="n">cluster_centroid</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c"># Randomly select as many points as there are clusters...</span>
<span class="n">cluster_centroids</span> <span class="o">=</span> <span class="n">customer_rfm_vals</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span> <span class="k">False</span><span class="p">,</span>
                                      <span class="mf">0.001</span><span class="p">,</span>
                                      <span class="n">seed</span><span class="o">=</span><span class="mi">12345</span> <span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="n">num_clusters</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Take-top-three-points-as-initial-clusters-centers">Take top three points as initial clusters centers<a class="anchor-link" href="#Take-top-three-points-as-initial-clusters-centers">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[94]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">cluster_centroids</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[94]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[DenseVector([-0.596, -0.1053, -0.4364]),
DenseVector([2.1786, -0.2148, -0.4364]),
DenseVector([2.9193, -0.2319, -0.4364])]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Define-a-function-to-allocate-a-point-to-a-cluster-center">Define a function to allocate a point to a cluster center<a class="anchor-link" href="#Define-a-function-to-allocate-a-point-to-a-cluster-center">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>It calculates the euclidean distance between the point and cluster centers and return the label of the cluster to which the point has minimum distance.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[95]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="k">import</span> <span class="n">euclidean_distances</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">assign_to_cluster</span><span class="p">(</span> <span class="n">point</span><span class="p">,</span> <span class="n">cluster_centers</span> <span class="p">):</span>
  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span> <span class="n">euclidean_distances</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">point</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                        <span class="n">cluster_centers</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Testing-the-function">Testing the function<a class="anchor-link" href="#Testing-the-function">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Checking if the third cluster point is allocated to third cluster or not</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[96]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">assert</span><span class="p">(</span> <span class="n">assign_to_cluster</span><span class="p">(</span> <span class="n">cluster_centroids</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cluster_centroids</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Define-a-function-to-calculate-shift-in-cluster-centers">Define a function to calculate shift in cluster centers<a class="anchor-link" href="#Define-a-function-to-calculate-shift-in-cluster-centers">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Function which returns the distance to the nearest cluster</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[97]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">get_nearest_cluster_dist</span><span class="p">(</span> <span class="n">point</span><span class="p">,</span> <span class="n">cluster_centers</span> <span class="p">):</span>
  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span> <span class="p">[</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">point</span> <span class="o">-</span> <span class="n">center</span><span class="p">)]</span> <span class="p">)</span> <span class="p">)</span>
                     <span class="k">for</span> <span class="n">center</span> <span class="ow">in</span> <span class="n">cluster_centers</span><span class="p">]</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Returns the distances to the nearest cluster point for all segments</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[98]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">clusters_converged</span><span class="p">(</span> <span class="n">new_cluster_centers</span><span class="p">,</span> <span class="n">old_cluster_centers</span> <span class="p">):</span>
  <span class="n">dist_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">get_nearest_cluster_dist</span><span class="p">(</span><span class="n">new_cluster_centre</span><span class="p">,</span> <span class="n">old_cluster_centers</span><span class="p">)</span>
               <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">new_cluster_centre</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_cluster_centers</span><span class="p">)]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="One-iteration---step-by-step">One iteration - step by step<a class="anchor-link" href="#One-iteration---step-by-step">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Broadcase-the-initial-cluster-centers">Broadcase the initial cluster centers<a class="anchor-link" href="#Broadcase-the-initial-cluster-centers">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[99]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">broadcasted_cluster_centers</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="n">cluster_centroids</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s">&#39;cluster centroid: &#39;</span><span class="p">,</span> <span class="n">broadcasted_cluster_centers</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>cluster centroid:  [DenseVector([-0.596, -0.1053, -0.4364]), DenseVector([2.1786, -0.2148, -0.4364]), DenseVector([2.9193, -0.2319, -0.4364])]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Assign-the-points-to-the-cluster-centers">Assign the points to the cluster centers<a class="anchor-link" href="#Assign-the-points-to-the-cluster-centers">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[120]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">mark_nearest_cluster</span> <span class="o">=</span> <span class="n">customer_rfm_vals</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">point</span><span class="p">:</span>
                  <span class="p">(</span> <span class="n">assign_to_cluster</span><span class="p">(</span> <span class="n">point</span><span class="p">,</span> <span class="n">broadcasted_cluster_centers</span><span class="o">.</span><span class="n">value</span> <span class="p">),</span> <span class="n">point</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[121]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">mark_nearest_cluster</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[121]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(0, DenseVector([-1.1234, 0.5497, 1.384])),
(1, DenseVector([0.8347, -0.153, -0.4364])),
(0, DenseVector([-0.1299, -0.2048, -0.4364])),
(1, DenseVector([0.9503, -0.0766, -0.3293])),
(0, DenseVector([-0.8019, 0.1367, 0.7415])),
(0, DenseVector([-0.3647, 0.0371, 0.099])),
(0, DenseVector([-1.1162, 1.5495, 1.9194])),
(0, DenseVector([-0.3467, -0.131, -0.0081])),
(0, DenseVector([0.7516, -0.1826, -0.3293])),
(0, DenseVector([0.0652, -0.1085, -0.2222]))]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Group-the-cluster-points-and-calculate-the-mean---new-cluster-centers">Group the cluster points and calculate the mean - new cluster centers<a class="anchor-link" href="#Group-the-cluster-points-and-calculate-the-mean---new-cluster-centers">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[122]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">cluster_groups</span> <span class="o">=</span> <span class="n">mark_nearest_cluster</span><span class="o">.</span><span class="n">groupByKey</span><span class="p">()</span>
<span class="n">cluster_groups</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
<span class="n">cluster_groups</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">3</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[122]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(0, &lt;pyspark.resultiterable.ResultIterable at 0x7f47c0a70b00&gt;),
(1, &lt;pyspark.resultiterable.ResultIterable at 0x7f47c0cb8208&gt;),
(2, &lt;pyspark.resultiterable.ResultIterable at 0x7f47c0cb8e48&gt;)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Define-a-function-to-calculate-the-mean">Define a function to calculate the mean<a class="anchor-link" href="#Define-a-function-to-calculate-the-mean">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[123]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">calculateMean</span><span class="p">(</span> <span class="n">vecs</span> <span class="p">):</span>
  <span class="k">return</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span><span class="n">vec</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span>
                                   <span class="k">for</span> <span class="n">vec</span> <span class="ow">in</span> <span class="n">vecs</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[124]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.mllib.stat</span> <span class="k">import</span> <span class="n">MultivariateStatisticalSummary</span><span class="p">,</span> <span class="n">Statistics</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Calculate-the-new-cluster-centers">Calculate the new cluster centers<a class="anchor-link" href="#Calculate-the-new-cluster-centers">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[125]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">new_cluster_centers</span> <span class="o">=</span> <span class="n">cluster_groups</span><span class="o">.</span><span class="n">mapValues</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">calculateMean</span><span class="p">(</span> <span class="n">rec</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[126]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">new_cluster_centers</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[126]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>PythonRDD[776] at RDD at PythonRDD.scala:43</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[127]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">new_cluster_centers</span> <span class="o">=</span> <span class="n">new_cluster_centers</span><span class="o">.</span><span class="n">sortBy</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="k">True</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[128]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">new_cluster_centers</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[128]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(0, DenseVector([-0.4396, 0.0476, 0.1016])),
(1, DenseVector([1.4605, -0.1692, -0.3628])),
(2, DenseVector([3.0746, -0.2045, -0.4223]))]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[129]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">new_cluster_centers</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">new_cluster_centers</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[130]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">new_cluster_centers</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[130]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[DenseVector([-0.4396, 0.0476, 0.1016]),
DenseVector([1.4605, -0.1692, -0.3628]),
DenseVector([3.0746, -0.2045, -0.4223])]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[131]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="p">[(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span> <span class="n">cluster_centroids</span><span class="p">,</span> <span class="n">new_cluster_centers</span> <span class="p">)</span> <span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[131]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(DenseVector([-0.9904, 3.097, 4.1061]),
DenseVector([-0.4396, 0.0476, 0.1016])),
(DenseVector([-0.5347, -0.0463, -0.0018]),
DenseVector([1.4605, -0.1692, -0.3628])),
(DenseVector([1.3221, -0.1674, -0.3594]),
DenseVector([3.0746, -0.2045, -0.4223]))]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Calculating-Distance-betweeb-old-cluster-centers-and-new-cluster-centers">Calculating Distance betweeb old cluster centers and new cluster centers<a class="anchor-link" href="#Calculating-Distance-betweeb-old-cluster-centers-and-new-cluster-centers">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[132]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">dist_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">)</span>
               <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span> <span class="n">cluster_centroids</span><span class="p">,</span> <span class="n">new_cluster_centers</span> <span class="p">)</span> <span class="p">]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[133]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">dist_list</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[133]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[array([[ 5.06338354]]), array([[ 2.0312989]]), array([[ 1.75399413]])]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[134]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">dist_list</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[134]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[5.06338354159909, 2.0312988959930403, 1.7539941283993663]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Running-multpiple-iterations-to-converge-to-final-clusters">Running multpiple iterations to converge to final clusters<a class="anchor-link" href="#Running-multpiple-iterations-to-converge-to-final-clusters">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>The above steps will be run in multiple iterations to find the actual or most optimal clusters</li>
<li>To do this the we will run at least 100 iterations or until the distnace between new and old ceters fall below 0.01</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[135]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">num_iterations</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">epsilon</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">num_clusters</span> <span class="o">=</span> <span class="mi">3</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_iterations</span><span class="p">):</span>
  <span class="c"># broadcasting centroids</span>
  <span class="c"># if you want to destroy, use destroy method on broadcast variable</span>
  <span class="n">broadcasted_cluster_centroids</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="n">cluster_centroids</span><span class="p">)</span>

  <span class="c"># Assigning point to nearest cluster</span>
  <span class="n">assign_to_nearest_cluster</span> <span class="o">=</span> <span class="n">customer_rfm_vals</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">point</span><span class="p">:</span>
                                        <span class="p">(</span> <span class="n">assign_to_cluster</span><span class="p">(</span> <span class="n">point</span><span class="p">,</span>
                                          <span class="n">broadcasted_cluster_centroids</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">point</span> <span class="p">)</span> <span class="p">)</span>

  <span class="c"># Re-calculating centroid by aggregating (Taking column mean)</span>
  <span class="n">new_centroids</span> <span class="o">=</span> <span class="n">assign_to_nearest_cluster</span><span class="o">.</span><span class="n">groupByKey</span><span class="p">(</span> <span class="n">numPartitions</span>
                                                       <span class="o">=</span> <span class="n">num_clusters</span> <span class="p">)</span><span class="o">.</span><span class="n">mapValues</span><span class="p">(</span>
                                                  <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">calculateMean</span><span class="p">(</span> <span class="n">rec</span> <span class="p">)</span> <span class="p">)</span>


  <span class="n">new_centroids</span> <span class="o">=</span> <span class="n">new_centroids</span><span class="o">.</span><span class="n">sortBy</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                       <span class="n">ascending</span> <span class="o">=</span> <span class="k">True</span> <span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="n">num_clusters</span> <span class="p">)</span>

  <span class="n">previous_cluster_centroid</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cluster_centroids</span><span class="p">]</span>
  <span class="n">cluster_centroids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">new_centroids</span><span class="p">]</span>


  <span class="c"># Check distance between previous and new centroid. Need this distance to calculate Convergence</span>
  <span class="n">dist_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">)</span>
               <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span> <span class="n">cluster_centroids</span><span class="p">,</span> <span class="n">previous_cluster_centroid</span> <span class="p">)</span> <span class="p">]</span>

  <span class="n">dist_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">dist_list</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dist_list</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">epsilon</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s">&quot;The Clusters Converged</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
      <span class="k">break</span>
  <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s">&#39;Not Converged yet.. going for next iteration: &#39;</span><span class="p">,</span> <span class="n">dist_list</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Not Converged yet.. going for next iteration:  [1.2857358964872079, 0.030741145950249748, 0.0072124401975714588]
Not Converged yet.. going for next iteration:  [1.1302031087315294, 0.017274863723053074, 0.0044047809692650819]
Not Converged yet.. going for next iteration:  [1.7411155003956216, 0.021597626369677082, 0.0044374840521173237]
Not Converged yet.. going for next iteration:  [1.2127585187830106, 0.014208636646654237, 0.011103794974810755]
Not Converged yet.. going for next iteration:  [1.6766891693566788, 0.014450228282898357, 0.005143991127110027]
Not Converged yet.. going for next iteration:  [0.25713306265251407, 0.006223045200706389, 0.010715011047713789]
Not Converged yet.. going for next iteration:  [0.0, 0.005333706864219202, 0.011592632314832074]
The Clusters Converged

New centroids:  []
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Final-clusters-centers">Final clusters centers<a class="anchor-link" href="#Final-clusters-centers">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[136]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">cluster_centroids</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[136]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[DenseVector([-1.0528, 9.0114, 8.3813]),
DenseVector([-0.572, -0.0016, 0.0915]),
DenseVector([1.2612, -0.1675, -0.3574])]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Assigning-customers-to-clusters">Assigning customers to clusters<a class="anchor-link" href="#Assigning-customers-to-clusters">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[186]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_cluster_labels</span> <span class="o">=</span> <span class="n">customer_data</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                          <span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                           <span class="nb">int</span><span class="p">(</span><span class="n">assign_to_cluster</span><span class="p">(</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cluster_centroids</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[187]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_cluster_labels</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
<span class="n">customer_cluster_labels</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">5</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[187]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(12431, 1), (12631, 2), (12831, 1), (13431, 2), (13631, 1)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[188]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="k">import</span> <span class="n">StructType</span><span class="p">,</span> <span class="n">StructField</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">IntegerType</span>

<span class="n">customer_schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">(</span> <span class="p">[</span> <span class="n">StructField</span><span class="p">(</span><span class="s">&#39;CustomerID&#39;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="k">True</span><span class="p">),</span>
                    <span class="n">StructField</span><span class="p">(</span><span class="s">&#39;ClusterLabel&#39;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="k">True</span><span class="p">)</span> <span class="p">]</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[189]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_clusters_df</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span> <span class="n">customer_cluster_labels</span><span class="p">,</span> <span class="n">customer_schema</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[190]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_clusters_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">5</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+----------+------------+
|CustomerID|ClusterLabel|
+----------+------------+
|     12431|           1|
|     12631|           2|
|     12831|           1|
|     13431|           2|
|     13631|           1|
+----------+------------+
only showing top 5 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[195]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_rfm_cluster_df</span> <span class="o">=</span> <span class="n">rfm_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">customer_clusters_df</span><span class="p">,</span>
                                    <span class="n">on</span> <span class="o">=</span> <span class="s">&#39;CustomerID&#39;</span><span class="p">,</span>
                                    <span class="n">how</span> <span class="o">=</span> <span class="s">&#39;inner&#39;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Customers-with-their-RFM-values-and-the-cluster-labels">Customers with their RFM values and the cluster labels<a class="anchor-link" href="#Customers-with-their-RFM-values-and-the-cluster-labels">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[196]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_rfm_cluster_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+----------+-------+---------+--------+------------+
|CustomerID|Recency|Frequency|Monetary|ClusterLabel|
+----------+-------+---------+--------+------------+
|     12431|     25|       18| 6416.39|           1|
|     12631|    567|        1|   640.5|           2|
|     12831|    300|        1|  215.05|           1|
|     13431|    599|        2|  1269.1|           2|
|     13631|    114|       12| 3021.77|           1|
+----------+-------+---------+--------+------------+
only showing top 5 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Find-Cluster-Characteristics">Find Cluster Characteristics<a class="anchor-link" href="#Find-Cluster-Characteristics">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[199]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_cluster_centers</span> <span class="o">=</span> <span class="n">customer_rfm_cluster_df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span> <span class="s">&#39;ClusterLabel&#39;</span>
                                                        <span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span> <span class="p">{</span> <span class="s">&#39;Recency&#39;</span><span class="p">:</span> <span class="s">&#39;mean&#39;</span><span class="p">,</span>
                                                      <span class="s">&#39;Frequency&#39;</span><span class="p">:</span> <span class="s">&#39;mean&#39;</span><span class="p">,</span>
                                                      <span class="s">&#39;Monetary&#39;</span><span class="p">:</span> <span class="s">&#39;mean&#39;</span><span class="p">}</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[200]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_cluster_centers</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+------------+------------------+------------------+-----------------+
|ClusterLabel|     avg(Monetary)|    avg(Frequency)|     avg(Recency)|
+------------+------------------+------------------+-----------------+
|           0|  75966.3873076923| 83.34615384615384|44.53846153846154|
|           1|1886.7595827725454|5.9320323014804845|177.3741588156124|
|           2| 522.1908733624449|1.7416302765647744|684.4985443959243|
+------------+------------------+------------------+-----------------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Note:">Note:<a class="anchor-link" href="#Note:">&#182;</a></h3><ul>
<li>Customers in <strong>cluster 0</strong> seem to be high valued customers with very high monetary value, very frequent buys and have bought recently.</li>
<li>Customers in <strong>cluster 1</strong> seems to have bought six months back at an average and most likely churn. These customers may need intervention to be retained.</li>
<li>Customers in <strong>cluster 2</strong> seems to have not bought for 2 years and most likely have churned. There must be a different starategy to bring them back.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Finding-optimal-number-of-clusters">Finding optimal number of clusters<a class="anchor-link" href="#Finding-optimal-number-of-clusters">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>To find optimal number of clusters, we can use <strong>dendogram</strong> or <strong>elbow analysis</strong>.</li>
<li>For creating dendogram, we can not use all the data as the datasize is very large. We can randomly sample multiple samples and create multiple dendograms. This is give us an approximate estimate on number of clusters. Number of clusters also depends on business convenience. A large number of clusters may not be feasible to manage as several staragies need to be created to deal with different clusters or segments. Dendograms will only give initial indication of how many clusters may existing in the dataset.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[201]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">only_rfm_vals_df</span> <span class="o">=</span> <span class="n">customer_rfm_cluster_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span> <span class="p">[</span><span class="s">&#39;Recency&#39;</span><span class="p">,</span> <span class="s">&#39;Frequency&#39;</span><span class="p">,</span> <span class="s">&#39;Monetary&#39;</span><span class="p">]</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[202]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">only_rfm_vals_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+-------+---------+--------+
|Recency|Frequency|Monetary|
+-------+---------+--------+
|     25|       18| 6416.39|
|    567|        1|   640.5|
|    300|        1|  215.05|
|    599|        2|  1269.1|
|    114|       12| 3021.77|
+-------+---------+--------+
only showing top 5 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[206]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_data</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[206]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(12431, DenseVector([-1.1234, 0.5497, 1.384])),
(12631, DenseVector([0.8347, -0.153, -0.4364])),
(12831, DenseVector([-0.1299, -0.2048, -0.4364])),
(13431, DenseVector([0.9503, -0.0766, -0.3293])),
(13631, DenseVector([-0.8019, 0.1367, 0.7415]))]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[215]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_df</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
  <span class="n">customer_data</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                    <span class="p">(</span> <span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="p">)</span> <span class="p">),</span>
  <span class="p">[</span><span class="s">&#39;Recency&#39;</span><span class="p">,</span> <span class="s">&#39;Monetary&#39;</span><span class="p">,</span> <span class="s">&#39;Frequency&#39;</span><span class="p">]</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[216]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+--------------------+--------------------+-------------------+
|             Recency|            Monetary|          Frequency|
+--------------------+--------------------+-------------------+
| -1.1234212007794546|  0.5496703474612289| 1.3839661526847584|
|  0.8346931557931577|-0.15304865275331805|-0.4364051411980503|
|-0.12991299403135792| -0.2048106839972093|-0.4364051411980503|
|  0.9503013834874816|-0.07657054054292899|-0.3293244768520027|
|  -0.801885817504616| 0.13666664197024736|  0.741482166608473|
+--------------------+--------------------+-------------------+
only showing top 5 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[219]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sn</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="One-sample">One sample<a class="anchor-link" href="#One-sample">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[223]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">cmap</span> <span class="o">=</span> <span class="n">sn</span><span class="o">.</span><span class="n">cubehelix_palette</span><span class="p">(</span><span class="n">as_cmap</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">rot</span><span class="o">=-.</span><span class="mi">3</span><span class="p">,</span> <span class="n">light</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sn</span><span class="o">.</span><span class="n">clustermap</span><span class="p">(</span> <span class="n">customer_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span> <span class="k">False</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[223]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;seaborn.matrix.ClusterGrid at 0x7f47ba9c4908&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
AAAASUVORK5CYII=
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="One-more-sample">One more sample<a class="anchor-link" href="#One-more-sample">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[292]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">cmap</span> <span class="o">=</span> <span class="n">sn</span><span class="o">.</span><span class="n">cubehelix_palette</span><span class="p">(</span><span class="n">as_cmap</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">rot</span><span class="o">=-.</span><span class="mi">3</span><span class="p">,</span> <span class="n">light</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sn</span><span class="o">.</span><span class="n">clustermap</span><span class="p">(</span> <span class="n">customer_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span> <span class="k">False</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[292]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;seaborn.matrix.ClusterGrid at 0x7f47b637f438&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Note:">Note:<a class="anchor-link" href="#Note:">&#182;</a></h3><p>From dendograms, we can infer that there are about 3/4 clusters.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Elbow-Analysis">Elbow Analysis<a class="anchor-link" href="#Elbow-Analysis">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For elbow analysis also, we will take multiple samples and create clusters and compute the sum of squared errors to find out optimal number of clusters that can be created. For details about the technique, refer to this <a href="http://www.awesomestats.in/python-cluster-validation/">blog</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[295]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="k">import</span> <span class="n">KMeans</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Creating-elbow-analysis">Creating elbow analysis<a class="anchor-link" href="#Creating-elbow-analysis">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[299]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c">## Takes two parameters: List of k values and fraction of sample that need to be taken for this analysis</span>
<span class="k">def</span> <span class="nf">elbow_analysis</span><span class="p">(</span> <span class="n">num_clusters_list</span><span class="p">,</span> <span class="n">sampleFraction</span> <span class="p">):</span>
  <span class="n">X_scaled</span> <span class="o">=</span> <span class="n">customer_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span> <span class="k">False</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">=</span> <span class="n">sampleFraction</span> <span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
  <span class="n">cluster_errors</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="k">for</span> <span class="n">num_clusters</span> <span class="ow">in</span> <span class="n">cluster_range</span><span class="p">:</span>
    <span class="n">clusters</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span> <span class="n">num_clusters</span> <span class="p">)</span>
    <span class="n">clusters</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">X_scaled</span> <span class="p">)</span>
    <span class="n">cluster_errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">clusters</span><span class="o">.</span><span class="n">inertia_</span> <span class="p">)</span>
  <span class="n">clusters_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="p">{</span> <span class="s">&quot;num_clusters&quot;</span><span class="p">:</span><span class="n">cluster_range</span><span class="p">,</span> <span class="s">&quot;cluster_errors&quot;</span><span class="p">:</span> <span class="n">cluster_errors</span> <span class="p">}</span> <span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">clusters_df</span><span class="o">.</span><span class="n">num_clusters</span><span class="p">,</span> <span class="n">clusters_df</span><span class="o">.</span><span class="n">cluster_errors</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&quot;o&quot;</span> <span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Cluster-range-from-1-to-10-and-sample-fraction-0.01">Cluster range from 1 to 10 and sample fraction 0.01<a class="anchor-link" href="#Cluster-range-from-1-to-10-and-sample-fraction-0.01">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[300]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">elbow_analysis</span><span class="p">(</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="mf">0.01</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Cluster-range-1-to-10-and-sample-fraction-0.1">Cluster range 1 to 10 and sample fraction 0.1<a class="anchor-link" href="#Cluster-range-1-to-10-and-sample-fraction-0.1">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[301]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">elbow_analysis</span><span class="p">(</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="mf">0.1</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Note:">Note:<a class="anchor-link" href="#Note:">&#182;</a></h3><p>It can be observed that the marginal gain in explained variance drops significantly after 4 clusters. So, 4 clusters could be optimal. But we still need to make sense of those clusters from business point of view. Creating additional clusters without effective strategy to deal with them will be an overhead to business without any additional benefits.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Using-Spark-MLIB-KMeans-Algorithm">Using Spark MLIB KMeans Algorithm<a class="anchor-link" href="#Using-Spark-MLIB-KMeans-Algorithm">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[262]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.mllib.clustering</span> <span class="k">import</span> <span class="n">KMeans</span><span class="p">,</span> <span class="n">KMeansModel</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="For-Num-Cluster-=-3">For Num Cluster = 3<a class="anchor-link" href="#For-Num-Cluster-=-3">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[263]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_rfm_vals</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">5</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[263]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[DenseVector([-1.1234, 0.5497, 1.384]),
DenseVector([0.8347, -0.153, -0.4364]),
DenseVector([-0.1299, -0.2048, -0.4364]),
DenseVector([0.9503, -0.0766, -0.3293]),
DenseVector([-0.8019, 0.1367, 0.7415])]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[279]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">numClusters</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">numIterations</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">clusters</span> <span class="o">=</span> <span class="n">KMeans</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">customer_rfm_vals</span><span class="p">,</span>
                      <span class="n">numClusters</span><span class="p">,</span>
                      <span class="n">maxIterations</span> <span class="o">=</span> <span class="n">numIterations</span><span class="p">,</span>
                      <span class="n">initializationMode</span><span class="o">=</span><span class="s">&quot;random&quot;</span><span class="p">,</span>
                      <span class="n">epsilon</span><span class="o">=</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Assign-customers-to-clusters">Assign customers to clusters<a class="anchor-link" href="#Assign-customers-to-clusters">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[280]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">cust_cluser_labels</span> <span class="o">=</span> <span class="n">clusters</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">customer_rfm_vals</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Map-customers-ID-to-Clusters">Map customers ID to Clusters<a class="anchor-link" href="#Map-customers-ID-to-Clusters">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[281]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_ml_labels</span> <span class="o">=</span> <span class="n">customer_labels</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span> <span class="n">cust_cluser_labels</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[282]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_ml_labels</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">5</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[282]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(12431, 0), (12631, 1), (12831, 0), (13431, 1), (13631, 0)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[283]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_ml_clusters_df</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
  <span class="n">customer_ml_labels</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span> <span class="p">),</span> <span class="n">customer_schema</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[284]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_ml_clusters_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+----------+------------+
|CustomerID|ClusterLabel|
+----------+------------+
|     12431|           0|
|     12631|           1|
|     12831|           0|
|     13431|           1|
|     13631|           0|
+----------+------------+
only showing top 5 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[285]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_rfm_cluster_ml_df</span> <span class="o">=</span> <span class="n">rfm_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">customer_ml_clusters_df</span><span class="p">,</span>
                                    <span class="n">on</span> <span class="o">=</span> <span class="s">&#39;CustomerID&#39;</span><span class="p">,</span>
                                    <span class="n">how</span> <span class="o">=</span> <span class="s">&#39;inner&#39;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[286]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_rfm_cluster_ml_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+----------+-------+---------+--------+------------+
|CustomerID|Recency|Frequency|Monetary|ClusterLabel|
+----------+-------+---------+--------+------------+
|     12431|     25|       18| 6416.39|           0|
|     12631|    567|        1|   640.5|           1|
|     12831|    300|        1|  215.05|           0|
|     13431|    599|        2|  1269.1|           1|
|     13631|    114|       12| 3021.77|           0|
+----------+-------+---------+--------+------------+
only showing top 5 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Calculate-the-cluster-centers">Calculate the cluster centers<a class="anchor-link" href="#Calculate-the-cluster-centers">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[287]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_ml_cluster_centers</span> <span class="o">=</span> <span class="n">customer_rfm_cluster_ml_df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span> <span class="s">&#39;ClusterLabel&#39;</span>
                                                        <span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span> <span class="p">{</span> <span class="s">&#39;Recency&#39;</span><span class="p">:</span> <span class="s">&#39;mean&#39;</span><span class="p">,</span>
                                                      <span class="s">&#39;Frequency&#39;</span><span class="p">:</span> <span class="s">&#39;mean&#39;</span><span class="p">,</span>
                                                      <span class="s">&#39;Monetary&#39;</span><span class="p">:</span> <span class="s">&#39;mean&#39;</span><span class="p">}</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[288]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_ml_cluster_centers</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+------------+------------------+------------------+------------------+
|ClusterLabel|     avg(Monetary)|    avg(Frequency)|      avg(Recency)|
+------------+------------------+------------------+------------------+
|           0|1887.3142140693385| 5.933019185459441|177.29182093571188|
|           1| 521.9848799999995|1.7425454545454546| 684.3076363636363|
|           2|  75966.3873076923| 83.34615384615384| 44.53846153846154|
+------------+------------------+------------------+------------------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="What-we-got-from-our-clusetering-algorithm">What we got from our clusetering algorithm<a class="anchor-link" href="#What-we-got-from-our-clusetering-algorithm">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[289]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">customer_cluster_centers</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+------------+------------------+------------------+-----------------+
|ClusterLabel|     avg(Monetary)|    avg(Frequency)|     avg(Recency)|
+------------+------------------+------------------+-----------------+
|           0|  75966.3873076923| 83.34615384615384|44.53846153846154|
|           1|1886.7595827725454|5.9320323014804845|177.3741588156124|
|           2| 522.1908733624449|1.7416302765647744|684.4985443959243|
+------------+------------------+------------------+-----------------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Note:">Note:<a class="anchor-link" href="#Note:">&#182;</a></h3><p>It can be observed that our algorithm and spark's mllib kmean() library have found the same clusters. They are only rearranged, but the property of each cluster remains same.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="For-Num-Clusters-=-4">For Num Clusters = 4<a class="anchor-link" href="#For-Num-Clusters-=-4">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[290]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">numClusters</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">numIterations</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">clusters</span> <span class="o">=</span> <span class="n">KMeans</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">customer_rfm_vals</span><span class="p">,</span>
                      <span class="n">numClusters</span><span class="p">,</span>
                      <span class="n">maxIterations</span> <span class="o">=</span> <span class="n">numIterations</span><span class="p">,</span>
                      <span class="n">initializationMode</span><span class="o">=</span><span class="s">&quot;random&quot;</span><span class="p">,</span>
                      <span class="n">epsilon</span><span class="o">=</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>

<span class="n">cust_cluser_labels</span> <span class="o">=</span> <span class="n">clusters</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">customer_rfm_vals</span> <span class="p">)</span>
<span class="n">customer_ml_labels</span> <span class="o">=</span> <span class="n">customer_labels</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span> <span class="n">cust_cluser_labels</span> <span class="p">)</span>

<span class="n">customer_ml_clusters_df</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
  <span class="n">customer_ml_labels</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span> <span class="p">),</span> <span class="n">customer_schema</span> <span class="p">)</span>

<span class="n">customer_rfm_cluster_ml_df</span> <span class="o">=</span> <span class="n">rfm_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">customer_ml_clusters_df</span><span class="p">,</span>
                                        <span class="n">on</span> <span class="o">=</span> <span class="s">&#39;CustomerID&#39;</span><span class="p">,</span>
                                        <span class="n">how</span> <span class="o">=</span> <span class="s">&#39;inner&#39;</span> <span class="p">)</span>

<span class="n">customer_ml_cluster_centers</span> <span class="o">=</span> <span class="n">customer_rfm_cluster_ml_df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span>
  <span class="s">&#39;ClusterLabel&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span> <span class="p">{</span> <span class="s">&#39;Recency&#39;</span><span class="p">:</span> <span class="s">&#39;mean&#39;</span><span class="p">,</span>
                        <span class="s">&#39;Frequency&#39;</span><span class="p">:</span> <span class="s">&#39;mean&#39;</span><span class="p">,</span>
                        <span class="s">&#39;Monetary&#39;</span><span class="p">:</span> <span class="s">&#39;mean&#39;</span><span class="p">}</span> <span class="p">)</span>

<span class="n">customer_ml_cluster_centers</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+------------+------------------+------------------+------------------+
|ClusterLabel|     avg(Monetary)|    avg(Frequency)|      avg(Recency)|
+------------+------------------+------------------+------------------+
|           0| 524.2829606784885|1.7316885119506553| 699.9622205088666|
|           1|1358.2928222996527| 4.599303135888502|190.35087108013937|
|           2| 12135.74762886598|28.530927835051546| 72.74226804123711|
|           3|124312.30636363638| 109.9090909090909| 49.54545454545455|
+------------+------------------+------------------+------------------+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Note:">Note:<a class="anchor-link" href="#Note:">&#182;</a></h3><p>It can be observed that the cluster 0 and 1 have characteristics very similar to earlier segments we created. But the high value segements has been split into two more segments now. Cluster 3 is realy high valued customers and cluster 2 is potential customers with good frequency and have bought 2/3 months back. There can be a stragegy to convert these customers into high valued customers.</p>

</div>
</div>
</div>
  </div>
</div>

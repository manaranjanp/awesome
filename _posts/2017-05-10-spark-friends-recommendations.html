---
layout: post
title: "Friend of Friends Recommendations using Spark API"
date: 2016-05-25
description: "Making friend of friends recommendation on social network sites"
main-class: 'spark'
published: true
postbook: 'inotebook'
color: '#7AAB13'
tags:
- spark
- RDD
- pyspark
- recommendations
categories:
- spark
introduction: "Making friend of friends recommendation on social network sites"
---

<div tabindex="-1" id="notebook" class="border-box-sizing">
  <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Making-Recommendations-on-Social-Network">Making Recommendations on Social Network<a class="anchor-link" href="#Making-Recommendations-on-Social-Network">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Overview">Overview<a class="anchor-link" href="#Overview">&#182;</a></h2><ul>
<li>Online social network platofroms always find ways to connect more people inside their network. These new connections could be based on various factors like age, qualification, profession, likes-dislikes or common friends. Finding new frineds based on common friends is a very popular approach. </li>
</ul>
<ul>
<li><strong>Common friends approach:</strong> If two people who are not connected on a social network platform yet, but have got many common frieds, then they are are highly likeyly to be connected very soon. But people may not be aware of such friends in the network or may take very long time to disover and then get connected. So, social network platforms themselves run algorithms to find out such people in the network (auto discovery) and make frequent recommendations to connect. </li>
</ul>
<ul>
<li>When the networks become very large and have hundreds of millions people in the network, discovering such implicit connections become very challenging. In this tutorial we will explain a simple map-reduce based algorithms to discover such connections and make recommendations. This algorithm is highly scalable as this is based on map reduce paradigm and can run on hundred of millions of connections.</li>
<li>The example dataset contains names of the people and their explicit connections in the network. Every line in the file represents information about one person in the network, where the first columns is the name of the person and the rest of the columns represent the name of the persons whom he is already connected to.</li>
</ul>
<ul>
<li><strong> Based on this we need to make atleast 5 new friends recommendations to each person, in the order of number of common friends they have. </strong></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Loading-the-dataset">Loading the dataset<a class="anchor-link" href="#Loading-the-dataset">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">friends_rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span> <span class="s">&#39;file:///home/hadoop/lab/data/friendsnetwork.csv&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">friends_rdd</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[2]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[&apos;Kristina Chung,Glenda Baker,Bradley Duke,Deborah French,Priscilla Hayes&apos;,
&apos;Paige Chen,Faye Sparks,Christopher McKay,Katie Katz,Sue Ellis,Pauline Coley,Mike Hill,Carl Nixon&apos;,
&apos;Sherri Melton,Luis Hirsch,Marian Crane,Jessica Hester,Evan Grant,Chris Scott,Beth Hayes,Bobby Case&apos;,
&apos;Gretchen Hill,Samantha Hardin,Maureen Kemp,Maurice Gibbons,Franklin Vick&apos;,
&apos;Karen Puckett,Brenda Fitzpatrick,Chris Scott,Dawn Lutz,&apos;,
&apos;Patrick Song,Bernard Pate,Peggy Schroeder,Edna Hoyle,Anne Little,Kristen Fisher,Melanie Diaz,Katharine Pappas&apos;,
&apos;Elsie Hamilton,Franklin Vick&apos;,
&apos;Hazel Bender,Gary Scarborough,Floyd Schroeder,Anne Little,Clyde Kenney&apos;,
&apos;Malcolm Wagner,Annie Lindsay,Ricky Casey&apos;,
&apos;Dolores McLaughlin,James Floyd,Ruth Tyson,Tara Wolfe,Sheryl Love,Priscilla Hayes,Lois Holmes,Sandra Kang,Jason Bowling,Carrie Watson,Brooke Boswell&apos;]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Note:">Note:<a class="anchor-link" href="#Note:">&#182;</a></h4><ul>
<li>Here <em>Kristina Chung</em> is connected to <em>Glenda Baker,Bradley Duke,Deborah French,Priscilla Hayes</em></li>
<li>Similarily there will be some persons who will be connected to <em>Glenda Baker or Bradley Duke or Deborah French or Priscilla Hayes</em>, but not connected to <em>Kristina Chung</em></li>
<li>Now, can we exploit this informationto find if there are any new friends that can be recommeded to <em>Kristina Chung</em></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Format-the-data">Format the data<a class="anchor-link" href="#Format-the-data">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>There are some extra commas at the end of each line, that need to be removed using <em>rstrip()</em> call</li>
<li>Modify the data into a tuple of <strong> ( person name , [list of direct connectsion] ) </strong></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">friends_final_rdd</span> <span class="o">=</span> <span class="n">friends_rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">))</span> \
                      <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">))</span> \
                      <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">oneFriend</span><span class="p">:</span> <span class="p">(</span><span class="n">oneFriend</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oneFriend</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">friends_final_rdd</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">4</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[4]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Kristina Chung&apos;,
[&apos;Glenda Baker&apos;, &apos;Bradley Duke&apos;, &apos;Deborah French&apos;, &apos;Priscilla Hayes&apos;]),
(&apos;Paige Chen&apos;,
[&apos;Faye Sparks&apos;,
 &apos;Christopher McKay&apos;,
 &apos;Katie Katz&apos;,
 &apos;Sue Ellis&apos;,
 &apos;Pauline Coley&apos;,
 &apos;Mike Hill&apos;,
 &apos;Carl Nixon&apos;]),
(&apos;Sherri Melton&apos;,
[&apos;Luis Hirsch&apos;,
 &apos;Marian Crane&apos;,
 &apos;Jessica Hester&apos;,
 &apos;Evan Grant&apos;,
 &apos;Chris Scott&apos;,
 &apos;Beth Hayes&apos;,
 &apos;Bobby Case&apos;]),
(&apos;Gretchen Hill&apos;,
[&apos;Samantha Hardin&apos;, &apos;Maureen Kemp&apos;, &apos;Maurice Gibbons&apos;, &apos;Franklin Vick&apos;])]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Note:">Note:<a class="anchor-link" href="#Note:">&#182;</a></h3><ul>
<li>If we look at each persons and his friends list, we can create some map key values that would represent the exisitng connections and possible connections.</li>
<li>For example,</p>
<ul>
<li>A key value  <em>(('Kristina Chung','Glenda Baker'), 0)</em>, where <em>0</em> represents <em>Kristina Chung</em> and <em>Glenda Baker</em> are already connected.</li>
<li>A key value <em>(('Glenda Baker', 'Bradley Duke'), 1)</em>, where <em>1</em> repesents <em>Glenda Baker</em> and <em>Bradley Duke</em> are possible future friends (recommendations) as they have a common friend called <em>Kristina Chung</em></li>
</ul>
</li>
<li>Now, we need to generate these candidate key and value combinations to represent all existing connections and possible future connections.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Finding-existing-and-possible-future-connections">Finding existing and possible future connections<a class="anchor-link" href="#Finding-existing-and-possible-future-connections">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">import</span> <span class="nn">itertools</span>

<span class="k">def</span> <span class="nf">createFrindsConnections</span><span class="p">(</span> <span class="n">a_friend</span> <span class="p">):</span>
  <span class="n">person</span> <span class="o">=</span> <span class="n">a_friend</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">friends_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="n">a_friend</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>

<span class="c">## Create existing connections    </span>

  <span class="n">all_connections</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span> <span class="p">(</span> <span class="n">each_friend</span><span class="p">,</span> <span class="n">person</span> <span class="p">),</span> <span class="mi">0</span><span class="p">)</span>                               \
                      <span class="k">if</span> <span class="n">person</span> <span class="o">&gt;</span> <span class="n">each_friend</span> <span class="k">else</span> <span class="p">(</span> <span class="p">(</span> <span class="n">person</span><span class="p">,</span> <span class="n">each_friend</span> <span class="p">),</span> <span class="mi">0</span><span class="p">)</span>  \
                      <span class="k">for</span> <span class="n">each_friend</span> <span class="ow">in</span> <span class="n">friends_list</span> <span class="p">]</span>

<span class="c">## Create possible future connections</span>

  <span class="k">for</span> <span class="n">friends_pair</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span> <span class="n">friends_list</span><span class="p">,</span> <span class="mi">2</span> <span class="p">):</span>
      <span class="k">if</span> <span class="n">friends_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">friends_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
          <span class="n">all_connections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span> <span class="p">(</span> <span class="n">friends_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">friends_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">),</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">all_connections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span> <span class="n">friends_pair</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
  <span class="k">return</span> <span class="n">all_connections</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">friend_connections_rdd</span> <span class="o">=</span> <span class="n">friends_final_rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">createFrindsConnections</span><span class="p">(</span> <span class="n">rec</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Let's-cache-this-dataset">Let's cache this dataset<a class="anchor-link" href="#Let's-cache-this-dataset">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">friend_connections_rdd</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[7]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>PythonRDD[4] at RDD at PythonRDD.scala:43</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">friend_connections_rdd</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[8]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[((&apos;Glenda Baker&apos;, &apos;Kristina Chung&apos;), 0),
((&apos;Kristina Chung&apos;, &apos;Priscilla Hayes&apos;), 0),
((&apos;Bradley Duke&apos;, &apos;Kristina Chung&apos;), 0),
((&apos;Deborah French&apos;, &apos;Kristina Chung&apos;), 0),
((&apos;Glenda Baker&apos;, &apos;Priscilla Hayes&apos;), 1),
((&apos;Bradley Duke&apos;, &apos;Glenda Baker&apos;), 1),
((&apos;Deborah French&apos;, &apos;Glenda Baker&apos;), 1),
((&apos;Bradley Duke&apos;, &apos;Priscilla Hayes&apos;), 1),
((&apos;Deborah French&apos;, &apos;Priscilla Hayes&apos;), 1),
((&apos;Bradley Duke&apos;, &apos;Deborah French&apos;), 1)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Finding-Number-of-common-friends">Finding Number of common friends<a class="anchor-link" href="#Finding-Number-of-common-friends">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Now, we can aggregate the <em>0's</em> and <em>1's</em> for each pair. If a <em>0</em> exists in the list for any pair, that means the pair is already connected and it can be ignored or need not be processes further. </li>
<li>But if there is no <em>0</em>, then we can sum up all the <em>1's</em> and that would be the number of common friends they have got and they are not connected yet. This signifies possible future connections. </li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">num_common_friends_rdd</span> <span class="o">=</span> <span class="n">friend_connections_rdd</span><span class="o">.</span><span class="n">groupByKey</span><span class="p">()</span>                     \
                                          <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="mi">0</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> \
                                          <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>    \
                                          <span class="o">.</span><span class="n">sortBy</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">num_common_friends_rdd</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[10]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>PythonRDD[16] at RDD at PythonRDD.scala:43</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">num_common_friends_rdd</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[11]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[((&apos;Jay Wang&apos;, &apos;Marion Puckett&apos;), 3),
((&apos;Julian Woods&apos;, &apos;Melinda Weeks&apos;), 3),
((&apos;Jamie Gallagher&apos;, &apos;Theodore McKay&apos;), 3),
((&apos;Benjamin Hensley&apos;, &apos;Lewis Currin&apos;), 3),
((&apos;Bob Fischer&apos;, &apos;Stephanie Hawkins&apos;), 3),
((&apos;Harry Foster&apos;, &apos;Lois Joseph&apos;), 2),
((&apos;Katharine Pappas&apos;, &apos;Peggy Schroeder&apos;), 2),
((&apos;Crystal Powers&apos;, &apos;Eric Kane&apos;), 2),
((&apos;Anne Stephens&apos;, &apos;Patsy Parrott&apos;), 2),
((&apos;Florence Carver&apos;, &apos;Hannah Mueller&apos;), 2)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Note:">Note:<a class="anchor-link" href="#Note:">&#182;</a></h3><ul>
<li>It shows that <em>Jay Wang</em> and <em>Marion Puckett</em> have 3 common friends, but they are not connected yet. So, they can be recommended to each other. </li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Collecting-individual-recommedations">Collecting individual recommedations<a class="anchor-link" href="#Collecting-individual-recommedations">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>To make <strong>top 5</strong> recommedations for each user, we need to separately create recommedation list for each user from the paired information above.</li>
<li>For example, <em>(('Jay Wang', 'Marion Puckett'), 3)</em> should create two individual recommendations as below.</p>
<ul>
<li><em>('Jay Wang', ('Marion Puckett', 3))</em></li>
<li><em>('Marion Puckett', ('Jay Wang', 3))</em></li>
</ul>
</li>
<li>That means <em>Marion Puckett</em> is recommeded to <em>Jay Wang</em> because of 3 common friends and <em>Jay Wang</em> recommended to <em>Marion Puckett</em> because of 3 common friends.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">individual_recommends</span> <span class="o">=</span> <span class="n">num_common_friends_rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                                 <span class="p">[(</span><span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> \
                                                 <span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">]))]</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">individual_recommends</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[13]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Jay Wang&apos;, (&apos;Marion Puckett&apos;, 3)),
(&apos;Marion Puckett&apos;, (&apos;Jay Wang&apos;, 3)),
(&apos;Julian Woods&apos;, (&apos;Melinda Weeks&apos;, 3)),
(&apos;Melinda Weeks&apos;, (&apos;Julian Woods&apos;, 3)),
(&apos;Jamie Gallagher&apos;, (&apos;Theodore McKay&apos;, 3)),
(&apos;Theodore McKay&apos;, (&apos;Jamie Gallagher&apos;, 3)),
(&apos;Benjamin Hensley&apos;, (&apos;Lewis Currin&apos;, 3)),
(&apos;Lewis Currin&apos;, (&apos;Benjamin Hensley&apos;, 3)),
(&apos;Bob Fischer&apos;, (&apos;Stephanie Hawkins&apos;, 3)),
(&apos;Stephanie Hawkins&apos;, (&apos;Bob Fischer&apos;, 3))]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Making-final-recommendations">Making final recommendations<a class="anchor-link" href="#Making-final-recommendations">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><strong>Making top 5 final recommendations for each users.</strong></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">top_n_recommends</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">final_recommends</span> <span class="o">=</span> <span class="n">individual_recommends</span><span class="o">.</span><span class="n">groupByKey</span><span class="p">()</span><span class="o">.</span><span class="n">mapValues</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>    \
                                         <span class="nb">sorted</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>     \
                                                <span class="n">reverse</span><span class="o">=</span><span class="k">True</span><span class="p">)[:</span><span class="n">top_n_recommends</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">final_recommends</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
<span class="n">final_recommends</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">5</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[16]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[(&apos;Regina Ellington&apos;,
[(&apos;Annie Lindsay&apos;, 1),
 (&apos;Suzanne Gould&apos;, 1),
 (&apos;Patrick Song&apos;, 1),
 (&apos;Zachary Lindsay&apos;, 1),
 (&apos;Gladys Davidson&apos;, 1)]),
(&apos;Kim Hensley&apos;,
[(&apos;Norman Lam&apos;, 1),
 (&apos;Melinda Weeks&apos;, 1),
 (&apos;Brenda Barbour&apos;, 1),
 (&apos;Susan Abbott&apos;, 1),
 (&apos;Robyn Shapiro&apos;, 1)]),
(&apos;Norman Arthur&apos;,
[(&apos;Constance Black&apos;, 1),
 (&apos;Marc Wallace&apos;, 1),
 (&apos;Pauline Chandler&apos;, 1),
 (&apos;Chris Chu&apos;, 1),
 (&apos;Vincent Woodward&apos;, 1)]),
(&apos;Tom Park&apos;,
[(&apos;Marc Wallace&apos;, 2),
 (&apos;Ronald Odom&apos;, 1),
 (&apos;Jessica Rich&apos;, 1),
 (&apos;Vicki Mills&apos;, 1),
 (&apos;Paige Cherry&apos;, 1)]),
(&apos;Frances Wagner&apos;,
[(&apos;Randall Hinson&apos;, 1),
 (&apos;Nelson Pierce&apos;, 1),
 (&apos;Beth Willis&apos;, 1),
 (&apos;Theresa Dyer&apos;, 1),
 (&apos;Gretchen Goldstein&apos;, 1)])]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><strong> That's the final recommendations! For example <em>Marc Wallace</em> is the top recommendation for <em>Tom park</em> as they have 2 common friends. </strong></li>
</ul>

</div>
</div>
</div>
  </div>
</div>

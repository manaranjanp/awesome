---
layout: post
title: "Analyzing Apache Log files using Spark APIs"
date: 2016-05-25
description: "Analyzing publicly available NASA log files using Spark"
main-class: 'spark'
published: true
postbook: 'inotebook'
color: '#7AAB13'
tags:
- spark
- 'log files'
- 'unstructured data'
- "data Science"
- pyspark
- 'log analysis'
categories:
- spark
introduction: "Analyzing publicly available NASA log files using Spark"
---

<div tabindex="-1" id="notebook" class="border-box-sizing">
  <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Analyzing-Apache-Log-Files">Analyzing Apache Log Files<a class="anchor-link" href="#Analyzing-Apache-Log-Files">&#182;</a></h2><ul>
<li>This tutorial will cover the steps of processing log files
<ul>
<li>Read the log file as a dataframe</li>
<li>Parse each log line, extract relevent fields and create a structured dataframe</li>
<li>Check for bad records or bad data elements</li>
<li>Clean up the fields and create a clean data set</li>
<li>Do some basic exploratory analysis to find insights</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Load-the-log-file">Load the log file<a class="anchor-link" href="#Load-the-log-file">&#182;</a></h3>The data set from NASA Kennedy Space Center web server in Florida. The full data set is freely available at <a href="http://ita.ee.lbl.gov/html/contrib/NASA-HTTP.html">http://ita.ee.lbl.gov/html/contrib/NASA-HTTP.html</a>, and it contains all HTTP requests for the month of august.

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Read the log file using <code>sqlContext.read.text()</code> into a dataframe. Each log line become a row or record with a single string column called <code>value</code>.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="k">import</span> <span class="n">SQLContext</span>
<span class="n">sqlContext</span> <span class="o">=</span> <span class="n">SQLContext</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">log_file</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">text</span><span class="p">(</span> <span class="s">&quot;file:///home/hadoop/lab/data/access_log_Aug95&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">log_file</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">5</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+--------------------+
|               value|
+--------------------+
|in24.inetnebr.com...|
|uplherc.upl.com -...|
|uplherc.upl.com -...|
|uplherc.upl.com -...|
|uplherc.upl.com -...|
+--------------------+
only showing top 5 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">log_file</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+--------------------------------------------------------------------------------------------------------------------------+
|value                                                                                                                     |
+--------------------------------------------------------------------------------------------------------------------------+
|in24.inetnebr.com - - [01/Aug/1995:00:00:01 -0400] &quot;GET /shuttle/missions/sts-68/news/sts-68-mcc-05.txt HTTP/1.0&quot; 200 1839|
|uplherc.upl.com - - [01/Aug/1995:00:00:07 -0400] &quot;GET / HTTP/1.0&quot; 304 0                                                   |
|uplherc.upl.com - - [01/Aug/1995:00:00:08 -0400] &quot;GET /images/ksclogo-medium.gif HTTP/1.0&quot; 304 0                          |
|uplherc.upl.com - - [01/Aug/1995:00:00:08 -0400] &quot;GET /images/MOSAIC-logosmall.gif HTTP/1.0&quot; 304 0                        |
|uplherc.upl.com - - [01/Aug/1995:00:00:08 -0400] &quot;GET /images/USA-logosmall.gif HTTP/1.0&quot; 304 0                           |
+--------------------------------------------------------------------------------------------------------------------------+
only showing top 5 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Parsing-the-log-file-and-extract-relevant-fields">Parsing the log file and extract relevant fields<a class="anchor-link" href="#Parsing-the-log-file-and-extract-relevant-fields">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>The logs are in <a href="https://www.w3.org/Daemon/User/Config/Logging.html#common-logfile-format">Common Log Format</a>.<
</li>
<li>The fields are
<ul>
<li><strong><em>remotehost rfc931 authuser [date] "request" status bytes</em></strong></li>
</ul>
</li>
</ul>
<table>
<thead><tr>
<th>field</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>remotehost</em></td>
<td>hostname or IP addredd of the machine which made the http request</td>
</tr>
<tr>
<td><em>rfc931</em></td>
<td>Remote logname of the user.</td>
</tr>
<tr>
<td><em>authuser</em></td>
<td>Username of the remote user, as authenticated by the HTTP server.</td>
</tr>
<tr>
<td><em>[date]</em></td>
<td>The date and time of the http request arriving at the web server.</td>
</tr>
<tr>
<td><em>"request"</em></td>
<td>The http request url from the browser</td>
</tr>
<tr>
<td><em>status</em></td>
<td>The HTTP status code, which server sent back to the client.</td>
</tr>
<tr>
<td><em>bytes</em></td>
<td>The number of bytes <em>Content-Length</em> transferred back to the client.</td>
</tr>
</tbody>
</table>
<p>Spark sql function <a href="http://spark.apache.org/docs/latest/api/python/pyspark.sql.html#pyspark.sql.functions.regexp_extract">regexp_extract()</a>
be used to extract the fields from each log line.</p>
<p>Details of regex can be found at <a href="http://regexone.com/">RegexOne web site</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="k">import</span> <span class="n">split</span><span class="p">,</span> <span class="n">regexp_extract</span>
<span class="n">split_df</span> <span class="o">=</span> <span class="n">log_file</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">regexp_extract</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="s">r&#39;^([^\s]+\s)&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;host&#39;</span><span class="p">),</span>
                        <span class="n">regexp_extract</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="s">r&#39;^.*\[(\d\d/\w{3}/\d{4}:\d{2}:\d{2}:\d{2} -\d{4})]&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;timestamp&#39;</span><span class="p">),</span>
                        <span class="n">regexp_extract</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="s">r&#39;^.*&quot;\w+\s+([^\s]+)\s+HTTP.*&quot;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;path&#39;</span><span class="p">),</span>
                        <span class="n">regexp_extract</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="s">r&#39;^.*&quot;\s+([^\s]+)&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;status&#39;</span><span class="p">),</span>
                        <span class="n">regexp_extract</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="s">r&#39;^.*\s+(\d+)$&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;content_size&#39;</span><span class="p">))</span>
<span class="n">split_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+------------------+--------------------------+-----------------------------------------------+------+------------+
|host              |timestamp                 |path                                           |status|content_size|
+------------------+--------------------------+-----------------------------------------------+------+------------+
|in24.inetnebr.com |01/Aug/1995:00:00:01 -0400|/shuttle/missions/sts-68/news/sts-68-mcc-05.txt|200   |1839        |
|uplherc.upl.com   |01/Aug/1995:00:00:07 -0400|/                                              |304   |0           |
+------------------+--------------------------+-----------------------------------------------+------+------------+
only showing top 2 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Cache-the-dataframe">Cache the dataframe<a class="anchor-link" href="#Cache-the-dataframe">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">split_df</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[6]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>DataFrame[host: string, timestamp: string, path: string, status: int, content_size: int]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Data-Cleaning">Data Cleaning<a class="anchor-link" href="#Data-Cleaning">&#182;</a></h3>Let's see how well our parsing logic worked. First, let's verify that there are no null rows in the original data set.

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">split_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[7]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[&apos;host&apos;, &apos;timestamp&apos;, &apos;path&apos;, &apos;status&apos;, &apos;content_size&apos;]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="How-many-null-records-are-available-in-the-original-file">How many null records are available in the original file<a class="anchor-link" href="#How-many-null-records-are-available-in-the-original-file">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">log_file</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">log_file</span><span class="p">[</span><span class="s">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isNull</span><span class="p">()</span> <span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[8]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>0</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Not-a-single-null-log-entry-found-in-the-original-file.">Not a single null log entry found in the original file.<a class="anchor-link" href="#Not-a-single-null-log-entry-found-in-the-original-file.">&#182;</a></h4><h4 id="So,-how-many-null-values-in-the-columns-were-found-after-parsing-the-records">So, how many null values in the columns were found after parsing the records<a class="anchor-link" href="#So,-how-many-null-values-in-the-columns-were-found-after-parsing-the-records">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">bad_rows_df</span> <span class="o">=</span> <span class="n">split_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">split_df</span><span class="p">[</span><span class="s">&#39;host&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isNull</span><span class="p">()</span> <span class="o">|</span>
                            <span class="n">split_df</span><span class="p">[</span><span class="s">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isNull</span><span class="p">()</span> <span class="o">|</span>
                            <span class="n">split_df</span><span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isNull</span><span class="p">()</span> <span class="o">|</span>
                            <span class="n">split_df</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isNull</span><span class="p">()</span> <span class="o">|</span>
                           <span class="n">split_df</span><span class="p">[</span><span class="s">&#39;content_size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isNull</span><span class="p">())</span>
<span class="n">bad_rows_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[9]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>14178</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="There-seems-to-be-14178-rows-which-contains-the-null-values-after-parsing-the-records-or-applying-regular-expressions">There seems to be 14178 rows which contains the null values after parsing the records or applying regular expressions<a class="anchor-link" href="#There-seems-to-be-14178-rows-which-contains-the-null-values-after-parsing-the-records-or-applying-regular-expressions">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="k">import</span> <span class="n">Column</span>

<span class="k">def</span> <span class="nf">count_null</span><span class="p">(</span> <span class="n">col_name</span> <span class="p">):</span>
  <span class="k">return</span> <span class="n">split_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">split_df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">isNull</span><span class="p">()</span> <span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">split_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span> <span class="n">col_name</span><span class="p">,</span> <span class="s">&quot; : &quot;</span><span class="p">,</span> <span class="n">count_null</span><span class="p">(</span> <span class="n">col_name</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>host  :  0
timestamp  :  0
path  :  0
status  :  0
content_size  :  14178
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Looks-like-there-are-many-nulls-in-the-content_size-column.-Rest-all-columns-seem-to-be-fine">Looks like there are many nulls in the content_size column. Rest all columns seem to be fine<a class="anchor-link" href="#Looks-like-there-are-many-nulls-in-the-content_size-column.-Rest-all-columns-seem-to-be-fine">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">split_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">split_df</span><span class="p">[</span><span class="s">&quot;content_size&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isNull</span><span class="p">()</span> <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">5</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+--------------------+--------------------+--------------------+------+------------+
|                host|           timestamp|                path|status|content_size|
+--------------------+--------------------+--------------------+------+------------+
|        gw1.att.com |01/Aug/1995:00:03...|/shuttle/missions...|   302|        null|
|js002.cc.utsunomi...|01/Aug/1995:00:07...|/shuttle/resource...|   404|        null|
|    tia1.eskimo.com |01/Aug/1995:00:28...|/pub/winvn/releas...|   404|        null|
|itws.info.eng.nii...|01/Aug/1995:00:38...|/ksc.html/facts/a...|   403|        null|
|grimnet23.idirect...|01/Aug/1995:00:50...|/www/software/win...|   404|        null|
+--------------------+--------------------+--------------------+------+------------+
only showing top 5 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Find-out-frequencies-of-null-values-for-each-status-code.">Find out frequencies of null values for each status code.<a class="anchor-link" href="#Find-out-frequencies-of-null-values-for-each-status-code.">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="p">(</span> <span class="n">split_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
  <span class="n">split_df</span><span class="p">[</span><span class="s">&quot;content_size&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isNull</span><span class="p">()</span> <span class="p">)</span>
  <span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s">&quot;status&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+------+-----+
|status|count|
+------+-----+
|   501|   27|
|   302| 3836|
|   200|   78|
|   400|   10|
|   403|  171|
|   404|10056|
+------+-----+

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Find-out-the-original-log-lines-which-converts-to-null-values">Find out the original log lines which converts to null values<a class="anchor-link" href="#Find-out-the-original-log-lines-which-converts-to-null-values">&#182;</a></h4><ul>
<li>Check with regular expression if the filed is not a digit</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="p">(</span> <span class="n">log_file</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
      <span class="o">~</span><span class="n">log_file</span><span class="p">[</span><span class="s">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">rlike</span><span class="p">(</span><span class="s">&#39;&#39;&#39;\d+$&#39;&#39;&#39;</span><span class="p">))</span>
      <span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="n">truncate</span> <span class="o">=</span> <span class="k">False</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+---------------------------------------------------------------------------------------------------------------------------+
|value                                                                                                                      |
+---------------------------------------------------------------------------------------------------------------------------+
|gw1.att.com - - [01/Aug/1995:00:03:53 -0400] &quot;GET /shuttle/missions/sts-73/news HTTP/1.0&quot; 302 -                            |
|js002.cc.utsunomiya-u.ac.jp - - [01/Aug/1995:00:07:33 -0400] &quot;GET /shuttle/resources/orbiters/discovery.gif HTTP/1.0&quot; 404 -|
|tia1.eskimo.com - - [01/Aug/1995:00:28:41 -0400] &quot;GET /pub/winvn/release.txt HTTP/1.0&quot; 404 -                               |
|itws.info.eng.niigata-u.ac.jp - - [01/Aug/1995:00:38:01 -0400] &quot;GET /ksc.html/facts/about_ksc.html HTTP/1.0&quot; 403 -         |
|grimnet23.idirect.com - - [01/Aug/1995:00:50:12 -0400] &quot;GET /www/software/winvn/winvn.html HTTP/1.0&quot; 404 -                 |
+---------------------------------------------------------------------------------------------------------------------------+
only showing top 5 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="We-know-that-it-is-for-the-requests-for-which-the-server-did-not-return-any-response">We know that it is for the requests for which the server did not return any response<a class="anchor-link" href="#We-know-that-it-is-for-the-requests-for-which-the-server-did-not-return-any-response">&#182;</a></h4><ul>
<li>We can convert all null values to 0 </li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">cleaned_df</span> <span class="o">=</span> <span class="n">split_df</span><span class="o">.</span><span class="n">na</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span> <span class="mi">0</span> <span class="p">)</span>
<span class="n">cleaned_df</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[15]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>DataFrame[host: string, timestamp: string, path: string, status: int, content_size: int]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Do-we-have-any-more-null-values?">Do we have any more null values?<a class="anchor-link" href="#Do-we-have-any-more-null-values?">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">cleaned_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">cleaned_df</span><span class="p">[</span><span class="s">&quot;content_size&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isNull</span><span class="p">()</span> <span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[16]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>0</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Find-out-most-frquently-accessed-pages">Find out most frquently accessed pages<a class="anchor-link" href="#Find-out-most-frquently-accessed-pages">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[22]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="k">import</span> <span class="n">desc</span>

<span class="n">top_10_pages</span> <span class="o">=</span> <span class="n">cleaned_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s">&quot;path&quot;</span> <span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span> <span class="n">desc</span><span class="p">(</span> <span class="s">&quot;count&quot;</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[23]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">top_10_pages</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">10</span><span class="p">,</span> <span class="n">truncate</span> <span class="o">=</span> <span class="k">False</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+---------------------------------------+-----+
|path                                   |count|
+---------------------------------------+-----+
|/images/NASA-logosmall.gif             |97275|
|/images/KSC-logosmall.gif              |75283|
|/images/MOSAIC-logosmall.gif           |67356|
|/images/USA-logosmall.gif              |66975|
|/images/WORLD-logosmall.gif            |66351|
|/images/ksclogo-medium.gif             |62670|
|/ksc.html                              |43618|
|/history/apollo/images/apollo-logo1.gif|37806|
|/images/launch-logo.gif                |35119|
|/                                      |30105|
+---------------------------------------+-----+
only showing top 10 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Seems-like-lot-of-images-which-are-embedded-into-pages">Seems like lot of images which are embedded into pages<a class="anchor-link" href="#Seems-like-lot-of-images-which-are-embedded-into-pages">&#182;</a></h4><h3 id="Find-out-the-html-pages-which-are-frequently-accessed">Find out the html pages which are frequently accessed<a class="anchor-link" href="#Find-out-the-html-pages-which-are-frequently-accessed">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[29]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">only_html_pages</span> <span class="o">=</span> <span class="n">cleaned_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">cleaned_df</span><span class="p">[</span><span class="s">&quot;path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">rlike</span><span class="p">(</span> <span class="s">&#39;html&#39;</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[30]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">top_10_pages</span> <span class="o">=</span> <span class="n">only_html_pages</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s">&quot;path&quot;</span> <span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span> <span class="n">desc</span><span class="p">(</span> <span class="s">&quot;count&quot;</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">top_10_pages</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">10</span><span class="p">,</span> <span class="n">truncate</span> <span class="o">=</span> <span class="k">False</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+-----------------------------------------------+-----+
|path                                           |count|
+-----------------------------------------------+-----+
|/ksc.html                                      |43618|
|/shuttle/missions/sts-69/mission-sts-69.html   |24592|
|/shuttle/missions/missions.html                |22429|
|/software/winvn/winvn.html                     |10343|
|/history/history.html                          |10111|
|/history/apollo/apollo.html                    |8973 |
|/shuttle/countdown/liftoff.html                |7858 |
|/history/apollo/apollo-13/apollo-13.html       |7160 |
|/shuttle/technology/sts-newsref/stsref-toc.html|6506 |
|/shuttle/missions/sts-69/images/images.html    |5260 |
+-----------------------------------------------+-----+
only showing top 10 rows

</pre>
</div>
</div>

</div>
</div>

</div>
  </div>
</div>

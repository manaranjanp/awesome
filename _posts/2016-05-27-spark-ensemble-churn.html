---
layout: post
title: "Predict Customer Churn using Ensemble Methods"
date: 2016-05-29
description: "Using Spark MLlib to predict customer churn"
main-class: 'spark'
published: true
postbook: 'inotebook'
color: '#7AAB13'
tags:
- spark
- "data Science"
- pyspark
- 'customer churn'
- churn
- mllib
- classification
categories:
- spark
introduction: "Using Spark MLlib to predict customer churn"
---


<div tabindex="-1" id="notebook" class="border-box-sizing">
  <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Customer-Churn-Overview">Customer Churn Overview<a class="anchor-link" href="#Customer-Churn-Overview">&#182;</a></h3><ul>
<li>Companies invest significantly to acquire new customers. So, after acquisition, companies would like these customers to stay long and be loyal. Companies also make investments to keep engaging with these customers continuously and ensure they are happpy and satisfied with their offferings. Loosing customers mean loss of investment and loss of possible future revenue.</li>
<li>So, it is important for companies to infer early signs of a customer about to churn and engage or offer incentives to retain them. But as targetting each customer is not possibe, comapnies can take advantage of analytics to predict if a customer high probability of churing. A possible intervention can be made to retain the customer.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Things-to-learn">Things to learn<a class="anchor-link" href="#Things-to-learn">&#182;</a></h3><ul>
<li>Building Ensemble models like random forest and boosted trees</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">sc</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[1]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;pyspark.context.SparkContext at 0x7f1dcc2ba400&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="k">import</span> <span class="n">SQLContext</span>
<span class="n">sql_ctx</span> <span class="o">=</span> <span class="n">SQLContext</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Read-the-data-from-csv-file">Read the data from csv file<a class="anchor-link" href="#Read-the-data-from-csv-file">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_df</span> <span class="o">=</span> <span class="n">sql_ctx</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;com.databricks.spark.csv&quot;</span><span class="p">)</span>      \
 <span class="o">.</span><span class="n">options</span><span class="p">(</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">,</span>
          <span class="n">header</span>  <span class="o">=</span> <span class="k">True</span> <span class="p">,</span>
          <span class="n">inferSchema</span> <span class="o">=</span> <span class="k">True</span><span class="p">)</span>                                    \
  <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;file:///home/hadoop/lab/data/churn.csv&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Dataset-Description">Dataset Description<a class="anchor-link" href="#Dataset-Description">&#182;</a></h3><p>This dataset is taken from <a href="https://bigml.com/user/francisco/gallery/dataset/5163ad540c0b5e5b22000383">https://bigml.com/user/francisco/gallery/dataset/5163ad540c0b5e5b22000383</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">2</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+-----+--------------+---------+--------+----------+----------+-------------+--------+---------+----------+--------+---------+----------+----------+-----------+------------+---------+----------+-----------+--------------+------+
|State|Account Length|Area Code|   Phone|Int&apos;l Plan|VMail Plan|VMail Message|Day Mins|Day Calls|Day Charge|Eve Mins|Eve Calls|Eve Charge|Night Mins|Night Calls|Night Charge|Intl Mins|Intl Calls|Intl Charge|CustServ Calls|Churn?|
+-----+--------------+---------+--------+----------+----------+-------------+--------+---------+----------+--------+---------+----------+----------+-----------+------------+---------+----------+-----------+--------------+------+
|   KS|           128|      415|382-4657|        no|       yes|           25|   265.1|      110|     45.07|   197.4|       99|     16.78|     244.7|         91|       11.01|     10.0|         3|        2.7|             1|False.|
|   OH|           107|      415|371-7191|        no|       yes|           26|   161.6|      123|     27.47|   195.5|      103|     16.62|     254.4|        103|       11.45|     13.7|         3|        3.7|             1|False.|
+-----+--------------+---------+--------+----------+----------+-------------+--------+---------+----------+--------+---------+----------+----------+-----------+------------+---------+----------+-----------+--------------+------+
only showing top 2 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sn</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>:0: FutureWarning: IPython widgets are experimental and may change in the future.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="k">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">StringIndexer</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Encoding-the-categorical-variable">Encoding the categorical variable<a class="anchor-link" href="#Encoding-the-categorical-variable">&#182;</a></h3><ul>
<li>The following utility function is created to create categorical variables.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">create_category_vars</span><span class="p">(</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">field_name</span> <span class="p">):</span>
  <span class="n">idx_col</span> <span class="o">=</span> <span class="n">field_name</span> <span class="o">+</span> <span class="s">&quot;Index&quot;</span>
  <span class="n">col_vec</span> <span class="o">=</span> <span class="n">field_name</span> <span class="o">+</span> <span class="s">&quot;Vec&quot;</span>

  <span class="n">month_stringIndexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">(</span> <span class="n">inputCol</span><span class="o">=</span><span class="n">field_name</span><span class="p">,</span>
                                       <span class="n">outputCol</span><span class="o">=</span><span class="n">idx_col</span> <span class="p">)</span>

  <span class="n">month_model</span> <span class="o">=</span> <span class="n">month_stringIndexer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">dataset</span> <span class="p">)</span>
  <span class="n">month_indexed</span> <span class="o">=</span> <span class="n">month_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span> <span class="n">dataset</span> <span class="p">)</span>

  <span class="n">month_encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span> <span class="n">dropLast</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>
                                 <span class="n">inputCol</span><span class="o">=</span><span class="n">idx_col</span><span class="p">,</span>
                                 <span class="n">outputCol</span><span class="o">=</span> <span class="n">col_vec</span> <span class="p">)</span>

  <span class="k">return</span> <span class="n">month_encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span> <span class="n">month_indexed</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Select-only-a-subset-of-columns">Select only a subset of columns<a class="anchor-link" href="#Select-only-a-subset-of-columns">&#182;</a></h3><ul>
<li>Some columns are highly corelated e.g. Call minutes, calls and charges. So, only one of the variable can be used. This is applicable across day, eve, night and international calls.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[8]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[&apos;State&apos;,
&apos;Account Length&apos;,
&apos;Area Code&apos;,
&apos;Phone&apos;,
&quot;Int&apos;l Plan&quot;,
&apos;VMail Plan&apos;,
&apos;VMail Message&apos;,
&apos;Day Mins&apos;,
&apos;Day Calls&apos;,
&apos;Day Charge&apos;,
&apos;Eve Mins&apos;,
&apos;Eve Calls&apos;,
&apos;Eve Charge&apos;,
&apos;Night Mins&apos;,
&apos;Night Calls&apos;,
&apos;Night Charge&apos;,
&apos;Intl Mins&apos;,
&apos;Intl Calls&apos;,
&apos;Intl Charge&apos;,
&apos;CustServ Calls&apos;,
&apos;Churn?&apos;]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_df_subset</span> <span class="o">=</span> <span class="n">churn_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">&#39;Account Length&#39;</span><span class="p">,</span>
                                <span class="s">&quot;Int&#39;l Plan&quot;</span><span class="p">,</span>
                                <span class="s">&#39;VMail Plan&#39;</span><span class="p">,</span>
                                <span class="s">&#39;VMail Message&#39;</span><span class="p">,</span>
                                <span class="s">&#39;Day Mins&#39;</span><span class="p">,</span>
                                <span class="s">&#39;Eve Mins&#39;</span><span class="p">,</span>
                                <span class="s">&#39;Night Mins&#39;</span><span class="p">,</span>
                                <span class="s">&#39;Intl Mins&#39;</span><span class="p">,</span>
                                <span class="s">&#39;CustServ Calls&#39;</span><span class="p">,</span>
                                <span class="s">&#39;Churn?&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_df_subset</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[10]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[&apos;Account Length&apos;,
&quot;Int&apos;l Plan&quot;,
&apos;VMail Plan&apos;,
&apos;VMail Message&apos;,
&apos;Day Mins&apos;,
&apos;Eve Mins&apos;,
&apos;Night Mins&apos;,
&apos;Intl Mins&apos;,
&apos;CustServ Calls&apos;,
&apos;Churn?&apos;]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Transform-Target-Variable">Transform Target Variable<a class="anchor-link" href="#Transform-Target-Variable">&#182;</a></h3><ul>
<li>'Churn?' variable is converted into integer</li>
<li>True. will be 1 and False. will be 1</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_df_subset</span> <span class="o">=</span> <span class="n">churn_df_subset</span>                       \
  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span> <span class="s">&quot;Churn&quot;</span><span class="p">,</span>
              <span class="p">(</span> <span class="n">churn_df_subset</span><span class="p">[</span><span class="s">&#39;Churn?&#39;</span><span class="p">]</span>
               <span class="o">==</span> <span class="s">&#39;True.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">)</span> <span class="p">)</span>

<span class="n">churn_df_subset</span> <span class="o">=</span> <span class="n">churn_df_subset</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span> <span class="s">&#39;Churn?&#39;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="nb">type</span><span class="p">(</span> <span class="n">churn_df_subset</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[12]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>pyspark.sql.dataframe.DataFrame</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_df_subset</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">3</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+--------------+----------+----------+-------------+--------+--------+----------+---------+--------------+-----+
|Account Length|Int&apos;l Plan|VMail Plan|VMail Message|Day Mins|Eve Mins|Night Mins|Intl Mins|CustServ Calls|Churn|
+--------------+----------+----------+-------------+--------+--------+----------+---------+--------------+-----+
|           128|        no|       yes|           25|   265.1|   197.4|     244.7|     10.0|             1|    0|
|           107|        no|       yes|           26|   161.6|   195.5|     254.4|     13.7|             1|    0|
|           137|        no|        no|            0|   243.4|   121.2|     162.6|     12.2|             0|    0|
+--------------+----------+----------+-------------+--------+--------+----------+---------+--------------+-----+
only showing top 3 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-categorical-Variables">Create categorical Variables<a class="anchor-link" href="#Create-categorical-Variables">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_vec</span> <span class="o">=</span> <span class="n">create_category_vars</span><span class="p">(</span> <span class="n">churn_df_subset</span><span class="p">,</span>
                               <span class="s">&quot;Int&#39;l Plan&quot;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_vec</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">2</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+--------------+----------+----------+-------------+--------+--------+----------+---------+--------------+-----+---------------+-------------+
|Account Length|Int&apos;l Plan|VMail Plan|VMail Message|Day Mins|Eve Mins|Night Mins|Intl Mins|CustServ Calls|Churn|Int&apos;l PlanIndex|Int&apos;l PlanVec|
+--------------+----------+----------+-------------+--------+--------+----------+---------+--------------+-----+---------------+-------------+
|           128|        no|       yes|           25|   265.1|   197.4|     244.7|     10.0|             1|    0|            0.0|(1,[0],[1.0])|
|           107|        no|       yes|           26|   161.6|   195.5|     254.4|     13.7|             1|    0|            0.0|(1,[0],[1.0])|
+--------------+----------+----------+-------------+--------+--------+----------+---------+--------------+-----+---------------+-------------+
only showing top 2 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_vec</span> <span class="o">=</span> <span class="n">create_category_vars</span><span class="p">(</span> <span class="n">churn_vec</span><span class="p">,</span>
                               <span class="s">&quot;VMail Plan&quot;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_vec</span><span class="o">.</span><span class="n">select</span><span class="p">(</span> <span class="s">&quot;Int&#39;l PlanVec&quot;</span><span class="p">,</span>
               <span class="s">&quot;VMail PlanVec&quot;</span> <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">5</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+-------------+-------------+
|Int&apos;l PlanVec|VMail PlanVec|
+-------------+-------------+
|(1,[0],[1.0])|    (1,[],[])|
|(1,[0],[1.0])|    (1,[],[])|
|(1,[0],[1.0])|(1,[0],[1.0])|
|    (1,[],[])|(1,[0],[1.0])|
|    (1,[],[])|(1,[0],[1.0])|
+-------------+-------------+
only showing top 5 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[18]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.mllib.linalg</span> <span class="k">import</span> <span class="n">Vectors</span>
<span class="kn">from</span> <span class="nn">pyspark.mllib.regression</span> <span class="k">import</span> <span class="n">LabeledPoint</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Creating-the-vectors">Creating the vectors<a class="anchor-link" href="#Creating-the-vectors">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[19]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">parseNewPoint</span><span class="p">(</span> <span class="n">rec</span> <span class="p">):</span>
  <span class="k">return</span> <span class="n">LabeledPoint</span><span class="p">(</span> <span class="nb">float</span><span class="p">(</span> <span class="n">rec</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="p">),</span>
          <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span> <span class="p">[</span><span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">rec</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                <span class="n">rec</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                                <span class="n">rec</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                                <span class="n">rec</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                                <span class="n">rec</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
                                <span class="n">rec</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="p">]</span> <span class="o">+</span>
                                <span class="n">rec</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span>
                                <span class="n">rec</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[20]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_vec_new</span> <span class="o">=</span> <span class="n">churn_vec</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                            <span class="n">parseNewPoint</span><span class="p">(</span> <span class="n">rec</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[21]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_vec_new</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">5</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[21]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[LabeledPoint(0.0, [128.0,25.0,265.1,197.4,244.7,10.0,1.0,1.0,0.0]),
LabeledPoint(0.0, [107.0,26.0,161.6,195.5,254.4,13.7,1.0,1.0,0.0]),
LabeledPoint(0.0, [137.0,0.0,243.4,121.2,162.6,12.2,0.0,1.0,1.0]),
LabeledPoint(0.0, [84.0,0.0,299.4,61.9,196.9,6.6,2.0,0.0,1.0]),
LabeledPoint(0.0, [75.0,0.0,166.7,148.3,186.9,10.1,3.0,0.0,1.0])]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Split-dataset-into-train-and-test">Split dataset into train and test<a class="anchor-link" href="#Split-dataset-into-train-and-test">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[22]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">trainingData</span><span class="p">,</span> <span class="n">testData</span> <span class="o">=</span> <span class="n">churn_vec_new</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Building-the-model-and-making-predictions">Building the model and making predictions<a class="anchor-link" href="#Building-the-model-and-making-predictions">&#182;</a></h2><h3 id="Logistic-Regression-Model">Logistic Regression Model<a class="anchor-link" href="#Logistic-Regression-Model">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[23]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.mllib.classification</span> <span class="k">import</span> <span class="n">LogisticRegressionWithLBFGS</span><span class="p">,</span>    \
                                       <span class="n">LogisticRegressionModel</span>
<span class="kn">from</span> <span class="nn">pyspark.mllib.evaluation</span> <span class="k">import</span> <span class="n">BinaryClassificationMetrics</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[24]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c">## Training the model</span>
<span class="n">lr_model</span> <span class="o">=</span> <span class="n">LogisticRegressionWithLBFGS</span><span class="o">.</span><span class="n">train</span><span class="p">(</span> <span class="n">trainingData</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Performance-Metrics-of-the-Model">Performance Metrics of the Model<a class="anchor-link" href="#Performance-Metrics-of-the-Model">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[25]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">labelsAndPreds_lr</span> <span class="o">=</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span>
                               <span class="p">(</span> <span class="nb">float</span><span class="p">(</span><span class="n">lr_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">lp</span><span class="o">.</span><span class="n">features</span><span class="p">)</span> <span class="p">),</span> <span class="n">lp</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">success_count_lr</span> <span class="o">=</span> <span class="n">labelsAndPreds_lr</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                            <span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s">&quot;Successful prediction percentage: &quot;</span> <span class="o">+</span>
    <span class="nb">str</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span> <span class="n">success_count_lr</span> <span class="o">/</span> <span class="n">labelsAndPreds_lr</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Successful prediction percentage: 0.85
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[26]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.mllib.evaluation</span> <span class="k">import</span> <span class="n">MulticlassMetrics</span>

<span class="n">metrics</span> <span class="o">=</span> <span class="n">MulticlassMetrics</span><span class="p">(</span> <span class="n">labelsAndPreds_lr</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[27]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">printMetric</span><span class="p">(</span> <span class="n">metrics</span> <span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span> <span class="s">&#39;Precision of True &#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">precision</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>

  <span class="nb">print</span><span class="p">(</span> <span class="s">&#39;Precision of False&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">precision</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span> <span class="s">&#39;Recall of True    &#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span> <span class="s">&#39;Recall of False   &#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span> <span class="s">&#39;F-1 Score         &#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">fMeasure</span><span class="p">()</span> <span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span> <span class="s">&#39;Confusion Matrix</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusionMatrix</span><span class="p">()</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[28]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">printMetric</span><span class="p">(</span> <span class="n">metrics</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Precision of True  0.4444444444444444
Precision of False 0.8710691823899371
Recall of True     0.16326530612244897
Recall of False    0.9651567944250871
F-1 Score          0.8482142857142857
Confusion Matrix
[[ 831.   30.]
[ 123.   24.]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-Confusion-matrix-and-check-ROC-score">Create Confusion matrix and check ROC score<a class="anchor-link" href="#Create-Confusion-matrix-and-check-ROC-score">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[29]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">labelsAndPreds_lr_df</span> <span class="o">=</span> <span class="n">labelsAndPreds_lr</span><span class="o">.</span><span class="n">toDF</span><span class="p">()</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[30]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">labelsAndPreds_lr_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span> <span class="mi">5</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[30]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
<thead>
  <tr style="text-align: right;">
    <th></th>
    <th>_1</th>
    <th>_2</th>
  </tr>
</thead>
<tbody>
  <tr>
    <th>0</th>
    <td>1</td>
    <td>0</td>
  </tr>
  <tr>
    <th>1</th>
    <td>0</td>
    <td>0</td>
  </tr>
  <tr>
    <th>2</th>
    <td>0</td>
    <td>0</td>
  </tr>
  <tr>
    <th>3</th>
    <td>0</td>
    <td>0</td>
  </tr>
  <tr>
    <th>4</th>
    <td>0</td>
    <td>0</td>
  </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[31]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">sklearn</span> <span class="k">import</span> <span class="n">metrics</span> <span class="k">as</span> <span class="n">smetrics</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sn</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[32]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">cm</span> <span class="o">=</span> <span class="n">smetrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">labelsAndPreds_lr_df</span><span class="o">.</span><span class="n">_2</span><span class="p">,</span> <span class="n">labelsAndPreds_lr_df</span><span class="o">.</span><span class="n">_1</span> <span class="p">)</span>
<span class="n">sn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;.2f&#39;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[32]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f1d9a363eb8&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Decision-Tree-Model">Decision Tree Model<a class="anchor-link" href="#Decision-Tree-Model">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[33]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.mllib.tree</span> <span class="k">import</span> <span class="n">DecisionTree</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Build-model,-make-prediction-and-check-accuracy">Build model, make prediction and check accuracy<a class="anchor-link" href="#Build-model,-make-prediction-and-check-accuracy">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[34]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">tree_model</span> <span class="o">=</span> <span class="n">DecisionTree</span><span class="o">.</span><span class="n">trainClassifier</span><span class="p">(</span><span class="n">trainingData</span><span class="p">,</span>
                                        <span class="n">numClasses</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                        <span class="n">categoricalFeaturesInfo</span><span class="o">=</span><span class="p">{</span><span class="mi">7</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span>
                                        <span class="n">impurity</span><span class="o">=</span><span class="s">&#39;gini&#39;</span><span class="p">,</span>
                                        <span class="n">maxDepth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                        <span class="n">maxBins</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[35]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="nb">print</span><span class="p">(</span> <span class="n">tree_model</span><span class="o">.</span><span class="n">toDebugString</span><span class="p">()</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>DecisionTreeModel classifier of depth 4 with 29 nodes
If (feature 2 &lt;= 265.2)
 If (feature 6 &lt;= 3.0)
  If (feature 7 in {0.0})
   If (feature 5 &lt;= 12.9)
    Predict: 0.0
   Else (feature 5 &gt; 12.9)
    Predict: 1.0
  Else (feature 7 not in {0.0})
   If (feature 2 &lt;= 221.1)
    Predict: 0.0
   Else (feature 2 &gt; 221.1)
    Predict: 0.0
 Else (feature 6 &gt; 3.0)
  If (feature 2 &lt;= 160.7)
   If (feature 3 &lt;= 266.9)
    Predict: 1.0
   Else (feature 3 &gt; 266.9)
    Predict: 0.0
  Else (feature 2 &gt; 160.7)
   If (feature 3 &lt;= 142.3)
    Predict: 1.0
   Else (feature 3 &gt; 142.3)
    Predict: 0.0
Else (feature 2 &gt; 265.2)
 If (feature 1 &lt;= 0.0)
  If (feature 3 &lt;= 142.3)
   Predict: 0.0
  Else (feature 3 &gt; 142.3)
   If (feature 4 &lt;= 156.7)
    Predict: 1.0
   Else (feature 4 &gt; 156.7)
    Predict: 1.0
 Else (feature 1 &gt; 0.0)
  If (feature 7 in {1.0})
   If (feature 3 &lt;= 259.4)
    Predict: 0.0
   Else (feature 3 &gt; 259.4)
    Predict: 0.0
  Else (feature 7 not in {1.0})
   If (feature 5 &lt;= 8.1)
    Predict: 0.0
   Else (feature 5 &gt; 8.1)
    Predict: 1.0

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[36]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">tree_predictions</span> <span class="o">=</span> <span class="n">tree_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="o">.</span><span class="n">features</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">labelsAndPreds_tree</span> <span class="o">=</span> <span class="n">tree_predictions</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[37]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">success_count_tree</span> <span class="o">=</span> <span class="n">labelsAndPreds_tree</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                            <span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s">&quot;Successful prediction percentage: &quot;</span> <span class="o">+</span>
    <span class="nb">str</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span> <span class="n">success_count_tree</span> <span class="o">/</span> <span class="n">labelsAndPreds_tree</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Successful prediction percentage: 0.91
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[38]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">tmetrics</span> <span class="o">=</span> <span class="n">MulticlassMetrics</span><span class="p">(</span> <span class="n">labelsAndPreds_tree</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[39]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">printMetric</span><span class="p">(</span> <span class="n">tmetrics</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Precision of True  0.8426966292134831
Precision of False 0.9216539717083787
Recall of True     0.5102040816326531
Recall of False    0.983739837398374
F-1 Score          0.9146825396825397
Confusion Matrix
[[ 847.   14.]
[  72.   75.]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[40]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">labelsAndPreds_tree_df</span> <span class="o">=</span> <span class="n">labelsAndPreds_tree</span><span class="o">.</span><span class="n">toDF</span><span class="p">()</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="n">cm_tree</span> <span class="o">=</span> <span class="n">smetrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">labelsAndPreds_tree_df</span><span class="o">.</span><span class="n">_2</span><span class="p">,</span> <span class="n">labelsAndPreds_tree_df</span><span class="o">.</span><span class="n">_1</span> <span class="p">)</span>
<span class="n">sn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm_tree</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;.2f&#39;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[40]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f1d9a28ff98&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
RK5CYII=
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Under-Sampling-to-overcome-unbalanced-representation-of-classes">Under Sampling to overcome unbalanced representation of classes<a class="anchor-link" href="#Under-Sampling-to-overcome-unbalanced-representation-of-classes">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>There are roughly 5-6 times as many no-churn samples as there are churn samples. Both class types can be made to represent equally by using techniques of undersampling or downsampling.
</li>
<li>The DataFrames sampleBy() function will be used with fractions of each sample type to be selected.
</li>
<li>All instances of the Churn=True class will be in the new dataset, but the Churn=False class will be undersampled to a fraction of 500/2850.
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[41]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_vec</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&#39;Churn&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[41]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
<thead>
  <tr style="text-align: right;">
    <th></th>
    <th>Churn</th>
    <th>count</th>
  </tr>
</thead>
<tbody>
  <tr>
    <th>0</th>
    <td>0</td>
    <td>2850</td>
  </tr>
  <tr>
    <th>1</th>
    <td>1</td>
    <td>483</td>
  </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[42]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">undersample_churn_vec</span> <span class="o">=</span> <span class="n">churn_vec</span><span class="o">.</span><span class="n">sampleBy</span><span class="p">(</span><span class="s">&#39;Churn&#39;</span><span class="p">,</span> <span class="n">fractions</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mf">500.0</span><span class="o">/</span><span class="mf">2850.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">})</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

<span class="n">undersample_churn_vec</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&#39;Churn&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[42]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
<thead>
  <tr style="text-align: right;">
    <th></th>
    <th>Churn</th>
    <th>count</th>
  </tr>
</thead>
<tbody>
  <tr>
    <th>0</th>
    <td>0</td>
    <td>510</td>
  </tr>
  <tr>
    <th>1</th>
    <td>1</td>
    <td>483</td>
  </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Logistic-Regression-with-undersampled-dataset">Logistic Regression with undersampled dataset<a class="anchor-link" href="#Logistic-Regression-with-undersampled-dataset">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[43]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_vec_new</span> <span class="o">=</span> <span class="n">undersample_churn_vec</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                            <span class="n">parseNewPoint</span><span class="p">(</span> <span class="n">rec</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">trainingData</span><span class="p">,</span> <span class="n">testData</span> <span class="o">=</span> <span class="n">churn_vec_new</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>

<span class="n">lr_model</span> <span class="o">=</span> <span class="n">LogisticRegressionWithLBFGS</span><span class="o">.</span><span class="n">train</span><span class="p">(</span> <span class="n">trainingData</span> <span class="p">)</span>

<span class="n">labelsAndPreds_lr</span> <span class="o">=</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span>
                               <span class="p">(</span> <span class="nb">float</span><span class="p">(</span><span class="n">lr_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">lp</span><span class="o">.</span><span class="n">features</span><span class="p">)</span> <span class="p">),</span> <span class="n">lp</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">success_count_lr</span> <span class="o">=</span> <span class="n">labelsAndPreds_lr</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                            <span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s">&quot;Successful prediction percentage: &quot;</span> <span class="o">+</span>
    <span class="nb">str</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span> <span class="n">success_count_lr</span> <span class="o">/</span> <span class="n">labelsAndPreds_lr</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">metrics</span> <span class="o">=</span> <span class="n">MulticlassMetrics</span><span class="p">(</span> <span class="n">labelsAndPreds_lr</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Successful prediction percentage: 0.75
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[44]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">printMetric</span><span class="p">(</span> <span class="n">metrics</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Precision of True  0.7886178861788617
Precision of False 0.7247191011235955
Recall of True     0.6643835616438356
Recall of False    0.832258064516129
F-1 Score          0.7508305647840532
Confusion Matrix
[[ 129.   26.]
[  49.   97.]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[45]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">labelsAndPreds_lr_df</span> <span class="o">=</span> <span class="n">labelsAndPreds_lr</span><span class="o">.</span><span class="n">toDF</span><span class="p">()</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">smetrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">labelsAndPreds_lr_df</span><span class="o">.</span><span class="n">_2</span><span class="p">,</span> <span class="n">labelsAndPreds_lr_df</span><span class="o">.</span><span class="n">_1</span> <span class="p">)</span>
<span class="n">sn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;.2f&#39;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[45]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f1d9a21feb8&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Decision-Tree-with-undersampled-dataset">Decision Tree with undersampled dataset<a class="anchor-link" href="#Decision-Tree-with-undersampled-dataset">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[46]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">tree_model</span> <span class="o">=</span> <span class="n">DecisionTree</span><span class="o">.</span><span class="n">trainClassifier</span><span class="p">(</span><span class="n">trainingData</span><span class="p">,</span>
                                        <span class="n">numClasses</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                        <span class="n">categoricalFeaturesInfo</span><span class="o">=</span><span class="p">{</span><span class="mi">7</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span>
                                        <span class="n">impurity</span><span class="o">=</span><span class="s">&#39;gini&#39;</span><span class="p">,</span>
                                        <span class="n">maxDepth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                        <span class="n">maxBins</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>

<span class="n">tree_predictions</span> <span class="o">=</span> <span class="n">tree_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="o">.</span><span class="n">features</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">labelsAndPreds_tree</span> <span class="o">=</span> <span class="n">tree_predictions</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">success_count_tree</span> <span class="o">=</span> <span class="n">labelsAndPreds_tree</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                            <span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s">&quot;Successful prediction percentage: &quot;</span> <span class="o">+</span>
    <span class="nb">str</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span> <span class="n">success_count_tree</span> <span class="o">/</span> <span class="n">labelsAndPreds_tree</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">tmetrics</span> <span class="o">=</span> <span class="n">MulticlassMetrics</span><span class="p">(</span> <span class="n">labelsAndPreds_tree</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Successful prediction percentage: 0.84
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[47]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">printMetric</span><span class="p">(</span> <span class="n">tmetrics</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Precision of True  0.9375
Precision of False 0.783068783068783
Recall of True     0.7191780821917808
Recall of False    0.9548387096774194
F-1 Score          0.840531561461794
Confusion Matrix
[[ 148.    7.]
[  41.  105.]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[48]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">labelsAndPreds_tree_df</span> <span class="o">=</span> <span class="n">labelsAndPreds_tree</span><span class="o">.</span><span class="n">toDF</span><span class="p">()</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="n">cm_tree</span> <span class="o">=</span> <span class="n">smetrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">labelsAndPreds_tree_df</span><span class="o">.</span><span class="n">_2</span><span class="p">,</span> <span class="n">labelsAndPreds_tree_df</span><span class="o">.</span><span class="n">_1</span> <span class="p">)</span>
<span class="n">sn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm_tree</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;.2f&#39;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[48]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f1d9a2003c8&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
oVoFxAvlCAAAAABJRU5ErkJggg==
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Random-Forest-Tree-Model">Random Forest Tree Model<a class="anchor-link" href="#Random-Forest-Tree-Model">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[49]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.mllib.tree</span> <span class="k">import</span> <span class="n">RandomForest</span><span class="p">,</span> <span class="n">RandomForestModel</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[50]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">rf_model</span> <span class="o">=</span> <span class="n">RandomForest</span><span class="o">.</span><span class="n">trainClassifier</span><span class="p">(</span><span class="n">trainingData</span><span class="p">,</span>
                                      <span class="n">numClasses</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                      <span class="n">categoricalFeaturesInfo</span><span class="o">=</span><span class="p">{</span><span class="mi">7</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span>
                                      <span class="n">numTrees</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                                      <span class="n">impurity</span><span class="o">=</span><span class="s">&#39;entropy&#39;</span><span class="p">,</span>
                                      <span class="n">maxDepth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                      <span class="n">maxBins</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[51]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">rf_predictions</span> <span class="o">=</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="o">.</span><span class="n">features</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">labelsAndPreds_rf</span> <span class="o">=</span> <span class="n">rf_predictions</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">success_count_rf</span> <span class="o">=</span> <span class="n">labelsAndPreds_rf</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                            <span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s">&quot;Successful prediction percentage: &quot;</span> <span class="o">+</span>
    <span class="nb">str</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span> <span class="n">success_count_rf</span> <span class="o">/</span> <span class="n">labelsAndPreds_rf</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Successful prediction percentage: 0.87
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[52]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">rf_metrics</span> <span class="o">=</span> <span class="n">MulticlassMetrics</span><span class="p">(</span> <span class="n">labelsAndPreds_rf</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[53]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">printMetric</span><span class="p">(</span> <span class="n">rf_metrics</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Precision of True  0.8970588235294118
Precision of False 0.8545454545454545
Recall of True     0.8356164383561644
Recall of False    0.9096774193548387
F-1 Score          0.8737541528239202
Confusion Matrix
[[ 141.   14.]
[  24.  122.]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[54]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">labelsAndPreds_rf_df</span> <span class="o">=</span> <span class="n">labelsAndPreds_rf</span><span class="o">.</span><span class="n">toDF</span><span class="p">()</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="n">cm_rf</span> <span class="o">=</span> <span class="n">smetrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">labelsAndPreds_rf_df</span><span class="o">.</span><span class="n">_2</span><span class="p">,</span> <span class="n">labelsAndPreds_rf_df</span><span class="o">.</span><span class="n">_1</span> <span class="p">)</span>
<span class="n">sn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm_rf</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;.2f&#39;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[54]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f1d9a093160&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gradient-Boosted-Trees">Gradient Boosted Trees<a class="anchor-link" href="#Gradient-Boosted-Trees">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[55]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.mllib.tree</span> <span class="k">import</span> <span class="n">GradientBoostedTrees</span><span class="p">,</span> <span class="n">GradientBoostedTreesModel</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[56]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">gbt_model</span> <span class="o">=</span> <span class="n">GradientBoostedTrees</span><span class="o">.</span><span class="n">trainClassifier</span><span class="p">(</span><span class="n">trainingData</span><span class="p">,</span>
                                               <span class="n">categoricalFeaturesInfo</span><span class="o">=</span><span class="p">{</span><span class="mi">7</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span>
                                               <span class="n">numIterations</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[57]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">gbt_predictions</span> <span class="o">=</span> <span class="n">gbt_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="o">.</span><span class="n">features</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">labelsAndPreds_gbt</span> <span class="o">=</span> <span class="n">gbt_predictions</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">success_count_gbt</span> <span class="o">=</span> <span class="n">labelsAndPreds_gbt</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                            <span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s">&quot;Successful prediction percentage: &quot;</span> <span class="o">+</span>
    <span class="nb">str</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span> <span class="n">success_count_gbt</span> <span class="o">/</span> <span class="n">labelsAndPreds_gbt</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Successful prediction percentage: 0.87
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[58]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">gbt_metrics</span> <span class="o">=</span> <span class="n">MulticlassMetrics</span><span class="p">(</span> <span class="n">labelsAndPreds_gbt</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[59]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">printMetric</span><span class="p">(</span> <span class="n">gbt_metrics</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Precision of True  0.9140625
Precision of False 0.8323699421965318
Recall of True     0.8013698630136986
Recall of False    0.9290322580645162
F-1 Score          0.867109634551495
Confusion Matrix
[[ 144.   11.]
[  29.  117.]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[60]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">labelsAndPreds_gbt</span> <span class="o">=</span> <span class="n">labelsAndPreds_gbt</span><span class="o">.</span><span class="n">toDF</span><span class="p">()</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="n">cm_gbt</span> <span class="o">=</span> <span class="n">smetrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">labelsAndPreds_gbt</span><span class="o">.</span><span class="n">_1</span><span class="p">,</span> <span class="n">labelsAndPreds_gbt</span><span class="o">.</span><span class="n">_2</span> <span class="p">)</span>
<span class="n">sn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm_gbt</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;.2f&#39;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[60]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f1d9a0982e8&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Of-all-models,-random-forest,-which-is-an--ensemble-technique,-has-worked-best-and-can-be-recommended-to-predict-customer-churn-in-this-case.">Of all models, random forest, which is an  ensemble technique, has worked best and can be recommended to predict customer churn in this case.<a class="anchor-link" href="#Of-all-models,-random-forest,-which-is-an--ensemble-technique,-has-worked-best-and-can-be-recommended-to-predict-customer-churn-in-this-case.">&#182;</a></h5>
</div>
</div>
</div>
  </div>
</div>

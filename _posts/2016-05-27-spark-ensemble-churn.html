---
layout: post
title: "Predict Customer Churn using Ensemble Methods"
date: 2016-05-29
description: "Using Spark MLlib to predict customer churn"
main-class: 'spark'
published: true
postbook: 'inotebook'
color: '#7AAB13'
tags:
- spark
- "data Science"
- pyspark
- 'customer churn'
- churn
- mllib
- classification
categories:
- spark
introduction: "Using Spark MLlib to predict customer churn"
---


<div tabindex="-1" id="notebook" class="border-box-sizing">
  <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Customer-Churn-Overview">Customer Churn Overview<a class="anchor-link" href="#Customer-Churn-Overview">&#182;</a></h3><ul>
<li>Companies invest significantly to acquire new customers. So, after acquisition, companies would like these customers to stay long and be loyal. Companies also make investments to keep engaging with these customers continuously and ensure they are happpy and satisfied with their offferings. Loosing customers mean loss of investment and loss of possible future revenue.</li>
<li>So, it is important for companies to infer early signs of a customer about to churn and engage or offer incentives to retain them. But as targetting each customer is not possibe, comapnies can take advantage of analytics to predict if a customer high probability of churing. A possible intervention can be made to retain the customer.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Things-to-learn">Things to learn<a class="anchor-link" href="#Things-to-learn">&#182;</a></h3><ul>
<li>Building Ensemble models like random forest and boosted trees</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">sc</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[1]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;pyspark.context.SparkContext at 0x7f6c449f9278&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="k">import</span> <span class="n">SQLContext</span>
<span class="n">sql_ctx</span> <span class="o">=</span> <span class="n">SQLContext</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Read-the-data-from-csv-file">Read the data from csv file<a class="anchor-link" href="#Read-the-data-from-csv-file">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_df</span> <span class="o">=</span> <span class="n">sql_ctx</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;com.databricks.spark.csv&quot;</span><span class="p">)</span>      \
 <span class="o">.</span><span class="n">options</span><span class="p">(</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">,</span>
          <span class="n">header</span>  <span class="o">=</span> <span class="k">True</span> <span class="p">,</span>
          <span class="n">inferSchema</span> <span class="o">=</span> <span class="k">True</span><span class="p">)</span>                                    \
  <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;file:///home/hadoop/lab/data/churn.csv&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Dataset-Description">Dataset Description<a class="anchor-link" href="#Dataset-Description">&#182;</a></h3><p>This dataset is taken from <a href="https://bigml.com/user/francisco/gallery/dataset/5163ad540c0b5e5b22000383">https://bigml.com/user/francisco/gallery/dataset/5163ad540c0b5e5b22000383</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">2</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+-----+--------------+---------+--------+----------+----------+-------------+--------+---------+----------+--------+---------+----------+----------+-----------+------------+---------+----------+-----------+--------------+------+
|State|Account Length|Area Code|   Phone|Int&apos;l Plan|VMail Plan|VMail Message|Day Mins|Day Calls|Day Charge|Eve Mins|Eve Calls|Eve Charge|Night Mins|Night Calls|Night Charge|Intl Mins|Intl Calls|Intl Charge|CustServ Calls|Churn?|
+-----+--------------+---------+--------+----------+----------+-------------+--------+---------+----------+--------+---------+----------+----------+-----------+------------+---------+----------+-----------+--------------+------+
|   KS|           128|      415|382-4657|        no|       yes|           25|   265.1|      110|     45.07|   197.4|       99|     16.78|     244.7|         91|       11.01|     10.0|         3|        2.7|             1|False.|
|   OH|           107|      415|371-7191|        no|       yes|           26|   161.6|      123|     27.47|   195.5|      103|     16.62|     254.4|        103|       11.45|     13.7|         3|        3.7|             1|False.|
+-----+--------------+---------+--------+----------+----------+-------------+--------+---------+----------+--------+---------+----------+----------+-----------+------------+---------+----------+-----------+--------------+------+
only showing top 2 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sn</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>:0: FutureWarning: IPython widgets are experimental and may change in the future.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="k">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">StringIndexer</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Encoding-the-categorical-variable">Encoding the categorical variable<a class="anchor-link" href="#Encoding-the-categorical-variable">&#182;</a></h3><ul>
<li>The following utility function is created to create categorical variables.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">create_category_vars</span><span class="p">(</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">field_name</span> <span class="p">):</span>
  <span class="n">idx_col</span> <span class="o">=</span> <span class="n">field_name</span> <span class="o">+</span> <span class="s">&quot;Index&quot;</span>
  <span class="n">col_vec</span> <span class="o">=</span> <span class="n">field_name</span> <span class="o">+</span> <span class="s">&quot;Vec&quot;</span>

  <span class="n">month_stringIndexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">(</span> <span class="n">inputCol</span><span class="o">=</span><span class="n">field_name</span><span class="p">,</span>
                                       <span class="n">outputCol</span><span class="o">=</span><span class="n">idx_col</span> <span class="p">)</span>

  <span class="n">month_model</span> <span class="o">=</span> <span class="n">month_stringIndexer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">dataset</span> <span class="p">)</span>
  <span class="n">month_indexed</span> <span class="o">=</span> <span class="n">month_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span> <span class="n">dataset</span> <span class="p">)</span>

  <span class="n">month_encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span> <span class="n">dropLast</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
                                 <span class="n">inputCol</span><span class="o">=</span><span class="n">idx_col</span><span class="p">,</span>
                                 <span class="n">outputCol</span><span class="o">=</span> <span class="n">col_vec</span> <span class="p">)</span>

  <span class="k">return</span> <span class="n">month_encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span> <span class="n">month_indexed</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Select-only-a-subset-of-columns">Select only a subset of columns<a class="anchor-link" href="#Select-only-a-subset-of-columns">&#182;</a></h3><ul>
<li>Some columns are highly corelated e.g. Call minutes, calls and charges. So, only one of the variable can be used. This is applicable across day, eve, night and international calls.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[7]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[&apos;State&apos;,
&apos;Account Length&apos;,
&apos;Area Code&apos;,
&apos;Phone&apos;,
&quot;Int&apos;l Plan&quot;,
&apos;VMail Plan&apos;,
&apos;VMail Message&apos;,
&apos;Day Mins&apos;,
&apos;Day Calls&apos;,
&apos;Day Charge&apos;,
&apos;Eve Mins&apos;,
&apos;Eve Calls&apos;,
&apos;Eve Charge&apos;,
&apos;Night Mins&apos;,
&apos;Night Calls&apos;,
&apos;Night Charge&apos;,
&apos;Intl Mins&apos;,
&apos;Intl Calls&apos;,
&apos;Intl Charge&apos;,
&apos;CustServ Calls&apos;,
&apos;Churn?&apos;]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_df_subset</span> <span class="o">=</span> <span class="n">churn_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">&#39;Account Length&#39;</span><span class="p">,</span>
                                <span class="s">&quot;Int&#39;l Plan&quot;</span><span class="p">,</span>
                                <span class="s">&#39;VMail Plan&#39;</span><span class="p">,</span>
                                <span class="s">&#39;VMail Message&#39;</span><span class="p">,</span>
                                <span class="s">&#39;Day Mins&#39;</span><span class="p">,</span>
                                <span class="s">&#39;Eve Mins&#39;</span><span class="p">,</span>
                                <span class="s">&#39;Night Mins&#39;</span><span class="p">,</span>
                                <span class="s">&#39;Intl Mins&#39;</span><span class="p">,</span>
                                <span class="s">&#39;CustServ Calls&#39;</span><span class="p">,</span>
                                <span class="s">&#39;Churn?&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_df_subset</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[9]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[&apos;Account Length&apos;,
&quot;Int&apos;l Plan&quot;,
&apos;VMail Plan&apos;,
&apos;VMail Message&apos;,
&apos;Day Mins&apos;,
&apos;Eve Mins&apos;,
&apos;Night Mins&apos;,
&apos;Intl Mins&apos;,
&apos;CustServ Calls&apos;,
&apos;Churn?&apos;]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Transform-Target-Variable">Transform Target Variable<a class="anchor-link" href="#Transform-Target-Variable">&#182;</a></h3><ul>
<li>'Churn?' variable is converted into integer</li>
<li>True. will be 1 and False. will be 1</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_df_subset</span> <span class="o">=</span> <span class="n">churn_df_subset</span>                       \
  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span> <span class="s">&quot;Churn&quot;</span><span class="p">,</span>
              <span class="p">(</span> <span class="n">churn_df_subset</span><span class="p">[</span><span class="s">&#39;Churn?&#39;</span><span class="p">]</span>
               <span class="o">==</span> <span class="s">&#39;True.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">)</span> <span class="p">)</span>

<span class="n">churn_df_subset</span> <span class="o">=</span> <span class="n">churn_df_subset</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span> <span class="s">&#39;Churn?&#39;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="nb">type</span><span class="p">(</span> <span class="n">churn_df_subset</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[11]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>pyspark.sql.dataframe.DataFrame</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_df_subset</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">3</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+--------------+----------+----------+-------------+--------+--------+----------+---------+--------------+-----+
|Account Length|Int&apos;l Plan|VMail Plan|VMail Message|Day Mins|Eve Mins|Night Mins|Intl Mins|CustServ Calls|Churn|
+--------------+----------+----------+-------------+--------+--------+----------+---------+--------------+-----+
|           128|        no|       yes|           25|   265.1|   197.4|     244.7|     10.0|             1|    0|
|           107|        no|       yes|           26|   161.6|   195.5|     254.4|     13.7|             1|    0|
|           137|        no|        no|            0|   243.4|   121.2|     162.6|     12.2|             0|    0|
+--------------+----------+----------+-------------+--------+--------+----------+---------+--------------+-----+
only showing top 3 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-categorical-Variables">Create categorical Variables<a class="anchor-link" href="#Create-categorical-Variables">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_vec</span> <span class="o">=</span> <span class="n">create_category_vars</span><span class="p">(</span> <span class="n">churn_df_subset</span><span class="p">,</span>
                               <span class="s">&quot;Int&#39;l Plan&quot;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_vec</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">2</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+--------------+----------+----------+-------------+--------+--------+----------+---------+--------------+-----+---------------+-------------+
|Account Length|Int&apos;l Plan|VMail Plan|VMail Message|Day Mins|Eve Mins|Night Mins|Intl Mins|CustServ Calls|Churn|Int&apos;l PlanIndex|Int&apos;l PlanVec|
+--------------+----------+----------+-------------+--------+--------+----------+---------+--------------+-----+---------------+-------------+
|           128|        no|       yes|           25|   265.1|   197.4|     244.7|     10.0|             1|    0|            0.0|(2,[0],[1.0])|
|           107|        no|       yes|           26|   161.6|   195.5|     254.4|     13.7|             1|    0|            0.0|(2,[0],[1.0])|
+--------------+----------+----------+-------------+--------+--------+----------+---------+--------------+-----+---------------+-------------+
only showing top 2 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_vec</span> <span class="o">=</span> <span class="n">create_category_vars</span><span class="p">(</span> <span class="n">churn_vec</span><span class="p">,</span>
                               <span class="s">&quot;VMail Plan&quot;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_vec</span><span class="o">.</span><span class="n">select</span><span class="p">(</span> <span class="s">&quot;Int&#39;l PlanVec&quot;</span><span class="p">,</span>
               <span class="s">&quot;VMail PlanVec&quot;</span> <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="mi">5</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>+-------------+-------------+
|Int&apos;l PlanVec|VMail PlanVec|
+-------------+-------------+
|(2,[0],[1.0])|(2,[1],[1.0])|
|(2,[0],[1.0])|(2,[1],[1.0])|
|(2,[0],[1.0])|(2,[0],[1.0])|
|(2,[1],[1.0])|(2,[0],[1.0])|
|(2,[1],[1.0])|(2,[0],[1.0])|
+-------------+-------------+
only showing top 5 rows

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.mllib.linalg</span> <span class="k">import</span> <span class="n">Vectors</span>
<span class="kn">from</span> <span class="nn">pyspark.mllib.regression</span> <span class="k">import</span> <span class="n">LabeledPoint</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Creating-the-vectors">Creating the vectors<a class="anchor-link" href="#Creating-the-vectors">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[18]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">parseNewPoint</span><span class="p">(</span> <span class="n">rec</span> <span class="p">):</span>
  <span class="k">return</span> <span class="n">LabeledPoint</span><span class="p">(</span> <span class="nb">float</span><span class="p">(</span> <span class="n">rec</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="p">),</span>
          <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span> <span class="p">[</span><span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">rec</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                <span class="n">rec</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                                <span class="n">rec</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                                <span class="n">rec</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                                <span class="n">rec</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
                                <span class="n">rec</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="p">]</span> <span class="o">+</span>
                                <span class="n">rec</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span>
                                <span class="n">rec</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[19]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_vec_new</span> <span class="o">=</span> <span class="n">churn_vec</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                            <span class="n">parseNewPoint</span><span class="p">(</span> <span class="n">rec</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[20]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_vec_new</span><span class="o">.</span><span class="n">take</span><span class="p">(</span> <span class="mi">5</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[20]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[LabeledPoint(0.0, [128.0,25.0,265.1,197.4,244.7,10.0,1.0,1.0,0.0,0.0,1.0]),
LabeledPoint(0.0, [107.0,26.0,161.6,195.5,254.4,13.7,1.0,1.0,0.0,0.0,1.0]),
LabeledPoint(0.0, [137.0,0.0,243.4,121.2,162.6,12.2,0.0,1.0,0.0,1.0,0.0]),
LabeledPoint(0.0, [84.0,0.0,299.4,61.9,196.9,6.6,2.0,0.0,1.0,1.0,0.0]),
LabeledPoint(0.0, [75.0,0.0,166.7,148.3,186.9,10.1,3.0,0.0,1.0,1.0,0.0])]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Split-dataset-into-train-and-test">Split dataset into train and test<a class="anchor-link" href="#Split-dataset-into-train-and-test">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[21]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">trainingData</span><span class="p">,</span> <span class="n">testData</span> <span class="o">=</span> <span class="n">churn_vec_new</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Building-the-model-and-making-predictions">Building the model and making predictions<a class="anchor-link" href="#Building-the-model-and-making-predictions">&#182;</a></h2><h3 id="Logistic-Regression-Model">Logistic Regression Model<a class="anchor-link" href="#Logistic-Regression-Model">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[22]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.mllib.classification</span> <span class="k">import</span> <span class="n">LogisticRegressionWithLBFGS</span><span class="p">,</span>    \
                                       <span class="n">LogisticRegressionModel</span>
<span class="kn">from</span> <span class="nn">pyspark.mllib.evaluation</span> <span class="k">import</span> <span class="n">BinaryClassificationMetrics</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[23]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c">## Training the model</span>
<span class="n">lr_model</span> <span class="o">=</span> <span class="n">LogisticRegressionWithLBFGS</span><span class="o">.</span><span class="n">train</span><span class="p">(</span> <span class="n">trainingData</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Performance-Metrics-of-the-Model">Performance Metrics of the Model<a class="anchor-link" href="#Performance-Metrics-of-the-Model">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[25]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">labelsAndPreds_lr</span> <span class="o">=</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span>
                               <span class="p">(</span> <span class="nb">float</span><span class="p">(</span><span class="n">lr_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">lp</span><span class="o">.</span><span class="n">features</span><span class="p">)</span> <span class="p">),</span> <span class="n">lp</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">success_count_lr</span> <span class="o">=</span> <span class="n">labelsAndPreds_lr</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                            <span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s">&quot;Successful prediction percentage: &quot;</span> <span class="o">+</span>
    <span class="nb">str</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span> <span class="n">success_count_lr</span> <span class="o">/</span> <span class="n">labelsAndPreds_lr</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Successful prediction percentage: 0.85
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[44]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.mllib.evaluation</span> <span class="k">import</span> <span class="n">MulticlassMetrics</span>

<span class="n">metrics</span> <span class="o">=</span> <span class="n">MulticlassMetrics</span><span class="p">(</span> <span class="n">labelsAndPreds_lr</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[76]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">printMetric</span><span class="p">(</span> <span class="n">metrics</span> <span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span> <span class="s">&#39;Precision of True &#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">precision</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>

  <span class="nb">print</span><span class="p">(</span> <span class="s">&#39;Precision of False&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">precision</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span> <span class="s">&#39;Recall of True    &#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span> <span class="s">&#39;Recall of False   &#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span> <span class="s">&#39;F-1 Score         &#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">fMeasure</span><span class="p">()</span> <span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span> <span class="s">&#39;Confusion Matrix</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusionMatrix</span><span class="p">()</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[77]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">printMetric</span><span class="p">(</span> <span class="n">metrics</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Precision of True  0.43103448275862066
Precision of False 0.8799582463465553
Recall of True     0.17857142857142858
Recall of False    0.9623287671232876
F-1 Score          0.8543307086614174
Confusion Matrix
[[ 843.   33.]
[ 115.   25.]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-Confusion-matrix-and-check-ROC-score">Create Confusion matrix and check ROC score<a class="anchor-link" href="#Create-Confusion-matrix-and-check-ROC-score">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[31]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">labelsAndPreds_lr_df</span> <span class="o">=</span> <span class="n">labelsAndPreds_lr</span><span class="o">.</span><span class="n">toDF</span><span class="p">()</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[32]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">labelsAndPreds_lr_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span> <span class="mi">5</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[32]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
<thead>
  <tr style="text-align: right;">
    <th></th>
    <th>_1</th>
    <th>_2</th>
  </tr>
</thead>
<tbody>
  <tr>
    <th>0</th>
    <td>0</td>
    <td>0</td>
  </tr>
  <tr>
    <th>1</th>
    <td>1</td>
    <td>0</td>
  </tr>
  <tr>
    <th>2</th>
    <td>0</td>
    <td>1</td>
  </tr>
  <tr>
    <th>3</th>
    <td>0</td>
    <td>0</td>
  </tr>
  <tr>
    <th>4</th>
    <td>0</td>
    <td>0</td>
  </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[63]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">sklearn</span> <span class="k">import</span> <span class="n">metrics</span> <span class="k">as</span> <span class="n">smetrics</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sn</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[64]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">cm</span> <span class="o">=</span> <span class="n">smetrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">labelsAndPreds_lr_df</span><span class="o">.</span><span class="n">_2</span><span class="p">,</span> <span class="n">labelsAndPreds_lr_df</span><span class="o">.</span><span class="n">_1</span> <span class="p">)</span>
<span class="n">sn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;.2f&#39;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[64]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f3d97fa8198&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
kd5cAAAAAElFTkSuQmCC
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Decision-Tree-Model">Decision Tree Model<a class="anchor-link" href="#Decision-Tree-Model">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[50]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.mllib.tree</span> <span class="k">import</span> <span class="n">DecisionTree</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Build-model,-make-prediction-and-check-accuracy">Build model, make prediction and check accuracy<a class="anchor-link" href="#Build-model,-make-prediction-and-check-accuracy">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[52]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">tree_model</span> <span class="o">=</span> <span class="n">DecisionTree</span><span class="o">.</span><span class="n">trainClassifier</span><span class="p">(</span><span class="n">trainingData</span><span class="p">,</span>
                                        <span class="n">numClasses</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                        <span class="n">categoricalFeaturesInfo</span><span class="o">=</span><span class="p">{</span><span class="mi">8</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span>
                                        <span class="n">impurity</span><span class="o">=</span><span class="s">&#39;gini&#39;</span><span class="p">,</span>
                                        <span class="n">maxDepth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                        <span class="n">maxBins</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[54]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="nb">print</span><span class="p">(</span> <span class="n">tree_model</span><span class="o">.</span><span class="n">toDebugString</span><span class="p">()</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>DecisionTreeModel classifier of depth 4 with 29 nodes
If (feature 2 &lt;= 264.3)
 If (feature 6 &lt;= 3.0)
  If (feature 7 &lt;= 0.0)
   If (feature 5 &lt;= 13.2)
    Predict: 0.0
   Else (feature 5 &gt; 13.2)
    Predict: 1.0
  Else (feature 7 &gt; 0.0)
   If (feature 2 &lt;= 221.8)
    Predict: 0.0
   Else (feature 2 &gt; 221.8)
    Predict: 0.0
 Else (feature 6 &gt; 3.0)
  If (feature 2 &lt;= 174.5)
   If (feature 2 &lt;= 136.1)
    Predict: 1.0
   Else (feature 2 &gt; 136.1)
    Predict: 1.0
  Else (feature 2 &gt; 174.5)
   If (feature 3 &lt;= 142.4)
    Predict: 1.0
   Else (feature 3 &gt; 142.4)
    Predict: 0.0
Else (feature 2 &gt; 264.3)
 If (feature 1 &lt;= 0.0)
  If (feature 3 &lt;= 183.8)
   If (feature 4 &lt;= 213.4)
    Predict: 0.0
   Else (feature 4 &gt; 213.4)
    Predict: 1.0
  Else (feature 3 &gt; 183.8)
   If (feature 4 &lt;= 105.9)
    Predict: 0.0
   Else (feature 4 &gt; 105.9)
    Predict: 1.0
 Else (feature 1 &gt; 0.0)
  If (feature 7 &lt;= 0.0)
   If (feature 2 &lt;= 279.3)
    Predict: 1.0
   Else (feature 2 &gt; 279.3)
    Predict: 0.0
  Else (feature 7 &gt; 0.0)
   Predict: 0.0

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[59]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">tree_predictions</span> <span class="o">=</span> <span class="n">tree_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="o">.</span><span class="n">features</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">labelsAndPreds_tree</span> <span class="o">=</span> <span class="n">tree_predictions</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[60]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">success_count_tree</span> <span class="o">=</span> <span class="n">labelsAndPreds_tree</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                            <span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s">&quot;Successful prediction percentage: &quot;</span> <span class="o">+</span>
    <span class="nb">str</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span> <span class="n">success_count_tree</span> <span class="o">/</span> <span class="n">labelsAndPreds_tree</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Successful prediction percentage: 0.93
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[69]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">tmetrics</span> <span class="o">=</span> <span class="n">MulticlassMetrics</span><span class="p">(</span> <span class="n">labelsAndPreds_tree</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[78]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">printMetric</span><span class="p">(</span> <span class="n">tmetrics</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Precision of True  0.8556701030927835
Precision of False 0.9379760609357998
Recall of True     0.5928571428571429
Recall of False    0.9840182648401826
F-1 Score          0.9301181102362205
Confusion Matrix
[[ 862.   14.]
[  57.   83.]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[65]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">labelsAndPreds_tree_df</span> <span class="o">=</span> <span class="n">labelsAndPreds_tree</span><span class="o">.</span><span class="n">toDF</span><span class="p">()</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="n">cm_tree</span> <span class="o">=</span> <span class="n">smetrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">labelsAndPreds_tree_df</span><span class="o">.</span><span class="n">_2</span><span class="p">,</span> <span class="n">labelsAndPreds_tree_df</span><span class="o">.</span><span class="n">_1</span> <span class="p">)</span>
<span class="n">sn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm_tree</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;.2f&#39;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[65]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f3d9809a5f8&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
5VvZUVVFsz2/F20oKSsPbkOkyey31WBmV8dZL7sJ5hI6h3U5hCt/9XPO6teXDzZ/yG+Gj+TJh2YT
ralh5Zo3GT1s8IEHie5bMTdcQ0tYzH/mefJyc7hzwjjeWbeBW+6Yztw7JtP7pO48ev893DVrLnP+
Ma9eq2FvDfxa6PeikcJwOFm8inc4cByQs9cjF/WGAeiQk81Z/foC0KVzJ3LataOouJjlqwr59jet
wXVyc7IprVO1FJeWkZvdnpaZmVRXVwNQVFxCbk77pt8AaRKr/7OWXt2/C8DRR3alqKSUZ19+dc/r
p/fpzco336q3Tm52e0rLt+55XlxWRk77dmRmZlJdHbupbVFJKbnt9XtxIIm+2WVTiBe8FwBHA39w
zt1c51FA7PbFX3sLFj3HvXP/AkBZ+VbKtm4lNyeHN9e+zTHfOLLBdXqd1J1FL74MwH/efofcnGxa
ZmbSs/sJLHohtvyZF1+mz8k9gtkISbgunTqxxr0NwIdbishs0YL7/vYP3l63HoDCtY6uh3apt06v
7ifwzMuvALD2nf/SofaP8cknfIdnXl4MwLMvv0LvHicGuCUhlcCbrjXZFKMNfaepZWYtgZ3OuV17
Le/lnHutMR+wffN6b78hbd+xgxtu+QOffFLBrpoaBv3y5/Q5+ST+eOf/0r3bt/dUwwCjJkxk/Mhr
ycjI4M6Zs1ixag1p6WncMORqjj7yCErKyhg7cTI7q6vp3LEjN48cTnp6ehK3rmnt2rkz2VNoMjuq
qhg/5U5Kyz9m165dXPXL/rRqmcnt98ykWXo6LQ46aM/hZKMnTqbg2iFkZDRn+qwHWLHmTdLT0hh5
9SCOOqIrJWXl3DR5GtXV1XTq2IGbhl/j9e/FwUcc+5XT8IP5/2505nQ554dJSd+4wZsIPgevfHk+
B698eV+X4FWvVkT8kvr71hS8IuKXMBzVoOAVEa9EQnDPtdSfoYiIZ1Txiohf1GoQEQmWrk4mIhK0
1M9dBa+I+CUMFa92romIBEwVr4h4JZKe+vWkgldE/BKCVoOCV0S8ksger5l1Ax4Dpjjn7jazOUB3
oLT2LZOccwvMrD8wBKgBZjjnZsUbV8ErItKA2qsz/gl4is+vQx8FRjnn5td5XytgLNAD+BRYamaP
Oef2e7uQ1G+GiIh8EWmRxj/i2wmcB2yh/kFqe6/YE1jqnKtwzlUBi4E+8QZWxSsiXklUq6H2OuS7
zPa5m8xgMxtO7IYQg4E8oLjO60VAp3hjq+IVEb807R0oHgRGOufOAFYCBex7O7wDDqyKV0S80pSX
hXTOPVvn6RPAPcAjxKre3boArxKHKl4R8UviK949bzSzR8zs+Nqn+UAhsAToYWZZZtYa6A28FG9A
Vbwi4pVE9XjNrBcwE+gAfGZmVwI3AbPNbBtQAQxwzlWZ2Sg+P/qhwDlXEXeOuueaJIPuuSYNScQ9
10pXLGl05mR376l7romIfFVhuPWPerwiIgFTxSsiftG1GkREghWGm10qeEXEL+rxiojI3lTxiohX
IpHUrycVvCLiF+1cExEJVhhudqngFRG/hGDnmoJXRLyiildEJGgKXhGRgOmoBhGRYOkiOSIisg9V
vCLiF/V4RUSCFUlLT/YUDkjBKyJeUY9XRET2oYpXRPyiHq+ISLB05pqISNB0AoWISMBCsHNNwSsi
XlGrQUQkaGo1iIgESxWviEjQQlDxpv4MRUQ8o4pXRLwShlOGFbwi4hf1eEVEghWGq5NFotFosucg
IvK1op1rIiIBU/CKiARMwSsiEjAFr4hIwBS8IiIBU/CKiARMx/EGxMymAj2BKDDEObcsyVOSFGBm
3YDHgCnOubuTPR8JhireAJhZPnCUc6438GvgziRPSVKAmbUE/gQ8ley5SLAUvME4nVhVg3NuLdDO
zFond0qSAnYC5wFbkj0RCZaCNxh5QEmd58VApyTNRVKEc26Xc25nsuchwVPwJkeEWK9XRL6GFLzB
2Eys6t2tM/BhkuYiIkmm4A3GQuAiADPrDmxyzlUmd0qSQlL/OoaSULo6WUDMbCLQF9gFXO2cK0zy
lCTJzKwXMBPoAHwGlAL5zrnypE5MmpyCV0QkYGo1iIgETMErIhIwBa+ISMAUvCIiAVPwiogETMEr
IhIwBa+ISMAUvCIiAft/uuoiVIHv6SoAAAAASUVORK5CYII=
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Under-Sampling-to-overcome-unbalanced-representation-of-classes">Under Sampling to overcome unbalanced representation of classes<a class="anchor-link" href="#Under-Sampling-to-overcome-unbalanced-representation-of-classes">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><p>There are roughly 5-6 times as many no-churn samples as there are churn samples. Both class types can be made to represent equally by using techniques of undersampling or downsampling.</p>
</li>
<li><p>The DataFrames sampleBy() function will be used with fractions of each sample type to be selected.</p>
</li>
<li><p>All instances of the Churn=True class will be in the new dataset, but the Churn=False class will be undersampled to a fraction of 500/2850.</p>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[73]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_vec</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&#39;Churn&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[73]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
<thead>
  <tr style="text-align: right;">
    <th></th>
    <th>Churn</th>
    <th>count</th>
  </tr>
</thead>
<tbody>
  <tr>
    <th>0</th>
    <td>0</td>
    <td>2850</td>
  </tr>
  <tr>
    <th>1</th>
    <td>1</td>
    <td>483</td>
  </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[74]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">undersample_churn_vec</span> <span class="o">=</span> <span class="n">churn_vec</span><span class="o">.</span><span class="n">sampleBy</span><span class="p">(</span><span class="s">&#39;Churn&#39;</span><span class="p">,</span> <span class="n">fractions</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mf">500.0</span><span class="o">/</span><span class="mf">2850.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">})</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

<span class="n">undersample_churn_vec</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&#39;Churn&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[74]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
<thead>
  <tr style="text-align: right;">
    <th></th>
    <th>Churn</th>
    <th>count</th>
  </tr>
</thead>
<tbody>
  <tr>
    <th>0</th>
    <td>0</td>
    <td>505</td>
  </tr>
  <tr>
    <th>1</th>
    <td>1</td>
    <td>483</td>
  </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Logistic-Regression-with-undersampled-dataset">Logistic Regression with undersampled dataset<a class="anchor-link" href="#Logistic-Regression-with-undersampled-dataset">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[79]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">churn_vec_new</span> <span class="o">=</span> <span class="n">undersample_churn_vec</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                            <span class="n">parseNewPoint</span><span class="p">(</span> <span class="n">rec</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">trainingData</span><span class="p">,</span> <span class="n">testData</span> <span class="o">=</span> <span class="n">churn_vec_new</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>

<span class="n">lr_model</span> <span class="o">=</span> <span class="n">LogisticRegressionWithLBFGS</span><span class="o">.</span><span class="n">train</span><span class="p">(</span> <span class="n">trainingData</span> <span class="p">)</span>

<span class="n">labelsAndPreds_lr</span> <span class="o">=</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span>
                               <span class="p">(</span> <span class="nb">float</span><span class="p">(</span><span class="n">lr_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">lp</span><span class="o">.</span><span class="n">features</span><span class="p">)</span> <span class="p">),</span> <span class="n">lp</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">success_count_lr</span> <span class="o">=</span> <span class="n">labelsAndPreds_lr</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                            <span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s">&quot;Successful prediction percentage: &quot;</span> <span class="o">+</span>
    <span class="nb">str</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span> <span class="n">success_count_lr</span> <span class="o">/</span> <span class="n">labelsAndPreds_lr</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">metrics</span> <span class="o">=</span> <span class="n">MulticlassMetrics</span><span class="p">(</span> <span class="n">labelsAndPreds_lr</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Successful prediction percentage: 0.73
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[80]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">printMetric</span><span class="p">(</span> <span class="n">metrics</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Precision of True  0.6934306569343066
Precision of False 0.7581699346405228
Recall of True     0.7196969696969697
Recall of False    0.7341772151898734
F-1 Score          0.7275862068965517
Confusion Matrix
[[ 116.   42.]
[  37.   95.]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[103]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">labelsAndPreds_lr_df</span> <span class="o">=</span> <span class="n">labelsAndPreds_lr</span><span class="o">.</span><span class="n">toDF</span><span class="p">()</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">smetrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">labelsAndPreds_lr_df</span><span class="o">.</span><span class="n">_2</span><span class="p">,</span> <span class="n">labelsAndPreds_lr_df</span><span class="o">.</span><span class="n">_1</span> <span class="p">)</span>
<span class="n">sn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;.2f&#39;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[103]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f3d95e48668&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
/h/EYD/or8XrbwAAAABJRU5ErkJggg==
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Decision-Tree-with-undersampled-dataset">Decision Tree with undersampled dataset<a class="anchor-link" href="#Decision-Tree-with-undersampled-dataset">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[81]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">tree_model</span> <span class="o">=</span> <span class="n">DecisionTree</span><span class="o">.</span><span class="n">trainClassifier</span><span class="p">(</span><span class="n">trainingData</span><span class="p">,</span>
                                        <span class="n">numClasses</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                        <span class="n">categoricalFeaturesInfo</span><span class="o">=</span><span class="p">{</span><span class="mi">8</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span>
                                        <span class="n">impurity</span><span class="o">=</span><span class="s">&#39;gini&#39;</span><span class="p">,</span>
                                        <span class="n">maxDepth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                        <span class="n">maxBins</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>

<span class="n">tree_predictions</span> <span class="o">=</span> <span class="n">tree_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="o">.</span><span class="n">features</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">labelsAndPreds_tree</span> <span class="o">=</span> <span class="n">tree_predictions</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">success_count_tree</span> <span class="o">=</span> <span class="n">labelsAndPreds_tree</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                            <span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s">&quot;Successful prediction percentage: &quot;</span> <span class="o">+</span>
    <span class="nb">str</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span> <span class="n">success_count_tree</span> <span class="o">/</span> <span class="n">labelsAndPreds_tree</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">tmetrics</span> <span class="o">=</span> <span class="n">MulticlassMetrics</span><span class="p">(</span> <span class="n">labelsAndPreds_tree</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Successful prediction percentage: 0.81
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[82]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">printMetric</span><span class="p">(</span> <span class="n">tmetrics</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Precision of True  0.825
Precision of False 0.8058823529411765
Recall of True     0.75
Recall of False    0.8670886075949367
F-1 Score          0.8137931034482758
Confusion Matrix
[[ 137.   21.]
[  33.   99.]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[104]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">labelsAndPreds_tree_df</span> <span class="o">=</span> <span class="n">labelsAndPreds_tree</span><span class="o">.</span><span class="n">toDF</span><span class="p">()</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="n">cm_tree</span> <span class="o">=</span> <span class="n">smetrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">labelsAndPreds_tree_df</span><span class="o">.</span><span class="n">_2</span><span class="p">,</span> <span class="n">labelsAndPreds_tree_df</span><span class="o">.</span><span class="n">_1</span> <span class="p">)</span>
<span class="n">sn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm_tree</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;.2f&#39;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[104]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f3d95ee1198&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Random-Forest-Tree-Model">Random Forest Tree Model<a class="anchor-link" href="#Random-Forest-Tree-Model">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[83]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.mllib.tree</span> <span class="k">import</span> <span class="n">RandomForest</span><span class="p">,</span> <span class="n">RandomForestModel</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[84]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">rf_model</span> <span class="o">=</span> <span class="n">RandomForest</span><span class="o">.</span><span class="n">trainClassifier</span><span class="p">(</span><span class="n">trainingData</span><span class="p">,</span>
                                      <span class="n">numClasses</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                      <span class="n">categoricalFeaturesInfo</span><span class="o">=</span><span class="p">{</span><span class="mi">8</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span>
                                      <span class="n">numTrees</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                                      <span class="n">impurity</span><span class="o">=</span><span class="s">&#39;entropy&#39;</span><span class="p">,</span>
                                      <span class="n">maxDepth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                      <span class="n">maxBins</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[87]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">rf_predictions</span> <span class="o">=</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="o">.</span><span class="n">features</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">labelsAndPreds_rf</span> <span class="o">=</span> <span class="n">rf_predictions</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">success_count_rf</span> <span class="o">=</span> <span class="n">labelsAndPreds_rf</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                            <span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s">&quot;Successful prediction percentage: &quot;</span> <span class="o">+</span>
    <span class="nb">str</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span> <span class="n">success_count_rf</span> <span class="o">/</span> <span class="n">labelsAndPreds_rf</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Successful prediction percentage: 0.86
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[92]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">rf_metrics</span> <span class="o">=</span> <span class="n">MulticlassMetrics</span><span class="p">(</span> <span class="n">labelsAndPreds_rf</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[93]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">printMetric</span><span class="p">(</span> <span class="n">rf_metrics</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Precision of True  0.835820895522388
Precision of False 0.8717948717948718
Recall of True     0.8484848484848485
Recall of False    0.8607594936708861
F-1 Score          0.8551724137931035
Confusion Matrix
[[ 136.   22.]
[  20.  112.]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[94]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">labelsAndPreds_rf_df</span> <span class="o">=</span> <span class="n">labelsAndPreds_rf</span><span class="o">.</span><span class="n">toDF</span><span class="p">()</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="n">cm_rf</span> <span class="o">=</span> <span class="n">smetrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">labelsAndPreds_rf_df</span><span class="o">.</span><span class="n">_2</span><span class="p">,</span> <span class="n">labelsAndPreds_rf_df</span><span class="o">.</span><span class="n">_1</span> <span class="p">)</span>
<span class="n">sn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm_rf</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;.2f&#39;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[94]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f3d97eb86a0&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
uX7QFwAAAABJRU5ErkJggg==
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gradient-Boosted-Trees">Gradient Boosted Trees<a class="anchor-link" href="#Gradient-Boosted-Trees">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[98]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">pyspark.mllib.tree</span> <span class="k">import</span> <span class="n">GradientBoostedTrees</span><span class="p">,</span> <span class="n">GradientBoostedTreesModel</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[99]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">gbt_model</span> <span class="o">=</span> <span class="n">GradientBoostedTrees</span><span class="o">.</span><span class="n">trainClassifier</span><span class="p">(</span><span class="n">trainingData</span><span class="p">,</span>
                                               <span class="n">categoricalFeaturesInfo</span><span class="o">=</span><span class="p">{</span><span class="mi">8</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span>
                                               <span class="n">numIterations</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[100]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">gbt_predictions</span> <span class="o">=</span> <span class="n">gbt_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="o">.</span><span class="n">features</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">labelsAndPreds_gbt</span> <span class="o">=</span> <span class="n">gbt_predictions</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span> <span class="n">testData</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">success_count_gbt</span> <span class="o">=</span> <span class="n">labelsAndPreds_gbt</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rec</span><span class="p">:</span>
                                            <span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s">&quot;Successful prediction percentage: &quot;</span> <span class="o">+</span>
    <span class="nb">str</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span> <span class="n">success_count_gbt</span> <span class="o">/</span> <span class="n">labelsAndPreds_gbt</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Successful prediction percentage: 0.84
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[101]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">gbt_metrics</span> <span class="o">=</span> <span class="n">MulticlassMetrics</span><span class="p">(</span> <span class="n">labelsAndPreds_gbt</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[102]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">printMetric</span><span class="p">(</span> <span class="n">gbt_metrics</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Precision of True  0.8148148148148148
Precision of False 0.8580645161290322
Recall of True     0.8333333333333334
Recall of False    0.8417721518987342
F-1 Score          0.8379310344827586
Confusion Matrix
[[ 133.   25.]
[  22.  110.]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[69]:</div>
<div class="inner_cell">
  <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">labelsAndPreds_gbt</span> <span class="o">=</span> <span class="n">labelsAndPreds_gbt</span><span class="o">.</span><span class="n">toDF</span><span class="p">()</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="n">cm_gbt</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span> <span class="n">labelsAndPreds_gbt</span><span class="o">.</span><span class="n">_1</span><span class="p">,</span> <span class="n">labelsAndPreds_gbt</span><span class="o">.</span><span class="n">_2</span> <span class="p">)</span>
<span class="n">sn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm_gbt</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;.2f&#39;</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[69]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f6c1278f9b0&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAV4AAAD+CAYAAAByQG1AAAAABHNCSVQICAgIfAhkiAAAAAlwSFlz
AAALEgAACxIB0t1+/AAAFchJREFUeJzt3XuYVXW9x/H3nhnIAeI+AyimWfYjPZJHQRBKTLDS7GL3
DsfMS1FBmZ4U0lTARytNRdNjkiJmpidBTXlA0kxRMcPIQMpfmpkXiBkG0JGLwDDnj7k4w2Uzyp61
Zy3eL579PLP3Wvu3f+tx++HLd/3Wmlx9fT2SpOSUFHsCkrSnMXglKWEGryQlzOCVpIQZvJKUMINX
khJW1t4fMHi/Ua5X03aeXHpnsaegDqhz9z653R3jrWTOkn89vNuf93a0e/BKUpJyuaJk6Vti8ErK
lFyu43dQO/4MJSljrHglZUppCipeg1dSppQYvJKUrDScXOv4fzVIUsZY8UrKlBwdv+I1eCVlij1e
SUpYGnq8Bq+kTCkpUPCGEE4FTmrx0hBgFnA4UNP42qUxxnkhhLHAGcBWYHqMcUa+sQ1eSZmSK9Ca
gcbwnAEQQjgK+ALQFZgUY5zbtF8IoStwPjAU2AwsCiHcFWNcs7OxO34zRJLeglwu1+bHW3ABcFHT
R2yzbRiwKMZYG2PcCDwGjMw3mBWvpEwpVKuhSQhhKPBijHFlCAFgQgjhLKAKmAD0B6pbvKUKGJB3
jgWdoSQVWe4t/Gmj04GZjT/fAkyMMY4GngImA9vehnKXAxu8kpTfKGAhQIzxwRjjksbX7wEOAZbT
UPU2GQi8km9Ag1dSppTkStr82JUQwt7A6zHGLY3PZ4UQDmncPApYCjwBDA0h9AghdANGAI/kG9ce
r6RMKS0paD3ZH1jZ4vk1wE0hhNeBWuCUGOPGEMIkYD4NbYfJMcbafIMavJIypZCXDMcYFwMfb/H8
IRrW826732xgdlvHtdUgSQmz4pWUKd6rQZIS5r0aJClhhb6Aoj0YvJIyxfvxSlLCbDVIUsJsNUhS
wmw1SFLC0rCcrOPPUJIyxopXUqZ4ck2SElaaglaDwSspU9KwqqHj/9UgSRljxSspU+zxSlLC0tBq
MHglZYoXUEhSwqx4JSlh9nglKWFWvJKUMHu8kpSwNFS8XkAhSQmz4pWUKZ5ck6SEpaHVYPBKyhRv
hC5J2o4Vr6RMKen4nQaDV1K2eHJNkhLmyTVJSpgVbwaVdynn4ivPpXv3bnTq3ImfTZvJ88/9i0uu
PI+SkhKqq2o498yL2bJ5C98++3QOH/YBSkpKeHD+I8y8/vZWY/UbULHD9x3/6TGMPeVz1G/dyqzb
5nD3r+cW6Wi1u9avX8+5F15E7eu1bNq0mW9+7VRGDB/WvP3xJxbx0+uup6SkhA+NPJJxp50CwI+v
uIqlTy8jl8sx6X++y8EHvb9Yh6B2YPC+RZ/6/Md44bkXufqyn9O3sjc33jaNpxYv47ab7+SBeQv4
9tmnc+IXjmfxH5cwZPihnPzZCQDc9cDN3DPrPlbXrG0ea/xZp233vjl3/pZx3/4KX/7kOLZsqeO2
e67nd/ctoPa114t1yNoNd8+Zy7v3348zxn+D6lWrOO2b3+aeO25r3v7jy6dx/TXTqKzoy1fHfYtj
j/kwNavX8NJLL/PLGdN5/oUXuGDqJfxyxvQiHkW6ZOKXXYYQugEDgHpgRYxxXbvPqgOrqV7DgeEA
AHr06M6a1a8ydPihXPT9nwDw8AMLOfnrX+ThBxbSuXMnyjqV0amsjPqtW9mw4Y1WYw0Z/gGmfv+y
Vu974fmXeHpJZP26DQD8+cml/OeQQ1jw4OMJHqUKpU/v3jz73D8AePXV1+jVq2fztpdefoUePbrT
r7ICgA+NOJI/LHqSNWvWMvrDowA4YP/9ea22lvXr19OlS5fkDyCFCtnjDSGMBc4GtgAXAEuBW2hY
irsCOCnGuKlxvzOArcD0GOOMvHPM84FDQggLgUXAjcBNwJIQwoIQwiEFOKZUun/uQ/Tfu5J7H7qV
G2+fxmUXXUt5+V5s2VIHwOqatfSt7EPVylX8ds5DzF/4a+Y9eju33XwXG9ZvaDXWjt7Xt6I3a1a/
WRWvrllLRWWf5A5QBfXRMcfw75VVfPwzX+DUb0zgnO9+p3lbTc1qevV8M4j79O7NqlWrWFVTQ88e
PZpf79WrJ9WrahKdd5rlcm1/5BNC6END2I4ETgA+BUwBfhpjPAp4Djg1hNAVOB8YDRwNnBlC6JVv
7HwV71XAqTHGZ7aZzGHAtcBR+aedTR8/8VhWvLKS8V+dyIGDDmDyj8+hvr6+eXtTY3+fffsz5rij
OO6DX6JTpzJ+Mfta7p/7MGvXvLrDcXd2QiAF5wmUx71z72NA/35cd9XlxGefY8rFP+JXM29o2LjN
f9uW36PWG9JxwiiDxgAPNP4rfx0wLoTwPDCucfu9wPeACCyKMdYChBAeoyGs5+xs4HzNkNy2oQsQ
Y1wMlL6do8iCQw//Dx5/ZBEAzz7zPP0GVLBhw0Y6v6MzAJX9+1K9soaDB7+fJU/9jU1vbGLd6+t5
Nj7PgYMOaDXW+vUb6NS5U6v3Va1cRd+K3s379OtfycqV1QkdnQrtL0uWMmLYEQCEA9/Lyqqq5oCt
rOjLqpo3K9mVVVVU9K3Y7vWq6mr69vVfPW1Vksu1+bEL+wFdQgi/afyX/miga4xxc+P2ahrasP0b
f25S1fj6zueYZ9sTIYR7QwinhhA+2fj4egjht8CCXc04q1584RUOOfQgAAbs04/16zbw+CNPMua4
hn8AjDluFI8+9AQv/etlDh4cACgrK+XAcAAvv7i81Vh/ePRPHHv8qFbvW/rU3zh48CC6vbMr5V3K
OfTwg1n8xyUJHqEKad99B7Jk2TIAlq9YQXl5eXP1uveAAaxbt47lK1awZcsWFjy6kJFHDuPIYUdw
/4O/B+Cvz0QqKyvoUl5etGNIm9xb+LMLJUBv4ETgqzS0W1t/1M6msAs7bTXEGM8MIYwCjgGa1r8s
By6MMe6xZ3pm3XoPUy6byI23T6O0rJSp3/8J//zHi1x8xbl8/r8+yfKX/809s+5j69atPL5gETfP
vgaA2bfNYcUrK3nf+9/D6I9+iOumzeR/r7xph++76sfX87NfXEY9cN20mc0n2pQ+n//Mp7lg6iWc
Mm48dXV1XHjuRH4zZy7dunVl9NGj+MGksznnvAsB+NhHxvCufQfyrn0HctCgQZx02jhKSks475zv
Ffko0qWAbZl/A4/HGLcCz4cQaoFNIYS9YowbgX1oyMTlNFS9TQYCeTMyt9O+UoEM3m9U+36AUunJ
pXcWewrqgDp377PbqXn+cee2OXMumnfJTj8vhLA3MBP4KA2V75+A+4BHYoy3hhCuBp4CfkXDaoch
QF3jfkOaer470vEXvElSEcQYlwOzgD8Ac4EJwGTg5BDCAqAncHNj9TsJmA/cD0zOF7rgBRSSMqaQ
63hjjNOBba9e+cgO9psNzG7ruAavpEzxtwxLUsK8O5kkJSwFuWvwSsqWNFzlZ/BKyhRbDZKUsBTk
rsErKVvSUPF6AYUkJcyKV1KmuI5XkhLmqgZJSlhpSccPXnu8kpQwK15JmWKrQZISloJOg8ErKVus
eCUpYSnIXU+uSVLSrHglZUppruPXkwavpExJQ6vB4JWUKd4kR5K0HSteSZnicjJJSlgKctfglZQt
VrySlDAvGZakhFnxSlLCUpC7Bq+kbEnDOl6DV1KmpKHV4AUUkpQwK15JmZKCgtfglZQtJSlYT2bw
SsoUT65JUsqFEMqBp4GpwIeBw4Caxs2XxhjnhRDGAmcAW4HpMcYZ+cY0eCVlSjsUvD8AVjX+XA9M
ijHObdoYQugKnA8MBTYDi0IId8UY1+xsQFc1SMqUXC7X5seuhBAGAYOAuS1e3vaNw4BFMcbaGONG
4DFgZL5xrXglZUqBK97LgPHAKS1emxBCOAuoAiYA/YHqFturgAH5BrXilZQphap4QwhfARbEGF/k
zSr3FmBijHE08BQwmYb2Q6sp7GqOBq+kTMnl2v7YheOBz4cQHgdOo6GPm4sxLmncfg9wCLCchqq3
yUDglXwD22qQlCmFWk4WY/xS088hhAuBF4BvhhCqYoxLgVHAUuAJ4IYQQg+gDhgBfCff2AavpExp
52W81wA3hRBeB2qBU2KMG0MIk4D5NLQdJscYa/MNYvBKypT2uElOjHFKi6dDdrB9NjC7rePZ45Wk
hFnxSsqUFFwxbPBKyhZvkiNJCfNG6JKk7VjxSsqUFBS8Bq+kbElDq8HglZQpKcjd9g/exx66vr0/
Qin0Rk31rnfSHqdz9z67PYa/gUKSEpaC3DV4JWWLPV5JSlgKctfglZQtOa9ck6RkpaHi9co1SUqY
Fa+kTPHkmiQlzLuTSVLCUlDw2uOVpKRZ8UrKlhSUvAavpEzx5JokJSwFuWvwSsoWr1yTpIRZ8UpS
wuzxSlLCUpC7Bq+kbElDxesFFJKUMCteSZmSgoLX4JWULbnSjp+8Bq+kTLHHK0najhWvpExJQcFr
8ErKlkK1GkIIXYCZQCWwF3ARsAS4hYZuwQrgpBjjphDCWOAMYCswPcY4I9/YthokZUou1/bHLpwA
/DHGeDTwBeBKYArw0xjjUcBzwKkhhK7A+cBo4GjgzBBCr3wDW/FKypYCVbwxxl+3ePou4CUagnVc
42v3At8DIrAoxlgLEEJ4DBgJzNnZ2AavpEwp9N3JQggLgb2BTwAPxBg3N26qBgYA/Rt/blLV+PpO
2WqQlCkFbDUAEGMcAXwKuHXbj9rZFHY1psErKVNyuVybH/mEEA4PIewLEGP8Cw0dgtoQwl6Nu+wD
LG989G/x1oHAK/nGNnglZUoBK94PAWcBhBD6AV2BB4DPNm7/LDAPeAIYGkLoEULoBowAHsk3sMEr
STv2M6AyhLCAhhNl3wImAyc3vtYTuDnGuBGYBMwH7gcmN51o2xlPrknKlsKtatgIjN3Bpo/sYN/Z
wOy2jm3wSsoUf+eaJCUsDcFrj1eSEmbFKylTvEmOJCUsDa0Gg1dSpqThRugGr6Rs6fi568k1SUqa
Fa+kTCkp6fj1pMErKVs6fu4avJKyJQ0n11Lwd4MkZYsVr6RMSUPFa/BKypaOn7sGr6Rs8co1SUqa
rQZJSlYKctfg3R2/mf8Ac3/3++bnf3v2Oe6Yfi1TLr+KLXVbKSsr5aJzzqJPr56t3nf59Tew7Jm/
Qy7H975xOge970D+XV3NBZdOo75+K31792Lq2WfSqVOnpA9JBbCj78W1l0zlqhtmUlZWSudOnZh6
9pn07NG91fv8XhRGGk6u5err69v1A2r/+Uz7fkAHsXjpMu5f8CgbNmxk5BGHc+xRH+SOe+eyoqqa
75x2cvN+f1ryNL+cfTdXTvkBL7z0MlOvuJoZV17KlMuv4oPDhjL6gyO4duYt9Kvoy+c+flwRj0iF
0PS9WLP2Vb5z2sns3b8fP7/1dspKyzjlS59r3s/vRYN3vnvQbqfmC3fd2+bM2f/ETxQlpd/WOt4Q
Qq9CTyTtbrj1dr429otMnDCOY0YeCUDPHt159bXXWu335F+WcPSI4QDsv+9AXnt9HevWr2fx0mWM
Gn4EAEcNO4I//vkvyR6A2kXT9+JH553D3v37UV9fT9Wq1fSr6NtqP78XhVOoX+/ent7uBRQPF3QW
KbcsPku/ygp69+xJ+V57UVpaSl1dHXfcO4/jjhnVat9Vq9fSs/s7m5/36tGdmjVr2bBxI2VlZc2v
rVq9JtFjUOEti8/Sr6IvvXs2tJoWPrmYz57+Lda8utbvxR5upz3eEML4PO/r0w5zSa2777ufTxw7
uvl5XV0dF1w2jSMOHcyQDwzO+94ddXr2iN7MHuDu++7nEx8Z0/x8xJDDuPPG6/jpjJuZ+X+zW7Ua
tuX34u1Lw3KyfBXvWcDBQN9tHhV4Uq6VxUufZvBBg5qfT7niavYbuA+nj/3idvtW9OlNzZq1zc+r
V6+mb+9elJeXs2nTZgCqVtVQ0bt3+09c7arl9+J3jy5sfv2YkSN4atlfW+3r96JwciW5Nj+KJV/w
nggcCPwoxjilxWMyUJXI7FKguqaGLuV7UVZaCsC8Bx+ic6dOfP2/v7TD/Ycfdmjz/4TPPPsPKvv0
pkt5OUcc+gF+9+hjADz46EJGDD08mQNQu9j2e3Hjr37N35//JwBLn4nsv+/AVvv7vSigXK7tjyLZ
aeUaY1wSQvgUsGUHm7/WflNKl5rVa5t7eAB3zJnH5s2bGXfOeQAcsN+7mDh+HOf+8CdM/p8zGHzQ
IN7/3vdw6lkTKS0pYeL4cQCMO+nLXPiTadw5dz4D+lVywpgPF+V4VBjbfi/OP3MCP7rmZ5SVlrLX
O97B1LPPBPB70Q5cTsaes5xM0u4rxHKyl+fe1+bMGXj8x4qS0vZqJWVLxy94DV5J2ZKGVQ0Gr6RM
yaXgd651/BlKUsZY8UrKFlsNkpSsNCwnM3glZUvHz12DV1K2FLLiDSEMBu4CrogxXhtCmAkcBtQ0
7nJpjHFeCGEscAawFZgeY5yRb1yDV5J2IITQBbgcmM+b9yiqBybFGOe22K8rcD4wFNgMLAoh3BVj
3Omt5FzVIClTcqUlbX7swhvACcBKWjcwti2phwGLYoy1McaNwGPAyHwDW/FKypYCtRpijHVAXQhh
200TQghn0XCzsAlAf6C6xfYqYEC+sa14JWVKO/8GiluAiTHG0cBTwGS2v1XyLge24pWkNooxPtji
6T3AdcAsGqreJgOBx/ONY8UrKVtKcm1/tE3zjiGEWSGEQxqfjgKWAk8AQ0MIPUII3YARwCP5BrTi
lZQphVpOFkIYDvwcqAS2hBC+AVwI3BRCeB2oBU6JMW4MIUzizdUPk2OMtXnn6P14JXUUhbgfb/UT
j7U5cyqGjfR+vJK0u7wtpCQlzXs1SFKyvEmOJCXN4JWkZKWhx+s6XklKmBWvpGyx1SBJyUrDL7s0
eCVliz1eSdK2rHglZUou1/HrSYNXUrZ4ck2SkuWVa5KUtBScXDN4JWWKFa8kJc3glaSEuapBkpLl
TXIkSdux4pWULfZ4JSlZuZLSYk9hlwxeSZlij1eStB0rXknZYo9XkpLllWuSlDQvoJCkhKXg5JrB
KylTbDVIUtJsNUhSsqx4JSlpKah4O/4MJSljrHglZUoaLhk2eCVliz1eSUpWGu5Olquvry/2HCRp
j+LJNUlKmMErSQkzeCUpYQavJCXM4JWkhBm8kpQw1/EmJIRwJTAMqAfOiDE+WeQpqQMIIQwG7gKu
iDFeW+z5KBlWvAkIIYwC3htjHAGcBlxd5CmpAwghdAEuB+YXey5KlsGbjGNoqGqIMT4D9AohdCvu
lNQBvAGcAKws9kSULIM3Gf2BVS2eVwMDijQXdRAxxroY4xvFnoeSZ/AWR46GXq+kPZDBm4zlNFS9
TfYGVhRpLpKKzOBNxm+BzwGEEA4DXokxrivulNSBdPz7GKqgvDtZQkIIPwSOAuqA8THGpUWekoos
hDAc+DlQCWwBaoBRMcY1RZ2Y2p3BK0kJs9UgSQkzeCUpYQavJCXM4JWkhBm8kpQwg1eSEmbwSlLC
DF5JStj/A7eh84E/W/2jAAAAAElFTkSuQmCC
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Of-all-models,-random-forest,-which-is-an--ensemble-technique,-has-worked-best-and-can-be-recommended-to-predict-customer-churn-in-this-case.">Of all models, random forest, which is an  ensemble technique, has worked best and can be recommended to predict customer churn in this case.<a class="anchor-link" href="#Of-all-models,-random-forest,-which-is-an--ensemble-technique,-has-worked-best-and-can-be-recommended-to-predict-customer-churn-in-this-case.">&#182;</a></h5>
</div>
</div>
</div>
  </div>
</div>
